{"version":3,"file":"toCmcdReport.js","sourceRoot":"","sources":["../../src/cmcd/toCmcdReport.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,YAAY,EAAE,MAAM,mBAAmB,CAAC;AACjD,OAAO,EAAE,UAAU,EAAE,MAAM,iBAAiB,CAAC;AAC7C,OAAO,EAAE,UAAU,EAAE,MAAM,iBAAiB,CAAC;AAK7C,OAAO,EAAE,UAAU,EAAE,MAAM,iBAAiB,CAAC;AAC7C,OAAO,EAAE,aAAa,EAAE,MAAM,oBAAoB,CAAC;AAEnD;;;;;;;;;;;;;;GAcG;AACH,MAAM,UAAU,YAAY,CAAC,IAAc,EAAE,MAAwB;IACpE,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;QAC5B,OAAO,IAAI,CAAC;IACb,CAAC;IAED,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;IAChC,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,IAAI,KAAK,CAAC;IACtC,MAAM,OAAO,GAAG,EAAE,CAAC;IACnB,MAAM,iBAAiB,GAAG,MAAM,CAAC,gBAAgB,IAAI,UAAU,CAAC;IAChE,MAAM,OAAO,GAAsB;QAClC,OAAO,EAAE,MAAM,CAAC,OAAO;QACvB,aAAa,EAAE,MAAM,CAAC,aAAa;KACnC,CAAC;IAEF,IAAI,MAAM,CAAC,WAAW,EAAE,CAAC;QACxB,OAAO,CAAC,MAAM,GAAG,CAAC,GAAY,EAAE,EAAE,CAAC,MAAM,CAAC,WAAY,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;IACtE,CAAC;IAED,QAAQ,iBAAiB,EAAE,CAAC;QAC3B,KAAK,UAAU;YACd,MAAM,KAAK,GAAG,UAAU,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;YACxC,IAAI,KAAK,EAAE,CAAC;gBACX,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;YACzC,CAAC;YACD,MAAM;QAEP,KAAK,YAAY;YAChB,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,aAAa,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;YACrD,MAAM;IACR,CAAC;IAED,OAAO;QACN,GAAG,EAAE,GAAG,CAAC,QAAQ,EAAE;QACnB,MAAM;QACN,OAAO;KACP,CAAC;AACH,CAAC","sourcesContent":["import type { CommonMediaRequest } from '../request/CommonMediaRequest.js';\nimport { CMCD_HEADERS } from './CMCD_HEADERS.js';\nimport { CMCD_PARAM } from './CMCD_PARAM.js';\nimport { CMCD_QUERY } from './CMCD_QUERY.js';\nimport type { CmcdData } from './CmcdData.js';\nimport type { CmcdEncodeOptions } from './CmcdEncodeOptions.js';\nimport type { CmcdKey } from './CmcdKey.js';\nimport type { CmcdReportTarget } from './CmcdReportTarget.js';\nimport { encodeCmcd } from './encodeCmcd.js';\nimport { toCmcdHeaders } from './toCmcdHeaders.js';\n\n/**\n * Converts CMCD data into a report format.\n *\n * @param data - The CMCD data to be transformed into a report\n * @param target - The target configuration for the CMCD report\n *\n * @return A CMCD report object\n *\n * @group CMCD\n *\n * @beta\n *\n * @example\n * {@includeCode ../../test/cmcd/toCmcdReport.test.ts#example}\n */\nexport function toCmcdReport(data: CmcdData, target: CmcdReportTarget): CommonMediaRequest | null {\n\tif (!target || !target.url) {\n\t\treturn null;\n\t}\n\n\tconst url = new URL(target.url);\n\tconst method = target.method || 'GET';\n\tconst headers = {};\n\tconst transimissionMode = target.transmissionMode || CMCD_QUERY;\n\tconst options: CmcdEncodeOptions = {\n\t\tversion: target.version,\n\t\treportingMode: target.reportingMode,\n\t};\n\n\tif (target.enabledKeys) {\n\t\toptions.filter = (key: CmcdKey) => target.enabledKeys!.includes(key);\n\t}\n\n\tswitch (transimissionMode) {\n\t\tcase CMCD_QUERY:\n\t\t\tconst param = encodeCmcd(data, options);\n\t\t\tif (param) {\n\t\t\t\turl.searchParams.set(CMCD_PARAM, param);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase CMCD_HEADERS:\n\t\t\tObject.assign(headers, toCmcdHeaders(data, options));\n\t\t\tbreak;\n\t}\n\n\treturn {\n\t\turl: url.toString(),\n\t\tmethod,\n\t\theaders,\n\t};\n}\n"]}