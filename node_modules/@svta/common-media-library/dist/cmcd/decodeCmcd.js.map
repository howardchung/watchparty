{"version":3,"file":"decodeCmcd.js","sourceRoot":"","sources":["../../src/cmcd/decodeCmcd.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAE1D,OAAO,EAAE,MAAM,EAAE,MAAM,8BAA8B,CAAC;AACtD,OAAO,EAAE,YAAY,EAAE,MAAM,oCAAoC,CAAC;AAUlE,SAAS,WAAW,CAAC,KAAuB;IAC3C,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC;QAC1B,OAAO,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;IAC/B,CAAC;IAED,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;QAC/B,OAAO,WAAW,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC;IAED,IAAI,KAAK,YAAY,MAAM,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QAC9C,OAAO,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACjC,CAAC;IAED,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE,CAAC;QAC/B,OAAO,kBAAkB,CAAC,KAAK,CAAC,CAAC;IAClC,CAAC;IAED,OAAO,KAA0B,CAAC;AACnC,CAAC;AAAA,CAAC;AAEF;;;;;;;;;;;;;GAaG;AACH,MAAM,UAAU,UAAU,CAAgC,IAAY;IACrE,IAAI,CAAC,IAAI,EAAE,CAAC;QACX,OAAO,EAAO,CAAC;IAChB,CAAC;IAED,MAAM,MAAM,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;IAElC,OAAO,MAAM;SACX,OAAO,CAAS,MAAa,CAAC;SAC9B,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE;QAC5B,GAAG,CAAC,GAAc,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,KAAK,CAAe,CAAC;QAC5D,OAAO,GAAG,CAAC;IACZ,CAAC,EAAE,EAAO,CAAC,CAAC;AACd,CAAC","sourcesContent":["import { symbolToStr } from '../cta/utils/symbolToStr.js';\nimport type { SfBareItem } from '../structuredfield/SfBareItem.js';\nimport { SfItem } from '../structuredfield/SfItem.js';\nimport { decodeSfDict } from '../structuredfield/decodeSfDict.js';\nimport type { CmcdData } from './CmcdData.js';\nimport type { CmcdValue } from './CmcdValue.js';\n\n// Define the input type for reduceValue\ntype ReduceValueInput = SfBareItem | SfItem | ReduceValueInput[];\n\n// Define the output type for reduceValue - matches what CMCD values can be, including arrays\ntype ReduceValueOutput = CmcdValue | ReduceValueOutput[];\n\nfunction reduceValue(value: ReduceValueInput): ReduceValueOutput {\n\tif (Array.isArray(value)) {\n\t\treturn value.map(reduceValue);\n\t}\n\n\tif (typeof value === 'symbol') {\n\t\treturn symbolToStr(value);\n\t}\n\n\tif (value instanceof SfItem && !value.params) {\n\t\treturn reduceValue(value.value);\n\t}\n\n\tif (typeof value === 'string') {\n\t\treturn decodeURIComponent(value);\n\t}\n\n\treturn value as ReduceValueOutput;\n};\n\n/**\n * Decode a CMCD string to an object.\n *\n * @param cmcd - The CMCD string to decode.\n *\n * @returns The decoded CMCD object.\n *\n * @group CMCD\n *\n * @beta\n *\n * @example\n * {@includeCode ../../test/cmcd/decodeCmcd.test.ts#example}\n */\nexport function decodeCmcd<T extends CmcdData = CmcdData>(cmcd: string): T {\n\tif (!cmcd) {\n\t\treturn {} as T;\n\t}\n\n\tconst sfDict = decodeSfDict(cmcd);\n\n\treturn Object\n\t\t.entries<SfItem>(sfDict as any)\n\t\t.reduce((acc, [key, item]) => {\n\t\t\tacc[key as keyof T] = reduceValue(item.value) as T[keyof T];\n\t\t\treturn acc;\n\t\t}, {} as T);\n}\n"]}