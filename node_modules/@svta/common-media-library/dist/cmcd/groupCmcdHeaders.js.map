{"version":3,"file":"groupCmcdHeaders.js","sourceRoot":"","sources":["../../src/cmcd/groupCmcdHeaders.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,eAAe,EAAE,MAAM,sBAAsB,CAAC;AAEvD,OAAO,EAAE,eAAe,EAAE,MAAM,sBAAsB,CAAC;AAIvD,SAAS,eAAe,CAAC,SAAiC;IACzD,OAAO,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC;SAC3B,MAAM,CAAC,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE;;QACtB,MAAA,SAAS,CAAC,KAAwB,CAAC,0CAAE,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,KAAwB,CAAC,CAAC;QACzF,OAAO,GAAG,CAAC;IACZ,CAAC,EAAE,EAAsC,CAAC,CAAC;AAC7C,CAAC;AAED;;;;;;;;;;;GAWG;AACH,MAAM,UAAU,gBAAgB,CAAC,IAAc,EAAE,eAAwC;IACxF,MAAM,MAAM,GAAG,EAAuC,CAAC;IAEvD,IAAI,CAAC,IAAI,EAAE,CAAC;QACX,OAAO,MAAM,CAAC;IACf,CAAC;IAED,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAc,CAAC;IAC5C,MAAM,MAAM,GAAG,eAAe,CAAC,CAAC,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,EAAsC,CAAC;IAE3G,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,GAAsC,EAAE,GAAY,EAAE,EAAE;;QAC3E,MAAM,KAAK,GAAG,eAAe,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,GAAG,CAAC,IAAI,eAAe,CAAC,OAAO,CAAC;QAC7E,MAAM,IAAI,SAAG,GAAG,CAAC,KAAK,qCAAT,GAAG,CAAC,KAAK,IAAM,EAAE,CAAA,CAAC;QAC9B,IAAY,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;QAC/B,OAAO,GAAG,CAAC;IACZ,CAAC,EAAE,MAAM,CAAC,CAAC;AACZ,CAAC","sourcesContent":["import { CMCD_HEADER_MAP } from './CMCD_HEADER_MAP.js';\nimport type { CmcdData } from './CmcdData.js';\nimport { CmcdHeaderField } from './CmcdHeaderField.js';\nimport type { CmcdHeaderMap } from './CmcdHeaderMap.js';\nimport type { CmcdKey } from './CmcdKey.js';\n\nfunction createHeaderMap(headerMap: Partial<CmcdHeaderMap>): Record<CmcdKey, CmcdHeaderField> {\n\treturn Object.keys(headerMap)\n\t\t.reduce((acc, field) => {\n\t\t\theaderMap[field as CmcdHeaderField]?.forEach(key => acc[key] = field as CmcdHeaderField);\n\t\t\treturn acc;\n\t\t}, {} as Record<CmcdKey, CmcdHeaderField>);\n}\n\n/**\n * Group a CMCD data object into header shards\n *\n * @param cmcd - The CMCD data object to convert.\n * @param customHeaderMap - A map of CMCD header fields to custom CMCD keys.\n *\n * @returns The CMCD header shards.\n *\n * @group CMCD\n *\n * @beta\n */\nexport function groupCmcdHeaders(cmcd: CmcdData, customHeaderMap?: Partial<CmcdHeaderMap>): Record<CmcdHeaderField, CmcdData> {\n\tconst result = {} as Record<CmcdHeaderField, CmcdData>;\n\n\tif (!cmcd) {\n\t\treturn result;\n\t}\n\n\tconst keys = Object.keys(cmcd) as CmcdKey[];\n\tconst custom = customHeaderMap ? createHeaderMap(customHeaderMap) : {} as Record<CmcdKey, CmcdHeaderField>;\n\n\treturn keys.reduce((acc: Record<CmcdHeaderField, CmcdData>, key: CmcdKey) => {\n\t\tconst field = CMCD_HEADER_MAP[key] || custom[key] || CmcdHeaderField.REQUEST;\n\t\tconst data = acc[field] ??= {};\n\t\t(data as any)[key] = cmcd[key];\n\t\treturn acc;\n\t}, result);\n}\n"]}