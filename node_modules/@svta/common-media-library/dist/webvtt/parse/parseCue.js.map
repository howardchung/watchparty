{"version":3,"file":"parseCue.js","sourceRoot":"","sources":["../../../src/webvtt/parse/parseCue.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,kBAAkB,EAAE,MAAM,0BAA0B,CAAC;AAE9D,OAAO,EAAE,YAAY,EAAE,MAAM,mBAAmB,CAAC;AACjD,OAAO,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAC;AACrD,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AAEzC,MAAM,aAAa,GAAG,uBAAuB,CAAC;AAE9C,MAAM,UAAU,QAAQ,CAAC,KAAa,EAAE,GAAc,EAAE,UAA0B;IACjF,4DAA4D;IAC5D,MAAM,MAAM,GAAG,KAAK,CAAC;IACrB,uBAAuB;IACvB,SAAS,gBAAgB;QACxB,MAAM,EAAE,GAAG,cAAc,CAAC,KAAK,CAAC,CAAC;QACjC,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC;YACjB,MAAM,IAAI,kBAAkB,CAAC,aAAa,GAAG,MAAM,CAAC,CAAC;QACtD,CAAC;QACD,gCAAgC;QAChC,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAAC;QAC5C,OAAO,EAAE,CAAC;IACX,CAAC;IAED,4BAA4B;IAC5B,SAAS,kBAAkB,CAAC,KAAa,EAAE,GAAc;QACxD,MAAM,QAAQ,GAAG,IAAI,QAAQ,EAAE,CAAC;QAEhC,YAAY,CAAC,KAAK,EAAE,UAAU,CAAC,EAAE,CAAC;YACjC,QAAQ,CAAC,EAAE,CAAC;gBACX,KAAK,QAAQ,CAAC,CAAC,CAAC;oBACf,0DAA0D;oBAC1D,KAAK,IAAI,CAAC,GAAG,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;wBACjD,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,EAAE,CAAC;4BAC5B,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;4BAC/B,MAAM;wBACP,CAAC;oBACF,CAAC;oBACD,MAAM;gBACP,CAAC;gBACD,KAAK,UAAU,CAAC,CAAC,CAAC;oBACjB,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;oBACjC,MAAM;gBACP,CAAC;gBACD,KAAK,MAAM,CAAC,CAAC,CAAC;oBACb,MAAM,IAAI,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC1B,MAAM,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;oBACtB,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;oBAC3B,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;oBACvE,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;oBACjC,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;wBACvB,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC;oBAChE,CAAC;oBACD,MAAM;gBACP,CAAC;gBACD,KAAK,UAAU,CAAC,CAAC,CAAC;oBACjB,MAAM,IAAI,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC1B,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC7B,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;wBACvB,QAAQ,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,WAAW,EAAE,QAAQ,EAAE,YAAY,EAAE,MAAM,CAAC,CAAC,CAAC;oBACvF,CAAC;oBACD,MAAM;gBACP,CAAC;gBACD,KAAK,MAAM,CAAC,CAAC,CAAC;oBACb,QAAQ,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBACvB,MAAM;gBACP,CAAC;gBACD,KAAK,OAAO,CAAC,CAAC,CAAC;oBACd,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC,CAAC;oBAChE,MAAM;gBACP,CAAC;YACF,CAAC;QACF,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;QAEd,+CAA+C;QAC/C,GAAG,CAAC,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QAC1C,GAAG,CAAC,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;QAC5C,IAAI,CAAC;YACJ,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QACzC,CAAC;QACD,OAAO,CAAC,EAAE,CAAC;YACV,qBAAqB;QACtB,CAAC;QACD,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;QACnD,GAAG,CAAC,WAAW,GAAG,QAAQ,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QACpD,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;QACrC,iEAAiE;QACjE,IAAI,CAAC;YACJ,GAAG,CAAC,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;QAC7C,CAAC;QACD,OAAO,CAAC,EAAE,CAAC;YACV,GAAG,CAAC,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,OAAO,EAAE,QAAwB,CAAC,CAAC;QAC7D,CAAC;QACD,IAAI,CAAC;YACJ,GAAG,CAAC,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;QACjD,CAAC;QACD,OAAO,CAAC,EAAE,CAAC;YACV,MAAM,SAAS,GAAG;gBACjB,KAAK,EAAE,CAAC;gBACR,IAAI,EAAE,CAAC;gBACP,MAAM,EAAE,EAAE;gBACV,MAAM,EAAE,EAAE;gBACV,GAAG,EAAE,GAAG;gBACR,KAAK,EAAE,GAAG;aACV,CAAC;YAEF,GAAG,CAAC,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,EAAE,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;QAC/D,CAAC;QAED,GAAG,CAAC,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;IAC3D,CAAC;IAED,SAAS,cAAc;QACtB,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;IACnC,CAAC;IAED,0BAA0B;IAC1B,cAAc,EAAE,CAAC;IACjB,GAAG,CAAC,SAAS,GAAG,gBAAgB,EAAE,CAAC,CAAG,6BAA6B;IACnE,cAAc,EAAE,CAAC;IACjB,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,EAAE,CAAC,CAAK,uCAAuC;QAC9E,MAAM,IAAI,kBAAkB,CAAC,aAAa,GAAG,6CAA6C,CAAC,CAAC;IAC7F,CAAC;IACD,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;IACxB,cAAc,EAAE,CAAC;IACjB,GAAG,CAAC,OAAO,GAAG,gBAAgB,EAAE,CAAC,CAAK,2BAA2B;IAEjE,gCAAgC;IAChC,cAAc,EAAE,CAAC;IACjB,kBAAkB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;AAChC,CAAC","sourcesContent":["import type { WebVttCue } from '../WebVttCue.js';\nimport { WebVttParsingError } from '../WebVttParsingError.js';\nimport type { WebVttRegion } from '../WebVttRegion.js';\nimport { parseOptions } from './parseOptions.js';\nimport { parseTimeStamp } from './parseTimestamp.js';\nimport { Settings } from './Settings.js';\n\nconst BAD_TIMESTAMP = 'Malformed time stamp.';\n\nexport function parseCue(input: string, cue: WebVttCue, regionList: WebVttRegion[]): void {\n\t// Remember the original input if we need to throw an error.\n\tconst oInput = input;\n\t// 4.1 WebVTT timestamp\n\tfunction consumeTimeStamp() {\n\t\tconst ts = parseTimeStamp(input);\n\t\tif (ts === null) {\n\t\t\tthrow new WebVttParsingError(BAD_TIMESTAMP + oInput);\n\t\t}\n\t\t// Remove time stamp from input.\n\t\tinput = input.replace(/^[^\\sa-zA-Z-]+/, '');\n\t\treturn ts;\n\t}\n\n\t// 4.4.2 WebVTT cue settings\n\tfunction consumeCueSettings(input: string, cue: WebVttCue): void {\n\t\tconst settings = new Settings();\n\n\t\tparseOptions(input, function (k, v) {\n\t\t\tswitch (k) {\n\t\t\t\tcase 'region': {\n\t\t\t\t\t// Find the last region we parsed with the same region id.\n\t\t\t\t\tfor (let i = regionList.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (regionList[i].id === v) {\n\t\t\t\t\t\t\tsettings.set(k, regionList[i]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'vertical': {\n\t\t\t\t\tsettings.alt(k, v, ['rl', 'lr']);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'line': {\n\t\t\t\t\tconst vals = v.split(',');\n\t\t\t\t\tconst vals0 = vals[0];\n\t\t\t\t\tsettings.integer(k, vals0);\n\t\t\t\t\tsettings.percent(k, vals0) ? settings.set('snapToLines', false) : null;\n\t\t\t\t\tsettings.alt(k, vals0, ['auto']);\n\t\t\t\t\tif (vals.length === 2) {\n\t\t\t\t\t\tsettings.alt('lineAlign', vals[1], ['start', 'center', 'end']);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'position': {\n\t\t\t\t\tconst vals = v.split(',');\n\t\t\t\t\tsettings.percent(k, vals[0]);\n\t\t\t\t\tif (vals.length === 2) {\n\t\t\t\t\t\tsettings.alt('positionAlign', vals[1], ['line-left', 'center', 'line-right', 'auto']);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'size': {\n\t\t\t\t\tsettings.percent(k, v);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'align': {\n\t\t\t\t\tsettings.alt(k, v, ['start', 'center', 'end', 'left', 'right']);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}, /:/, /\\s/);\n\n\t\t// Apply default values for any missing fields.\n\t\tcue.region = settings.get('region', null);\n\t\tcue.vertical = settings.get('vertical', '');\n\t\ttry {\n\t\t\tcue.line = settings.get('line', 'auto');\n\t\t}\n\t\tcatch (e) {\n\t\t\t// eslint-ignore-line\n\t\t}\n\t\tcue.lineAlign = settings.get('lineAlign', 'start');\n\t\tcue.snapToLines = settings.get('snapToLines', true);\n\t\tcue.size = settings.get('size', 100);\n\t\t// Safari still uses the old middle value and won't accept center\n\t\ttry {\n\t\t\tcue.align = settings.get('align', 'center');\n\t\t}\n\t\tcatch (e) {\n\t\t\tcue.align = settings.get('align', 'middle' as AlignSetting);\n\t\t}\n\t\ttry {\n\t\t\tcue.position = settings.get('position', 'auto');\n\t\t}\n\t\tcatch (e) {\n\t\t\tconst positions = {\n\t\t\t\tstart: 0,\n\t\t\t\tleft: 0,\n\t\t\t\tcenter: 50,\n\t\t\t\tmiddle: 50,\n\t\t\t\tend: 100,\n\t\t\t\tright: 100,\n\t\t\t};\n\n\t\t\tcue.position = settings.get('position', positions[cue.align]);\n\t\t}\n\n\t\tcue.positionAlign = settings.get('positionAlign', 'auto');\n\t}\n\n\tfunction skipWhitespace() {\n\t\tinput = input.replace(/^\\s+/, '');\n\t}\n\n\t// 4.1 WebVTT cue timings.\n\tskipWhitespace();\n\tcue.startTime = consumeTimeStamp();   // (1) collect cue start time\n\tskipWhitespace();\n\tif (input.substr(0, 3) !== '-->') {     // (3) next characters must match \"-->\"\n\t\tthrow new WebVttParsingError(BAD_TIMESTAMP + \" (time stamps must be separated by '-->'): \");\n\t}\n\tinput = input.substr(3);\n\tskipWhitespace();\n\tcue.endTime = consumeTimeStamp();     // (5) collect cue end time\n\n\t// 4.1 WebVTT cue settings list.\n\tskipWhitespace();\n\tconsumeCueSettings(input, cue);\n}\n"]}