{"version":3,"file":"WebVttTransformer.js","sourceRoot":"","sources":["../../src/webvtt/WebVttTransformer.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,YAAY,EAAE,MAAM,mBAAmB,CAAC;AAEjD,OAAO,EAAE,gBAAgB,EAAE,MAAM,uBAAuB,CAAC;AAEzD;;;;;;GAMG;AACH,MAAM,OAAO,iBAAiB;IAI7B;;OAEG;IACH;QALQ,YAAO,GAAmB,EAAE,CAAC;QAMpC,IAAI,CAAC,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;QACjC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,gBAAgB,CAAC,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;QACxF,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,gBAAgB,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;QACpG,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,gBAAgB,CAAC,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;QAChG,IAAI,CAAC,MAAM,CAAC,cAAc,GAAG,YAAY,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,gBAAgB,CAAC,aAAa,EAAE,IAAI,EAAE,YAAY,EAAE,CAAC,CAAC;QAC7H,IAAI,CAAC,MAAM,CAAC,cAAc,GAAG,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,gBAAgB,CAAC,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;IACxG,CAAC;IAEO,cAAc,CAAC,UAA0D;QAChF,mCAAmC;QACnC,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACnC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAC5B,CAAC;QAED,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;IACnB,CAAC;IAED;;;;;OAKG;IACH,SAAS,CAAC,KAAa,EAAE,UAA0D;QAClF,IAAI,CAAC;YACJ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACzB,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;QACjC,CAAC;QACD,OAAO,KAAK,EAAE,CAAC;YACd,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACzB,CAAC;IACF,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,UAA0D;QAC/D,IAAI,CAAC;YACJ,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;YACpB,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;QACjC,CAAC;QACD,OAAO,KAAK,EAAE,CAAC;YACd,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACzB,CAAC;IACF,CAAC;CACD","sourcesContent":["import { WebVttParser } from './WebVttParser.js';\nimport type { WebVttResult } from './WebVttResult.js';\nimport { WebVttResultType } from './WebVttResultType.js';\n\n/**\n * WebVTT transform stream transformer.\n *\n * @group WebVTT\n *\n * @beta\n */\nexport class WebVttTransformer {\n\tprivate readonly parser: WebVttParser;\n\tprivate results: WebVttResult[] = [];\n\n\t/**\n\t * Creates a new WebVTT transformer.\n\t */\n\tconstructor() {\n\t\tthis.parser = new WebVttParser();\n\t\tthis.parser.oncue = cue => this.results.push({ type: WebVttResultType.CUE, data: cue });\n\t\tthis.parser.onregion = region => this.results.push({ type: WebVttResultType.REGION, data: region });\n\t\tthis.parser.onstyle = style => this.results.push({ type: WebVttResultType.STYLE, data: style });\n\t\tthis.parser.ontimestampmap = timestampmap => this.results.push({ type: WebVttResultType.TIMESTAMP_MAP, data: timestampmap });\n\t\tthis.parser.onparsingerror = error => this.results.push({ type: WebVttResultType.ERROR, data: error });\n\t}\n\n\tprivate enqueueResults(controller: TransformStreamDefaultController<WebVttResult>): void {\n\t\t// TODO: Should parse errors throw?\n\t\tfor (const result of this.results) {\n\t\t\tcontroller.enqueue(result);\n\t\t}\n\n\t\tthis.results = [];\n\t}\n\n\t/**\n\t * Transforms a chunk of WebVTT data.\n\t *\n\t * @param chunk - The chunk of WebVTT data to transform.\n\t * @param controller - The controller to enqueue the results to.\n\t */\n\ttransform(chunk: string, controller: TransformStreamDefaultController<WebVttResult>): void {\n\t\ttry {\n\t\t\tthis.parser.parse(chunk);\n\t\t\tthis.enqueueResults(controller);\n\t\t}\n\t\tcatch (error) {\n\t\t\tcontroller.error(error);\n\t\t}\n\t}\n\n\t/**\n\t * Flushes the transformer.\n\t *\n\t * @param controller - The controller to enqueue the results to.\n\t */\n\tflush(controller: TransformStreamDefaultController<WebVttResult>): void {\n\t\ttry {\n\t\t\tthis.parser.flush();\n\t\t\tthis.enqueueResults(controller);\n\t\t}\n\t\tcatch (error) {\n\t\t\tcontroller.error(error);\n\t\t}\n\t}\n}\n"]}