{"version":3,"file":"extractCta608DataFromSample.js","sourceRoot":"","sources":["../../../src/cta/608/extractCta608DataFromSample.ts"],"names":[],"mappings":"AAAA,OAAO,EACN,UAAU,EACV,gBAAgB,EAChB,sBAAsB,GACtB,MAAM,uBAAuB,CAAC;AAE/B;;;;;;;;;;GAUG;AACH,MAAM,UAAU,2BAA2B,CAAC,GAAa,EAAE,QAAgB,EAAE,UAAkB;IAC9F,IAAI,OAAO,GAAW,CAAC,CAAC;IACxB,IAAI,OAAO,GAAW,CAAC,CAAC;IACxB,MAAM,SAAS,GAAe,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;IAEvC,KAAK,IAAI,MAAM,GAAG,QAAQ,EAAE,MAAM,GAAG,QAAQ,GAAG,UAAU,GAAG,CAAC,EAAE,MAAM,EAAE,EAAE,CAAC;QAC1E,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAChC,OAAO,GAAG,GAAG,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;QAE1C,2CAA2C;QAC3C,IAAI,MAAM,GAAG,CAAC,GAAG,OAAO,GAAG,QAAQ,GAAG,UAAU,EAAE,CAAC;YAClD,MAAM;QACP,CAAC;QAED,oEAAoE;QACpE,IAAI,gBAAgB,CAAC,OAAO,CAAC,EAAE,CAAC;YAC/B,IAAI,MAAM,GAAG,CAAC,GAAG,OAAO,IAAI,GAAG,CAAC,UAAU,EAAE,CAAC;gBAC5C,MAAM,OAAO,GAAG,UAAU,CAAC,GAAG,EAAE,MAAM,GAAG,CAAC,EAAE,MAAM,GAAG,CAAC,GAAG,OAAO,CAAC,CAAC;gBAClE,sBAAsB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;YAC5C,CAAC;QACF,CAAC;QAED,4BAA4B;QAC5B,MAAM,IAAI,OAAO,GAAG,CAAC,CAAC;IACvB,CAAC;IACD,OAAO,SAAS,CAAC;AAClB,CAAC","sourcesContent":["import {\n\tgetSeiData,\n\tisSeiNalUnitType,\n\tparseCta608DataFromSei,\n} from './utils/seiHelpers.js';\n\n/**\n * Extracts CEA-608 data from a given sample.\n *\n * @param raw - The DataView with media data\n * @param startPos - The start position within the DataView\n * @param sampleSize - The size of the sample in bytes\n * @returns fieldData array containing field 1 and field 2 data arrays\n *\n * @group CTA-608\n * @beta\n */\nexport function extractCta608DataFromSample(raw: DataView, startPos: number, sampleSize: number): number[][] {\n\tlet nalSize: number = 0;\n\tlet nalType: number = 0;\n\tconst fieldData: number[][] = [[], []];\n\n\tfor (let cursor = startPos; cursor < startPos + sampleSize - 5; cursor++) {\n\t\tnalSize = raw.getUint32(cursor);\n\t\tnalType = raw.getUint8(cursor + 4) & 0x1F;\n\n\t\t// Make sure that we don't go out of bounds\n\t\tif (cursor + 5 + nalSize > startPos + sampleSize) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// Only process Supplemental Enhancement Information (SEI) NAL units\n\t\tif (isSeiNalUnitType(nalType)) {\n\t\t\tif (cursor + 5 + nalSize <= raw.byteLength) {\n\t\t\t\tconst seiData = getSeiData(raw, cursor + 5, cursor + 5 + nalSize);\n\t\t\t\tparseCta608DataFromSei(seiData, fieldData);\n\t\t\t}\n\t\t}\n\n\t\t// Jump to the next NAL unit\n\t\tcursor += nalSize + 3;\n\t}\n\treturn fieldData;\n}\n"]}