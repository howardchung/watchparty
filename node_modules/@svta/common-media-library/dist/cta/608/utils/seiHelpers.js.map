{"version":3,"file":"seiHelpers.js","sourceRoot":"","sources":["../../../../src/cta/608/utils/seiHelpers.ts"],"names":[],"mappings":"AAAA,MAAM,UAAU,UAAU,CAAC,GAAa,EAAE,QAAgB,EAAE,MAAc;IACzE,MAAM,IAAI,GAAa,EAAE,CAAC;IAE1B,KAAK,IAAI,MAAM,GAAG,QAAQ,EAAE,MAAM,GAAG,MAAM,EAAE,MAAM,EAAE,EAAE,CAAC;QACvD,IAAI,MAAM,GAAG,CAAC,GAAG,MAAM,IAAI,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,IAAI,GAAG,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,IAAI,IAAI,GAAG,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,IAAI,EAAE,CAAC;YACpI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAChB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAChB,MAAM,IAAI,CAAC,CAAC;QACb,CAAC;aACI,CAAC;YACL,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;QACjC,CAAC;IACF,CAAC;IAED,OAAO,IAAI,QAAQ,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC;AAClD,CAAC;AAED,MAAM,UAAU,WAAW,CAAC,WAAmB,EAAE,WAAmB,EAAE,GAAa,EAAE,GAAW;IAC/F,IAAI,WAAW,KAAK,CAAC,IAAI,WAAW,GAAG,CAAC,EAAE,CAAC;QAC1C,OAAO,KAAK,CAAC;IACd,CAAC;IAED,MAAM,WAAW,GAAG,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;IACtC,IAAI,WAAW,KAAK,IAAI,EAAE,CAAC;QAC1B,OAAO,KAAK,CAAC;IACd,CAAC;IAED,MAAM,YAAY,GAAG,GAAG,CAAC,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;IAC5C,IAAI,YAAY,KAAK,MAAM,EAAE,CAAC;QAC7B,OAAO,KAAK,CAAC;IACd,CAAC;IAED,MAAM,cAAc,GAAG,GAAG,CAAC,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;IAC9C,IAAI,cAAc,KAAK,UAAU,EAAE,CAAC;QACnC,OAAO,KAAK,CAAC;IACd,CAAC;IAED,MAAM,gBAAgB,GAAG,GAAG,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;IAC/C,IAAI,gBAAgB,KAAK,IAAI,EAAE,CAAC;QAC/B,OAAO,KAAK,CAAC;IACd,CAAC;IAED,OAAO,IAAI,CAAC;AACb,CAAC;AAED,MAAM,UAAU,QAAQ,CAAC,IAAY;IACpC,OAAO,IAAI,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,CAAC;AACjC,CAAC;AAED,MAAM,UAAU,gBAAgB,CAAC,OAAe,EAAE,OAAe;IAChE,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;AACrD,CAAC;AAED,MAAM,UAAU,gBAAgB,CAAC,QAAgB;IAChD,OAAO,QAAQ,KAAK,IAAI,CAAC;AAC1B,CAAC;AAED,MAAM,UAAU,sBAAsB,CAAC,GAAa,EAAE,SAAqB;IAC1E,IAAI,MAAM,GAAG,CAAC,CAAC;IACf,OAAO,MAAM,GAAG,GAAG,CAAC,UAAU,EAAE,CAAC;QAChC,IAAI,WAAW,GAAG,CAAC,CAAC;QACpB,IAAI,WAAW,GAAG,CAAC,CAAC;QACpB,IAAI,GAAG,CAAC;QAER,GAAG,CAAC;YACH,WAAW,IAAI,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;QAC7C,CAAC,QAAQ,GAAG,KAAK,IAAI,EAAE;QACvB,GAAG,CAAC;YACH,WAAW,IAAI,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC;QAC7C,CAAC,QAAQ,GAAG,KAAK,IAAI,EAAE;QAEvB,IAAI,WAAW,CAAC,WAAW,EAAE,WAAW,EAAE,GAAG,EAAE,MAAM,CAAC,EAAE,CAAC;YACxD,MAAM,GAAG,GAAG,MAAM,GAAG,EAAE,CAAC;YACxB,MAAM,OAAO,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;YACzD,KAAK,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC,GAAG,OAAO,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC;gBACvC,MAAM,IAAI,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBAC7B,IAAI,IAAI,GAAG,IAAI,EAAE,CAAC;oBACjB,MAAM,MAAM,GAAG,IAAI,GAAG,IAAI,CAAC;oBAC3B,IAAI,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;wBACtB,MAAM,OAAO,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;wBACpC,MAAM,OAAO,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;wBACpC,IAAI,gBAAgB,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC;4BACxC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;wBAC1C,CAAC;oBACF,CAAC;gBACF,CAAC;YACF,CAAC;QACF,CAAC;QACD,MAAM,IAAI,WAAW,CAAC;IACvB,CAAC;AACF,CAAC","sourcesContent":["export function getSeiData(raw: DataView, startPos: number, endPos: number): DataView {\n\tconst data: number[] = [];\n\n\tfor (let cursor = startPos; cursor < endPos; cursor++) {\n\t\tif (cursor + 2 < endPos && raw.getUint8(cursor) === 0x00 && raw.getUint8(cursor + 1) === 0x00 && raw.getUint8(cursor + 2) === 0x03) {\n\t\t\tdata.push(0x00);\n\t\t\tdata.push(0x00);\n\t\t\tcursor += 2;\n\t\t} \n\t\telse {\n\t\t\tdata.push(raw.getUint8(cursor));\n\t\t}\n\t}\n\n\treturn new DataView(new Uint8Array(data).buffer);\n}\n\nexport function isCea608Sei(payloadType: number, payloadSize: number, sei: DataView, pos: number): boolean {\n\tif (payloadType !== 4 || payloadSize < 8) {\n\t\treturn false;\n\t}\n\n\tconst countryCode = sei.getUint8(pos);\n\tif (countryCode !== 0xB5) {\n\t\treturn false;\n\t}\n\n\tconst providerCode = sei.getUint16(pos + 1);\n\tif (providerCode !== 0x0031) {\n\t\treturn false;\n\t}\n\n\tconst userIdentifier = sei.getUint32(pos + 3);\n\tif (userIdentifier !== 0x47413934) {\n\t\treturn false;\n\t}\n\n\tconst userDataTypeCode = sei.getUint8(pos + 7);\n\tif (userDataTypeCode !== 0x03) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport function isCCType(type: number): boolean {\n\treturn type === 0 || type === 1;\n}\n\nexport function isNonEmptyCCData(ccData1: number, ccData2: number): boolean {\n\treturn (ccData1 & 0x7F) > 0 || (ccData2 & 0x7F) > 0;\n}\n\nexport function isSeiNalUnitType(unitType: number): boolean {\n\treturn unitType === 0x06;\n}\n\nexport function parseCta608DataFromSei(sei: DataView, fieldData: number[][]): void {\n\tlet cursor = 0;\n\twhile (cursor < sei.byteLength) {\n\t\tlet payloadType = 0;\n\t\tlet payloadSize = 0;\n\t\tlet now;\n\n\t\tdo {\n\t\t\tpayloadType += now = sei.getUint8(cursor++);\n\t\t} while (now === 0xFF);\n\t\tdo {\n\t\t\tpayloadSize += now = sei.getUint8(cursor++);\n\t\t} while (now === 0xFF);\n\n\t\tif (isCea608Sei(payloadType, payloadSize, sei, cursor)) {\n\t\t\tconst pos = cursor + 10;\n\t\t\tconst ccCount = pos + (sei.getUint8(pos - 2) & 0x1F) * 3;\n\t\t\tfor (let i = pos; i < ccCount; i += 3) {\n\t\t\t\tconst byte = sei.getUint8(i);\n\t\t\t\tif (byte & 0x04) {\n\t\t\t\t\tconst ccType = byte & 0x03;\n\t\t\t\t\tif (isCCType(ccType)) {\n\t\t\t\t\t\tconst ccData1 = sei.getUint8(i + 1);\n\t\t\t\t\t\tconst ccData2 = sei.getUint8(i + 2);\n\t\t\t\t\t\tif (isNonEmptyCCData(ccData1, ccData2)) {\n\t\t\t\t\t\t\tfieldData[ccType].push(ccData1, ccData2);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcursor += payloadSize;\n\t}\n}\n"]}