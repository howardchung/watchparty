{"version":3,"file":"WebVttParser.js","sourceRoot":"","sources":["../../../src/webvtt/WebVttParser.ts"],"names":[],"mappings":"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","sourcesContent":["import { createWebVttCue } from './createWebVttCue.js';\nimport { createWebVttRegion } from './createWebVttRegion.js';\nimport { parseCue } from './parse/parseCue.js';\nimport { parseOptions } from './parse/parseOptions.js';\nimport { parseTimeStamp } from './parse/parseTimestamp.js';\nimport { Settings } from './parse/Settings.js';\nimport { WebVttParserState } from './parse/WebVttParserState.js';\nimport type { TimestampMap } from './TimestampMap.js';\nimport type { WebVttCue } from './WebVttCue.js';\nimport type { WebVttCueFactory } from './WebVttCueFactory.js';\nimport type { WebVttParserOptions } from './WebVttParserOptions.js';\nimport { WebVttParsingError } from './WebVttParsingError.js';\nimport type { WebVttRegion } from './WebVttRegion.js';\nimport type { WebVttRegionFactory } from './WebVttRegionFactory.js';\n\nconst BAD_SIGNATURE = 'Malformed WebVTT signature.';\nconst createCue = (): WebVttCue => typeof VTTCue !== 'undefined' ? new VTTCue(0, 0, '') : createWebVttCue();\nconst createRegion = (): WebVttRegion => typeof VTTRegion !== 'undefined' ? new VTTRegion() : createWebVttRegion();\n\n/**\n * A WebVTT parser.\n *\n * @group WebVTT\n *\n * @beta\n *\n * @example\n * {@includeCode ../../test/webvtt/WebVttParser.test.ts#example}\n *\n * @see {@link https://www.w3.org/TR/webvtt1/ | WebVTT Specification}\n */\nexport class WebVttParser {\n\tprivate state: WebVttParserState;\n\tprivate buffer: string;\n\tprivate regionList: WebVttRegion[];\n\tprivate regionSettings: Settings | null = null;\n\tprivate style: string;\n\tprivate cue: WebVttCue | null = null;\n\tprivate createCue: WebVttCueFactory;\n\tprivate createRegion: WebVttRegionFactory;\n\n\t/**\n\t * A callback function that is called when a parsing error occurs.\n\t */\n\tonparsingerror?: (error: WebVttParsingError) => void;\n\n\t/**\n\t * A callback function that is called when a region is parsed.\n\t */\n\tonregion?: (region: WebVttRegion) => void;\n\n\t/**\n\t * A callback function that is called when a timestamp map is parsed.\n\t */\n\tontimestampmap?: (timestampMap: TimestampMap) => void;\n\n\t/**\n\t * A callback function that is called when a cue is parsed.\n\t */\n\toncue?: (cue: WebVttCue) => void;\n\n\t/**\n\t * A callback function that is called when a style is parsed.\n\t */\n\tonstyle?: (style: string) => void;\n\n\t/**\n\t * A callback function that is called when the parser is flushed.\n\t */\n\tonflush?: () => void;\n\n\t/**\n\t * Create a new WebVTT parser.\n\t *\n\t * @param options - The options to use for the parser.\n\t */\n\tconstructor(options: WebVttParserOptions = {}) {\n\t\tconst useDomTypes = options.useDomTypes ?? true;\n\t\tthis.createCue = options.createCue || useDomTypes ? createCue : createWebVttCue;\n\t\tthis.createRegion = options.createRegion || useDomTypes ? createRegion : createWebVttRegion;\n\n\t\tthis.state = WebVttParserState.INITIAL;\n\t\tthis.buffer = '';\n\t\tthis.style = '';\n\t\tthis.regionList = [];\n\t}\n\n\t/**\n\t * Parse the given data.\n\t *\n\t * @param data - The data to parse.\n\t * @param reuseCue - Whether to reuse the cue.\n\t * @returns The parser.\n\t */\n\tparse(data?: string, reuseCue: boolean = false): WebVttParser {\n\t\t// If there is no data then we will just try to parse whatever is in buffer already.\n\t\t// This may occur in circumstances, for example when flush() is called.\n\t\tif (data) {\n\t\t\tthis.buffer += data;\n\t\t}\n\n\t\tconst collectNextLine = (): string => {\n\t\t\tconst buffer = this.buffer;\n\t\t\tlet pos = 0;\n\t\t\twhile (pos < buffer.length && buffer[pos] !== '\\r' && buffer[pos] !== '\\n') {\n\t\t\t\t++pos;\n\t\t\t}\n\t\t\tconst line = buffer.substr(0, pos);\n\t\t\t// Advance the buffer early in case we fail below.\n\t\t\tif (buffer[pos] === '\\r') {\n\t\t\t\t++pos;\n\t\t\t}\n\t\t\tif (buffer[pos] === '\\n') {\n\t\t\t\t++pos;\n\t\t\t}\n\t\t\tthis.buffer = buffer.substr(pos);\n\t\t\treturn line;\n\t\t};\n\n\t\t// draft-pantos-http-live-streaming-20\n\t\t// https://tools.ietf.org/html/draft-pantos-http-live-streaming-20#section-3.5\n\t\t// 3.5 WebVTT\n\t\tconst parseTimestampMap = (input: string): void => {\n\t\t\tconst settings = new Settings();\n\n\t\t\tparseOptions(input, (k: string, v: string): void => {\n\t\t\t\tswitch (k) {\n\t\t\t\t\tcase 'MPEGT':\n\t\t\t\t\t\tsettings.integer(k + 'S', v);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'LOCA':\n\t\t\t\t\t\tsettings.set(k + 'L', parseTimeStamp(v));\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}, /[^\\d]:/, /,/);\n\n\t\t\tthis.ontimestampmap?.({\n\t\t\t\t'MPEGTS': settings.get('MPEGTS'),\n\t\t\t\t'LOCAL': settings.get('LOCAL'),\n\t\t\t});\n\t\t};\n\n\t\t// 3.2 WebVtt metadata header syntax\n\t\tconst parseHeader = (input: string): void => {\n\t\t\tif (input.match(/X-TIMESTAMP-MAP/)) {\n\t\t\t\t// This line contains HLS X-TIMESTAMP-MAP metadata\n\t\t\t\tparseOptions(input, (k: string, v: string): void => {\n\t\t\t\t\tswitch (k) {\n\t\t\t\t\t\tcase 'X-TIMESTAMP-MAP':\n\t\t\t\t\t\t\tparseTimestampMap(v);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}, /=/);\n\t\t\t}\n\t\t};\n\n\t\t// 6.1 WebVTT file parsing.\n\t\ttry {\n\t\t\tlet line!: string;\n\n\t\t\tif (this.state === WebVttParserState.INITIAL) {\n\t\t\t\t// We can't start parsing until we have the first line.\n\t\t\t\tif (!/\\r\\n|\\n/.test(this.buffer)) {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\tline = collectNextLine();\n\n\t\t\t\t// Remove the UTF-8 BOM if it exists.\n\t\t\t\tif (line.charCodeAt(0) === 0xFEFF) {\n\t\t\t\t\tline = line.slice(1);\n\t\t\t\t}\n\n\t\t\t\tconst m = line.match(/^WEBVTT([ \\t].*)?$/);\n\t\t\t\tif (!m || !m[0]) {\n\t\t\t\t\tthrow new WebVttParsingError(BAD_SIGNATURE);\n\t\t\t\t}\n\n\t\t\t\tthis.state = WebVttParserState.HEADER;\n\t\t\t}\n\n\t\t\tlet alreadyCollectedLine = false;\n\t\t\tvar sawCue = reuseCue;\n\n\t\t\tif (!reuseCue) {\n\t\t\t\tthis.cue = null;\n\t\t\t\tthis.regionSettings = null;\n\t\t\t}\n\n\t\t\twhile (this.buffer) {\n\t\t\t\t// We can't parse a line until we have the full line.\n\t\t\t\tif (!/\\r\\n|\\n/.test(this.buffer)) {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\tif (!alreadyCollectedLine) {\n\t\t\t\t\tline = collectNextLine();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\talreadyCollectedLine = false;\n\t\t\t\t}\n\n\t\t\t\tswitch (this.state) {\n\t\t\t\t\tcase WebVttParserState.HEADER:\n\t\t\t\t\t\t// 13-18 - Allow a header (metadata) under the WEBVTT line.\n\t\t\t\t\t\tif (/:/.test(line)) {\n\t\t\t\t\t\t\tparseHeader(line);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!line) {\n\t\t\t\t\t\t\t// An empty line terminates the header and blocks section.\n\t\t\t\t\t\t\tthis.state = WebVttParserState.BLOCKS;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase WebVttParserState.REGION:\n\t\t\t\t\t\tif (!line && this.regionSettings) {\n\t\t\t\t\t\t\t// create the region\n\t\t\t\t\t\t\tconst region = this.createRegion();\n\t\t\t\t\t\t\tregion.id = this.regionSettings.get('id', '');\n\t\t\t\t\t\t\tregion.width = this.regionSettings.get('width', 100);\n\t\t\t\t\t\t\tregion.lines = this.regionSettings.get('lines', 3);\n\t\t\t\t\t\t\tregion.regionAnchorX = this.regionSettings.get('regionanchorX', 0);\n\t\t\t\t\t\t\tregion.regionAnchorY = this.regionSettings.get('regionanchorY', 100);\n\t\t\t\t\t\t\tregion.viewportAnchorX = this.regionSettings.get('viewportanchorX', 0);\n\t\t\t\t\t\t\tregion.viewportAnchorY = this.regionSettings.get('viewportanchorY', 100);\n\t\t\t\t\t\t\tregion.scroll = this.regionSettings.get('scroll', '');\n\n\t\t\t\t\t\t\t// Register the region.\n\t\t\t\t\t\t\tthis.onregion?.(region);\n\n\t\t\t\t\t\t\t// Remember the VTTRegion for later in case we parse any VTTCues that reference it.\n\t\t\t\t\t\t\tthis.regionList.push(region);\n\n\t\t\t\t\t\t\t// An empty line terminates the REGION block\n\t\t\t\t\t\t\tthis.regionSettings = null;\n\t\t\t\t\t\t\tthis.state = WebVttParserState.BLOCKS;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if it's a new region block, create a new VTTRegion\n\t\t\t\t\t\tif (this.regionSettings === null) {\n\t\t\t\t\t\t\tthis.regionSettings = new Settings();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst regionSettings = this.regionSettings;\n\n\t\t\t\t\t\t// parse region options and set it as appropriate on the region\n\t\t\t\t\t\tparseOptions(line, (k, v) => {\n\t\t\t\t\t\t\tswitch (k) {\n\t\t\t\t\t\t\t\tcase 'id':\n\t\t\t\t\t\t\t\t\tregionSettings.set(k, v);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'width':\n\t\t\t\t\t\t\t\t\tregionSettings.percent(k, v);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'lines':\n\t\t\t\t\t\t\t\t\tregionSettings.integer(k, v);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'regionanchor':\n\t\t\t\t\t\t\t\tcase 'viewportanchor':\n\t\t\t\t\t\t\t\t\tconst xy = v.split(',');\n\t\t\t\t\t\t\t\t\tif (xy.length !== 2) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// We have to make sure both x and y parse, so use a temporary\n\t\t\t\t\t\t\t\t\t// settings object here.\n\t\t\t\t\t\t\t\t\tconst anchor = new Settings();\n\t\t\t\t\t\t\t\t\tanchor.percent('x', xy[0]);\n\t\t\t\t\t\t\t\t\tanchor.percent('y', xy[1]);\n\t\t\t\t\t\t\t\t\tif (!anchor.has('x') || !anchor.has('y')) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tregionSettings.set(k + 'X', anchor.get('x'));\n\t\t\t\t\t\t\t\t\tregionSettings.set(k + 'Y', anchor.get('y'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'scroll':\n\t\t\t\t\t\t\t\t\tregionSettings.alt(k, v, ['up']);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, /:/, /\\s/);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase WebVttParserState.STYLE:\n\t\t\t\t\t\tif (!line) {\n\t\t\t\t\t\t\tthis.onstyle?.(this.style);\n\t\t\t\t\t\t\tthis.style = '';\n\t\t\t\t\t\t\tthis.state = WebVttParserState.BLOCKS;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.style += line + '\\n';\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase WebVttParserState.NOTE:\n\t\t\t\t\t\t// Ignore NOTE blocks.\n\t\t\t\t\t\tif (!line) {\n\t\t\t\t\t\t\tthis.state = WebVttParserState.ID;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase WebVttParserState.BLOCKS:\n\t\t\t\t\t\tif (!line) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check for the start of a NOTE blocks\n\t\t\t\t\t\tif (/^NOTE($[ \\t])/.test(line)) {\n\t\t\t\t\t\t\tthis.state = WebVttParserState.NOTE;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check for the start of a REGION blocks\n\t\t\t\t\t\tif (/^REGION/.test(line) && !sawCue) {\n\t\t\t\t\t\t\tthis.state = WebVttParserState.REGION;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check for the start of a STYLE blocks\n\t\t\t\t\t\tif (/^STYLE/.test(line) && !sawCue) {\n\t\t\t\t\t\t\tthis.state = WebVttParserState.STYLE;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.state = WebVttParserState.ID;\n\t\t\t\t\t// Process line as an ID.\n\t\t\t\t\t/* falls through */\n\t\t\t\t\tcase WebVttParserState.ID:\n\t\t\t\t\t\t// Check for the start of NOTE blocks.\n\t\t\t\t\t\tif (/^NOTE($|[ \\t])/.test(line)) {\n\t\t\t\t\t\t\tthis.state = WebVttParserState.NOTE;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// 19-29 - Allow any number of line terminators, then initialize new cue values.\n\t\t\t\t\t\tif (!line) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsawCue = true;\n\n\t\t\t\t\t\tthis.cue = this.createCue();\n\t\t\t\t\t\tthis.cue.text ??= '';\n\n\t\t\t\t\t\tthis.state = WebVttParserState.CUE;\n\t\t\t\t\t\t// 30-39 - Check if this line contains an optional identifier or timing data.\n\t\t\t\t\t\tif (line.indexOf('-->') === -1) {\n\t\t\t\t\t\t\tthis.cue.id = line;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t// Process line as start of a cue.\n\t\t\t\t\t/*falls through*/\n\t\t\t\t\tcase WebVttParserState.CUE:\n\t\t\t\t\t\t// 40 - Collect cue timings and settings.\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tparseCue(line, this.cue!, this.regionList);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\tthis.reportOrThrowError(e);\n\t\t\t\t\t\t\t// In case of an error ignore rest of the cue.\n\t\t\t\t\t\t\tthis.cue = null;\n\t\t\t\t\t\t\tthis.state = WebVttParserState.BAD_CUE;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.state = WebVttParserState.CUE_TEXT;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase WebVttParserState.CUE_TEXT:\n\t\t\t\t\t\tconst hasSubstring = line.indexOf('-->') !== -1;\n\n\t\t\t\t\t\t// 34 - If we have an empty line then report the cue.\n\t\t\t\t\t\t// 35 - If we have the special substring '-->' then report the cue,\n\t\t\t\t\t\t// but do not collect the line as we need to process the current\n\t\t\t\t\t\t// one as a new cue.\n\t\t\t\t\t\tif (!line || hasSubstring && (alreadyCollectedLine = true)) {\n\t\t\t\t\t\t\t// We are done parsing this cue.\n\t\t\t\t\t\t\tthis.oncue?.(this.cue!);\n\t\t\t\t\t\t\tthis.cue = null;\n\t\t\t\t\t\t\tthis.state = WebVttParserState.ID;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.cue?.text) {\n\t\t\t\t\t\t\tthis.cue.text += '\\n';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.cue!.text += line.replace(/\\u2028/g, '\\n').replace(/u2029/g, '\\n');\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase WebVttParserState.BAD_CUE: // BADCUE\n\t\t\t\t\t\t// 54-62 - Collect and discard the remaining cue.\n\t\t\t\t\t\tif (!line) {\n\t\t\t\t\t\t\tthis.state = WebVttParserState.ID;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\tthis.reportOrThrowError(e);\n\n\t\t\t// If we are currently parsing a cue, report what we have.\n\t\t\tif (this.state === WebVttParserState.CUE_TEXT && this.cue && this.oncue) {\n\t\t\t\tthis.oncue(this.cue);\n\t\t\t}\n\t\t\tthis.cue = null;\n\t\t\tthis.regionSettings = null;\n\n\t\t\t// Enter BADWEBVTT state if header was not parsed correctly otherwise\n\t\t\t// another exception occurred so enter BADCUE state.\n\t\t\tthis.state = this.state === WebVttParserState.INITIAL ? WebVttParserState.BAD_WEBVTT : WebVttParserState.BAD_CUE;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Flush the parser.\n\t *\n\t * @returns The parser.\n\t */\n\tflush(): WebVttParser {\n\t\ttry {\n\t\t\t// Finish parsing the stream.\n\t\t\tthis.buffer += '';\n\t\t\t// Synthesize the end of the current cue or region.\n\t\t\tif (this.cue || this.state === WebVttParserState.HEADER) {\n\t\t\t\tthis.buffer += '\\n\\n';\n\t\t\t\tthis.parse(undefined, true);\n\t\t\t}\n\t\t\t// If we've flushed, parsed, and we're still on the INITIAL state then\n\t\t\t// that means we don't have enough of the stream to parse the first\n\t\t\t// line.\n\t\t\tif (this.state === WebVttParserState.INITIAL) {\n\t\t\t\tthrow new WebVttParsingError(BAD_SIGNATURE);\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\tthis.reportOrThrowError(e);\n\t\t}\n\n\t\tthis.onflush?.();\n\n\t\treturn this;\n\t}\n\n\t// If the error is a ParsingError then report it to the consumer if\n\t// possible. If it's not a ParsingError then throw it like normal.\n\tprivate reportOrThrowError(error: any): void {\n\t\tif (error instanceof WebVttParsingError) {\n\t\t\tthis.onparsingerror?.(error);\n\t\t}\n\t\telse {\n\t\t\tthrow error;\n\t\t}\n\t}\n}\n"]}