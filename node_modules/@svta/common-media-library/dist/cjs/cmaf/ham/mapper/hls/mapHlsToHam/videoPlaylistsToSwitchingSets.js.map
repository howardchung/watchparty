{"version":3,"file":"videoPlaylistsToSwitchingSets.js","sourceRoot":"","sources":["../../../../../../../src/cmaf/ham/mapper/hls/mapHlsToHam/videoPlaylistsToSwitchingSets.ts"],"names":[],"mappings":";;AAeA,sEA+CC;AAvDD,8DAA4E;AAC5E,gFAA0E;AAE1E,iEAA2D;AAC3D,6DAAuD;AACvD,qDAA+C;AAC/C,2DAAqD;AAErD,SAAgB,6BAA6B,CAC5C,SAAqB,EACrB,iBAA6B;IAE7B,MAAM,kBAAkB,GAAmB,EAAE,CAAC;IAC9C,MAAM,WAAW,GAAiB,EAAE,CAAC;IACrC,IAAI,YAAY,GAAG,CAAC,CAAC;IAErB,SAAS,CAAC,GAAG,CAAC,CAAC,QAAa,EAAE,EAAE;;QAC/B,MAAM,iBAAiB,GAAG,IAAA,sCAAgB,EACzC,MAAA,iBAAiB,CAAC,KAAK,EAAE,0CAAE,QAAQ,CACnC,CAAC;QACF,MAAM,QAAQ,GAAc,IAAA,kCAAc,EAAC,iBAAiB,aAAjB,iBAAiB,uBAAjB,iBAAiB,CAAE,QAAQ,CAAC,CAAC;QACxE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,QAAQ,CAAC,UAAU,CAAC;QAC5D,MAAM,GAAG,GAAG,MAAA,MAAA,iBAAiB,aAAjB,iBAAiB,uBAAjB,iBAAiB,CAAE,QAAQ,0CAAE,EAAE,CAAC,CAAC,CAAC,0CAAE,GAAG,CAAC;QACpD,MAAM,SAAS,GAAG,IAAA,8BAAY,EAAC,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,SAAS,CAAC,CAAC;QAC/C,WAAW,CAAC,IAAI,CAAC;YAChB,EAAE,EAAE,SAAS,YAAY,EAAE,EAAE;YAC7B,IAAI,EAAE,OAAO;YACb,QAAQ,EAAE,QAAQ,CAAC,GAAG;YACtB,KAAK,EAAE,IAAA,sBAAQ,EAAC,OAAO,EAAE,MAAM,CAAC;YAChC,QAAQ,EAAE,IAAA,4BAAW,EAAC,iBAAiB,EAAE,QAAQ,CAAC;YAClD,QAAQ,EAAE,QAAQ,aAAR,QAAQ,cAAR,QAAQ,GAAI,KAAK;YAC3B,SAAS,EAAE,SAAS;YACpB,QAAQ,EAAE,QAAQ;YAClB,KAAK,EAAE,QAAQ,CAAC,UAAU,CAAC,UAAU,CAAC,KAAK;YAC3C,MAAM,EAAE,QAAQ,CAAC,UAAU,CAAC,UAAU,CAAC,MAAM;YAC7C,SAAS,EAAE;gBACV,kBAAkB,EACjB,MAAA,QAAQ,CAAC,UAAU,CAAC,YAAY,CAAC,mCACjC,sCAAuB;gBACxB,oBAAoB,EAAE,mBAAI;aAC1B;YACD,GAAG,EAAE,EAAE;YACP,GAAG,EAAE,EAAE;YACP,QAAQ,EAAE,EAAE;YACZ,GAAG,CAAC,SAAS,IAAI,EAAE,SAAS,EAAE,CAAC;YAC/B,GAAG,CAAC,CAAA,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,GAAG,KAAI,EAAE,iBAAiB,EAAE,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,GAAG,EAAE,CAAC;SAClC,CAAC,CAAC;IAClB,CAAC,CAAC,CAAC;IAEH,kBAAkB,CAAC,IAAI,CAAC;QACvB,EAAE,EAAE,OAAO;QACX,MAAM,EAAE,WAAW;KACH,CAAC,CAAC;IAEnB,OAAO,kBAAkB,CAAC;AAC3B,CAAC","sourcesContent":["import type { Segment } from '../../../types/model/Segment.js';\nimport type { SwitchingSet } from '../../../types/model/SwitchingSet.js';\nimport type { VideoTrack } from '../../../types/model/VideoTrack.js';\n\nimport type { Manifest } from '../../../types/manifest/Manifest.js';\nimport type { PlayList } from '../../../types/mapper/hls/Playlist.js';\n\nimport { FRAME_RATE_NUMERATOR_30, ZERO } from '../../../utils/constants.js';\nimport { parseHlsManifest } from '../../../utils/hls/parseHlsManifest.js';\n\nimport { formatSegments } from './utils/formatSegments.js';\nimport { getByterange } from './utils/getByterange.js';\nimport { getCodec } from './utils/getCodec.js';\nimport { getDuration } from './utils/getDuration.js';\n\nexport function videoPlaylistsToSwitchingSets(\n\tplaylists: PlayList[],\n\tmanifestPlaylists: Manifest[],\n): SwitchingSet[] {\n\tconst switchingSetVideos: SwitchingSet[] = [];\n\tconst videoTracks: VideoTrack[] = [];\n\tlet videoTrackId = 0;\n\n\tplaylists.map((playlist: any) => {\n\t\tconst parsedHlsManifest = parseHlsManifest(\n\t\t\tmanifestPlaylists.shift()?.manifest,\n\t\t);\n\t\tconst segments: Segment[] = formatSegments(parsedHlsManifest?.segments);\n\t\tconst { LANGUAGE, CODECS, BANDWIDTH } = playlist.attributes;\n\t\tconst map = parsedHlsManifest?.segments?.at(0)?.map;\n\t\tconst byteRange = getByterange(map?.byterange);\n\t\tvideoTracks.push({\n\t\t\tid: `video-${videoTrackId++}`,\n\t\t\ttype: 'video',\n\t\t\tfileName: playlist.uri,\n\t\t\tcodec: getCodec('video', CODECS),\n\t\t\tduration: getDuration(parsedHlsManifest, segments),\n\t\t\tlanguage: LANGUAGE ?? 'und',\n\t\t\tbandwidth: BANDWIDTH,\n\t\t\tsegments: segments,\n\t\t\twidth: playlist.attributes.RESOLUTION.width,\n\t\t\theight: playlist.attributes.RESOLUTION.height,\n\t\t\tframeRate: {\n\t\t\t\tframeRateNumerator:\n\t\t\t\t\tplaylist.attributes['FRAME-RATE'] ??\n\t\t\t\t\tFRAME_RATE_NUMERATOR_30,\n\t\t\t\tframeRateDenominator: ZERO,\n\t\t\t},\n\t\t\tpar: '',\n\t\t\tsar: '',\n\t\t\tscanType: '',\n\t\t\t...(byteRange && { byteRange }),\n\t\t\t...(map?.uri && { urlInitialization: map?.uri }),\n\t\t} as VideoTrack);\n\t});\n\n\tswitchingSetVideos.push({\n\t\tid: `video`,\n\t\ttracks: videoTracks,\n\t} as SwitchingSet);\n\n\treturn switchingSetVideos;\n}\n"]}