{"version":3,"file":"filterBoxes.js","sourceRoot":"","sources":["../../../../src/iso/bmff/filterBoxes.ts"],"names":[],"mappings":";;AAiCA,kCAOC;AArCD,yDAAmD;AAInD,SAAS,MAAM,CAAoC,QAA8B,EAAE,EAAgB,EAAE,SAAkB,EAAE,MAAW;IACnI,KAAK,MAAM,GAAG,IAAI,QAAQ,EAAE,CAAC;QAC5B,IAAI,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC;YACb,MAAM,CAAC,IAAI,CAAC,GAAQ,CAAC,CAAC;QACvB,CAAC;QAED,MAAM,EAAE,KAAK,EAAE,GAAG,GAA+B,CAAC;QAClD,IAAI,SAAS,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC;YACvC,MAAM,CAAC,KAAK,EAAE,EAAE,EAAE,SAAS,EAAE,MAAM,CAAC,CAAC;QACtC,CAAC;IACF,CAAC;IAED,OAAO,MAAM,CAAC;AACf,CAAC;AAED;;;;;;;;;;GAUG;AACH,SAAgB,WAAW,CAAoC,GAAmC,EAAE,EAAgB,EAAE,MAAsB;;IAC3I,IAAI,GAAG,YAAY,QAAQ,IAAI,GAAG,YAAY,UAAU,IAAI,GAAG,YAAY,WAAW,EAAE,CAAC;QACxF,GAAG,GAAG,IAAA,gCAAa,EAAC,GAAG,EAAE,EAAE,GAAG,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,CAAC,CAAC;IAC3D,CAAC;IAED,MAAM,SAAS,GAAG,MAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,SAAS,mCAAI,IAAI,CAAC;IAC5C,OAAO,MAAM,CAAI,GAAG,EAAE,EAAE,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;AAC1C,CAAC","sourcesContent":["import type { ContainerBox } from './boxes/ContainerBox.js';\nimport type { IsoBmffBox } from './boxes/IsoBmffBox.js';\nimport type { BoxFilter } from './BoxFilter.js';\nimport { createIsoView } from './createIsoView.js';\nimport type { IsoData } from './IsoData.js';\nimport type { IsoViewConfig } from './IsoViewConfig.js';\n\nfunction filter<T extends IsoBmffBox = IsoBmffBox>(iterator: Iterable<IsoBmffBox>, fn: BoxFilter<T>, recursive: boolean, result: T[]): T[] {\n\tfor (const box of iterator) {\n\t\tif (fn(box)) {\n\t\t\tresult.push(box as T);\n\t\t}\n\n\t\tconst { boxes } = box as ContainerBox<IsoBmffBox>;\n\t\tif (recursive && Array.isArray(boxes)) {\n\t\t\tfilter(boxes, fn, recursive, result);\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * Filters boxes based on the given filter function.\n *\n * @param raw - The raw boxes to filter.\n * @param config - The box parser configuration.\n * @param fn - The filter function.\n * @returns The filtered boxes.\n *\n * @group ISOBMFF\n * @beta\n */\nexport function filterBoxes<T extends IsoBmffBox = IsoBmffBox>(raw: IsoData | Iterable<IsoBmffBox>, fn: BoxFilter<T>, config?: IsoViewConfig): T[] {\n\tif (raw instanceof DataView || raw instanceof Uint8Array || raw instanceof ArrayBuffer) {\n\t\traw = createIsoView(raw, { ...config, recursive: false });\n\t}\n\n\tconst recursive = config?.recursive ?? true;\n\treturn filter<T>(raw, fn, recursive, []);\n}\n"]}