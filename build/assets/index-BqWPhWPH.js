function tr(f,g){for(var v=0;v<g.length;v++){const s=g[v];if(typeof s!="string"&&!Array.isArray(s)){for(const x in s)if(x!=="default"&&!(x in f)){const E=Object.getOwnPropertyDescriptor(s,x);E&&Object.defineProperty(f,x,E.get?E:{enumerable:!0,get:()=>s[x]})}}}return Object.freeze(Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}))}var ze={},ke={exports:{}},qe,et;function rr(){if(et)return qe;et=1;var f=1e3,g=f*60,v=g*60,s=v*24,x=s*7,E=s*365.25;qe=function(t,a){a=a||{};var o=typeof t;if(o==="string"&&t.length>0)return _(t);if(o==="number"&&isFinite(t))return a.long?R(t):p(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function _(t){if(t=String(t),!(t.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(a){var o=parseFloat(a[1]),y=(a[2]||"ms").toLowerCase();switch(y){case"years":case"year":case"yrs":case"yr":case"y":return o*E;case"weeks":case"week":case"w":return o*x;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*v;case"minutes":case"minute":case"mins":case"min":case"m":return o*g;case"seconds":case"second":case"secs":case"sec":case"s":return o*f;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}function p(t){var a=Math.abs(t);return a>=s?Math.round(t/s)+"d":a>=v?Math.round(t/v)+"h":a>=g?Math.round(t/g)+"m":a>=f?Math.round(t/f)+"s":t+"ms"}function R(t){var a=Math.abs(t);return a>=s?C(t,a,s,"day"):a>=v?C(t,a,v,"hour"):a>=g?C(t,a,g,"minute"):a>=f?C(t,a,f,"second"):t+" ms"}function C(t,a,o,y){var b=a>=o*1.5;return Math.round(t/o)+" "+y+(b?"s":"")}return qe}var Be,tt;function sr(){if(tt)return Be;tt=1;function f(g){s.debug=s,s.default=s,s.coerce=C,s.disable=p,s.enable=E,s.enabled=R,s.humanize=rr(),s.destroy=t,Object.keys(g).forEach(a=>{s[a]=g[a]}),s.names=[],s.skips=[],s.formatters={};function v(a){let o=0;for(let y=0;y<a.length;y++)o=(o<<5)-o+a.charCodeAt(y),o|=0;return s.colors[Math.abs(o)%s.colors.length]}s.selectColor=v;function s(a){let o,y=null,b,e;function r(...i){if(!r.enabled)return;const c=r,w=Number(new Date),h=w-(o||w);c.diff=h,c.prev=o,c.curr=w,o=w,i[0]=s.coerce(i[0]),typeof i[0]!="string"&&i.unshift("%O");let m=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(n,l)=>{if(n==="%%")return"%";m++;const S=s.formatters[l];if(typeof S=="function"){const T=i[m];n=S.call(c,T),i.splice(m,1),m--}return n}),s.formatArgs.call(c,i),(c.log||s.log).apply(c,i)}return r.namespace=a,r.useColors=s.useColors(),r.color=s.selectColor(a),r.extend=x,r.destroy=s.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:()=>y!==null?y:(b!==s.namespaces&&(b=s.namespaces,e=s.enabled(a)),e),set:i=>{y=i}}),typeof s.init=="function"&&s.init(r),r}function x(a,o){const y=s(this.namespace+(typeof o>"u"?":":o)+a);return y.log=this.log,y}function E(a){s.save(a),s.namespaces=a,s.names=[],s.skips=[];const o=(typeof a=="string"?a:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const y of o)y[0]==="-"?s.skips.push(y.slice(1)):s.names.push(y)}function _(a,o){let y=0,b=0,e=-1,r=0;for(;y<a.length;)if(b<o.length&&(o[b]===a[y]||o[b]==="*"))o[b]==="*"?(e=b,r=y,b++):(y++,b++);else if(e!==-1)b=e+1,r++,y=r;else return!1;for(;b<o.length&&o[b]==="*";)b++;return b===o.length}function p(){const a=[...s.names,...s.skips.map(o=>"-"+o)].join(",");return s.enable(""),a}function R(a){for(const o of s.skips)if(_(a,o))return!1;for(const o of s.names)if(_(a,o))return!0;return!1}function C(a){return a instanceof Error?a.stack||a.message:a}function t(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return Be=f,Be}var rt;function Yt(){return rt||(rt=1,(function(f,g){var v={};g.formatArgs=x,g.save=E,g.load=_,g.useColors=s,g.storage=p(),g.destroy=(()=>{let C=!1;return()=>{C||(C=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),g.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let C;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(C=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(C[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function x(C){if(C[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+C[0]+(this.useColors?"%c ":" ")+"+"+f.exports.humanize(this.diff),!this.useColors)return;const t="color: "+this.color;C.splice(1,0,t,"color: inherit");let a=0,o=0;C[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(a++,y==="%c"&&(o=a))}),C.splice(o,0,t)}g.log=console.debug||console.log||(()=>{});function E(C){try{C?g.storage.setItem("debug",C):g.storage.removeItem("debug")}catch{}}function _(){let C;try{C=g.storage.getItem("debug")||g.storage.getItem("DEBUG")}catch{}return!C&&typeof process<"u"&&"env"in process&&(C=v.DEBUG),C}function p(){try{return localStorage}catch{}}f.exports=sr()(g);const{formatters:R}=f.exports;R.j=function(C){try{return JSON.stringify(C)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}})(ke,ke.exports)),ke.exports}var Ue={},st;function ir(){return st||(st=1,Object.defineProperty(Ue,"__esModule",{value:!0})),Ue}var W={},re={},it;function $(){if(it)return re;it=1,Object.defineProperty(re,"__esModule",{value:!0}),re.Logger=void 0;const f=Yt(),g="mediasoup-client";class v{_debug;_warn;_error;constructor(x){x?(this._debug=(0,f.default)(`${g}:${x}`),this._warn=(0,f.default)(`${g}:WARN:${x}`),this._error=(0,f.default)(`${g}:ERROR:${x}`)):(this._debug=(0,f.default)(g),this._warn=(0,f.default)(`${g}:WARN`),this._error=(0,f.default)(`${g}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return re.Logger=v,re}var se={},De={exports:{}},nt;function nr(){if(nt)return De.exports;nt=1;var f=typeof Reflect=="object"?Reflect:null,g=f&&typeof f.apply=="function"?f.apply:function(m,u,n){return Function.prototype.apply.call(m,u,n)},v;f&&typeof f.ownKeys=="function"?v=f.ownKeys:Object.getOwnPropertySymbols?v=function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:v=function(m){return Object.getOwnPropertyNames(m)};function s(h){console&&console.warn&&console.warn(h)}var x=Number.isNaN||function(m){return m!==m};function E(){E.init.call(this)}De.exports=E,De.exports.once=i,E.EventEmitter=E,E.prototype._events=void 0,E.prototype._eventsCount=0,E.prototype._maxListeners=void 0;var _=10;function p(h){if(typeof h!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof h)}Object.defineProperty(E,"defaultMaxListeners",{enumerable:!0,get:function(){return _},set:function(h){if(typeof h!="number"||h<0||x(h))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+h+".");_=h}}),E.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},E.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||x(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this};function R(h){return h._maxListeners===void 0?E.defaultMaxListeners:h._maxListeners}E.prototype.getMaxListeners=function(){return R(this)},E.prototype.emit=function(m){for(var u=[],n=1;n<arguments.length;n++)u.push(arguments[n]);var l=m==="error",S=this._events;if(S!==void 0)l=l&&S.error===void 0;else if(!l)return!1;if(l){var T;if(u.length>0&&(T=u[0]),T instanceof Error)throw T;var I=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw I.context=T,I}var M=S[m];if(M===void 0)return!1;if(typeof M=="function")g(M,this,u);else for(var d=M.length,D=b(M,d),n=0;n<d;++n)g(D[n],this,u);return!0};function C(h,m,u,n){var l,S,T;if(p(u),S=h._events,S===void 0?(S=h._events=Object.create(null),h._eventsCount=0):(S.newListener!==void 0&&(h.emit("newListener",m,u.listener?u.listener:u),S=h._events),T=S[m]),T===void 0)T=S[m]=u,++h._eventsCount;else if(typeof T=="function"?T=S[m]=n?[u,T]:[T,u]:n?T.unshift(u):T.push(u),l=R(h),l>0&&T.length>l&&!T.warned){T.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=h,I.type=m,I.count=T.length,s(I)}return h}E.prototype.addListener=function(m,u){return C(this,m,u,!1)},E.prototype.on=E.prototype.addListener,E.prototype.prependListener=function(m,u){return C(this,m,u,!0)};function t(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function a(h,m,u){var n={fired:!1,wrapFn:void 0,target:h,type:m,listener:u},l=t.bind(n);return l.listener=u,n.wrapFn=l,l}E.prototype.once=function(m,u){return p(u),this.on(m,a(this,m,u)),this},E.prototype.prependOnceListener=function(m,u){return p(u),this.prependListener(m,a(this,m,u)),this},E.prototype.removeListener=function(m,u){var n,l,S,T,I;if(p(u),l=this._events,l===void 0)return this;if(n=l[m],n===void 0)return this;if(n===u||n.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete l[m],l.removeListener&&this.emit("removeListener",m,n.listener||u));else if(typeof n!="function"){for(S=-1,T=n.length-1;T>=0;T--)if(n[T]===u||n[T].listener===u){I=n[T].listener,S=T;break}if(S<0)return this;S===0?n.shift():e(n,S),n.length===1&&(l[m]=n[0]),l.removeListener!==void 0&&this.emit("removeListener",m,I||u)}return this},E.prototype.off=E.prototype.removeListener,E.prototype.removeAllListeners=function(m){var u,n,l;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[m]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[m]),this;if(arguments.length===0){var S=Object.keys(n),T;for(l=0;l<S.length;++l)T=S[l],T!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=n[m],typeof u=="function")this.removeListener(m,u);else if(u!==void 0)for(l=u.length-1;l>=0;l--)this.removeListener(m,u[l]);return this};function o(h,m,u){var n=h._events;if(n===void 0)return[];var l=n[m];return l===void 0?[]:typeof l=="function"?u?[l.listener||l]:[l]:u?r(l):b(l,l.length)}E.prototype.listeners=function(m){return o(this,m,!0)},E.prototype.rawListeners=function(m){return o(this,m,!1)},E.listenerCount=function(h,m){return typeof h.listenerCount=="function"?h.listenerCount(m):y.call(h,m)},E.prototype.listenerCount=y;function y(h){var m=this._events;if(m!==void 0){var u=m[h];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}E.prototype.eventNames=function(){return this._eventsCount>0?v(this._events):[]};function b(h,m){for(var u=new Array(m),n=0;n<m;++n)u[n]=h[n];return u}function e(h,m){for(;m+1<h.length;m++)h[m]=h[m+1];h.pop()}function r(h){for(var m=new Array(h.length),u=0;u<m.length;++u)m[u]=h[u].listener||h[u];return m}function i(h,m){return new Promise(function(u,n){function l(T){h.removeListener(m,S),n(T)}function S(){typeof h.removeListener=="function"&&h.removeListener("error",l),u([].slice.call(arguments))}w(h,m,S,{once:!0}),m!=="error"&&c(h,l,{once:!0})})}function c(h,m,u){typeof h.on=="function"&&w(h,"error",m,u)}function w(h,m,u,n){if(typeof h.on=="function")n.once?h.once(m,u):h.on(m,u);else if(typeof h.addEventListener=="function")h.addEventListener(m,function l(S){n.once&&h.removeEventListener(m,l),u(S)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof h)}return De.exports}var at;function z(){if(at)return se;at=1,Object.defineProperty(se,"__esModule",{value:!0}),se.EnhancedEventEmitter=void 0;const f=nr(),g=$(),v=new g.Logger("EnhancedEventEmitter");class s extends f.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}close(){super.removeAllListeners()}emit(E,..._){return super.emit(E,..._)}safeEmit(E,..._){try{return super.emit(E,..._)}catch(p){v.error("safeEmit() | event listener threw an error [eventName:%s]:%o",E,p);try{super.emit("listenererror",E,p)}catch{}return!!super.listenerCount(E)}}on(E,_){return super.on(E,_),this}off(E,_){return super.off(E,_),this}addListener(E,_){return super.on(E,_),this}prependListener(E,_){return super.prependListener(E,_),this}once(E,_){return super.once(E,_),this}prependOnceListener(E,_){return super.prependOnceListener(E,_),this}removeListener(E,_){return super.off(E,_),this}removeAllListeners(E){return super.removeAllListeners(E),this}listenerCount(E){return super.listenerCount(E)}listeners(E){return super.listeners(E)}rawListeners(E){return super.rawListeners(E)}}return se.EnhancedEventEmitter=s,se}var K={},ot;function U(){if(ot)return K;ot=1,Object.defineProperty(K,"__esModule",{value:!0}),K.InvalidStateError=K.UnsupportedError=void 0;class f extends Error{constructor(s){super(s),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,f):this.stack=new Error(s).stack}}K.UnsupportedError=f;class g extends Error{constructor(s){super(s),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,g):this.stack=new Error(s).stack}}return K.InvalidStateError=g,K}var Y={},ct;function ee(){if(ct)return Y;ct=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.clone=f,Y.generateRandomNumber=g,Y.deepFreeze=v;function f(s){if(s!==void 0)return Number.isNaN(s)?NaN:typeof structuredClone=="function"?structuredClone(s):JSON.parse(JSON.stringify(s))}function g(){return Math.round(Math.random()*1e7)}function v(s){const x=Reflect.ownKeys(s);for(const E of x){const _=s[E];(_&&typeof _=="object"||typeof _=="function")&&v(_)}return Object.freeze(s)}return Y}var j={},N={},ie={},Pe={exports:{}},He,dt;function ar(){if(dt)return He;dt=1;var f=1e3,g=f*60,v=g*60,s=v*24,x=s*7,E=s*365.25;He=function(t,a){a=a||{};var o=typeof t;if(o==="string"&&t.length>0)return _(t);if(o==="number"&&isFinite(t))return a.long?R(t):p(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function _(t){if(t=String(t),!(t.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(a){var o=parseFloat(a[1]),y=(a[2]||"ms").toLowerCase();switch(y){case"years":case"year":case"yrs":case"yr":case"y":return o*E;case"weeks":case"week":case"w":return o*x;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*v;case"minutes":case"minute":case"mins":case"min":case"m":return o*g;case"seconds":case"second":case"secs":case"sec":case"s":return o*f;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}function p(t){var a=Math.abs(t);return a>=s?Math.round(t/s)+"d":a>=v?Math.round(t/v)+"h":a>=g?Math.round(t/g)+"m":a>=f?Math.round(t/f)+"s":t+"ms"}function R(t){var a=Math.abs(t);return a>=s?C(t,a,s,"day"):a>=v?C(t,a,v,"hour"):a>=g?C(t,a,g,"minute"):a>=f?C(t,a,f,"second"):t+" ms"}function C(t,a,o,y){var b=a>=o*1.5;return Math.round(t/o)+" "+y+(b?"s":"")}return He}var Ve,pt;function or(){if(pt)return Ve;pt=1;function f(g){s.debug=s,s.default=s,s.coerce=C,s.disable=p,s.enable=E,s.enabled=R,s.humanize=ar(),s.destroy=t,Object.keys(g).forEach(a=>{s[a]=g[a]}),s.names=[],s.skips=[],s.formatters={};function v(a){let o=0;for(let y=0;y<a.length;y++)o=(o<<5)-o+a.charCodeAt(y),o|=0;return s.colors[Math.abs(o)%s.colors.length]}s.selectColor=v;function s(a){let o,y=null,b,e;function r(...i){if(!r.enabled)return;const c=r,w=Number(new Date),h=w-(o||w);c.diff=h,c.prev=o,c.curr=w,o=w,i[0]=s.coerce(i[0]),typeof i[0]!="string"&&i.unshift("%O");let m=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(n,l)=>{if(n==="%%")return"%";m++;const S=s.formatters[l];if(typeof S=="function"){const T=i[m];n=S.call(c,T),i.splice(m,1),m--}return n}),s.formatArgs.call(c,i),(c.log||s.log).apply(c,i)}return r.namespace=a,r.useColors=s.useColors(),r.color=s.selectColor(a),r.extend=x,r.destroy=s.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:()=>y!==null?y:(b!==s.namespaces&&(b=s.namespaces,e=s.enabled(a)),e),set:i=>{y=i}}),typeof s.init=="function"&&s.init(r),r}function x(a,o){const y=s(this.namespace+(typeof o>"u"?":":o)+a);return y.log=this.log,y}function E(a){s.save(a),s.namespaces=a,s.names=[],s.skips=[];const o=(typeof a=="string"?a:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const y of o)y[0]==="-"?s.skips.push(y.slice(1)):s.names.push(y)}function _(a,o){let y=0,b=0,e=-1,r=0;for(;y<a.length;)if(b<o.length&&(o[b]===a[y]||o[b]==="*"))o[b]==="*"?(e=b,r=y,b++):(y++,b++);else if(e!==-1)b=e+1,r++,y=r;else return!1;for(;b<o.length&&o[b]==="*";)b++;return b===o.length}function p(){const a=[...s.names,...s.skips.map(o=>"-"+o)].join(",");return s.enable(""),a}function R(a){for(const o of s.skips)if(_(a,o))return!1;for(const o of s.names)if(_(a,o))return!0;return!1}function C(a){return a instanceof Error?a.stack||a.message:a}function t(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return Ve=f,Ve}var lt;function cr(){return lt||(lt=1,(function(f,g){var v={};g.formatArgs=x,g.save=E,g.load=_,g.useColors=s,g.storage=p(),g.destroy=(()=>{let C=!1;return()=>{C||(C=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),g.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let C;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(C=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(C[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function x(C){if(C[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+C[0]+(this.useColors?"%c ":" ")+"+"+f.exports.humanize(this.diff),!this.useColors)return;const t="color: "+this.color;C.splice(1,0,t,"color: inherit");let a=0,o=0;C[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(a++,y==="%c"&&(o=a))}),C.splice(o,0,t)}g.log=console.debug||console.log||(()=>{});function E(C){try{C?g.storage.setItem("debug",C):g.storage.removeItem("debug")}catch{}}function _(){let C;try{C=g.storage.getItem("debug")||g.storage.getItem("DEBUG")}catch{}return!C&&typeof process<"u"&&"env"in process&&(C=v.DEBUG),C}function p(){try{return localStorage}catch{}}f.exports=or()(g);const{formatters:R}=f.exports;R.j=function(C){try{return JSON.stringify(C)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}})(Pe,Pe.exports)),Pe.exports}var ut;function dr(){if(ut)return ie;ut=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.Logger=void 0;const f=cr(),g="h264-profile-level-id";class v{_debug;_warn;_error;constructor(x){x?(this._debug=(0,f.default)(`${g}:${x}`),this._warn=(0,f.default)(`${g}:WARN:${x}`),this._error=(0,f.default)(`${g}:ERROR:${x}`)):(this._debug=(0,f.default)(g),this._warn=(0,f.default)(`${g}:WARN`),this._error=(0,f.default)(`${g}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return ie.Logger=v,ie}var ht;function pr(){if(ht)return N;ht=1,Object.defineProperty(N,"__esModule",{value:!0}),N.ProfileLevelId=N.Level=N.Profile=void 0,N.parseProfileLevelId=t,N.profileLevelIdToString=a,N.profileToString=o,N.levelToString=y,N.parseSdpProfileLevelId=b,N.isSameProfile=e,N.isSameProfileAndLevel=r,N.generateProfileLevelIdStringForAnswer=i,N.supportedLevel=c;const f=dr(),g=new f.Logger;var v;(function(n){n[n.ConstrainedBaseline=1]="ConstrainedBaseline",n[n.Baseline=2]="Baseline",n[n.Main=3]="Main",n[n.ConstrainedHigh=4]="ConstrainedHigh",n[n.High=5]="High",n[n.PredictiveHigh444=6]="PredictiveHigh444"})(v||(N.Profile=v={}));var s;(function(n){n[n.L1_b=0]="L1_b",n[n.L1=10]="L1",n[n.L1_1=11]="L1_1",n[n.L1_2=12]="L1_2",n[n.L1_3=13]="L1_3",n[n.L2=20]="L2",n[n.L2_1=21]="L2_1",n[n.L2_2=22]="L2_2",n[n.L3=30]="L3",n[n.L3_1=31]="L3_1",n[n.L3_2=32]="L3_2",n[n.L4=40]="L4",n[n.L4_1=41]="L4_1",n[n.L4_2=42]="L4_2",n[n.L5=50]="L5",n[n.L5_1=51]="L5_1",n[n.L5_2=52]="L5_2"})(s||(N.Level=s={}));class x{profile;level;constructor(l,S){this.profile=l,this.level=S}}N.ProfileLevelId=x;const E=new x(v.ConstrainedBaseline,s.L3_1);class _{mask;masked_value;constructor(l){this.mask=~w("x",l),this.masked_value=w("1",l)}isMatch(l){return this.masked_value===(l&this.mask)}}class p{profile_idc;profile_iop;profile;constructor(l,S,T){this.profile_idc=l,this.profile_iop=S,this.profile=T}}const R=[new p(66,new _("x1xx0000"),v.ConstrainedBaseline),new p(77,new _("1xxx0000"),v.ConstrainedBaseline),new p(88,new _("11xx0000"),v.ConstrainedBaseline),new p(66,new _("x0xx0000"),v.Baseline),new p(88,new _("10xx0000"),v.Baseline),new p(77,new _("0x0x0000"),v.Main),new p(100,new _("00000000"),v.High),new p(100,new _("00001100"),v.ConstrainedHigh),new p(244,new _("00000000"),v.PredictiveHigh444)],C=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:s.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:s.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:s.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:s.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:s.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:s.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:s.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:s.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:s.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:s.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:s.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:s.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:s.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:s.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:s.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:s.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:s.L5_2}];function t(n){if(typeof n!="string"||n.length!==6)return;const S=parseInt(n,16);if(S===0)return;const T=S&255,I=S>>8&255,M=S>>16&255;let d;switch(T){case s.L1_1:{d=(I&16)!==0?s.L1_b:s.L1_1;break}case s.L1:case s.L1_2:case s.L1_3:case s.L2:case s.L2_1:case s.L2_2:case s.L3:case s.L3_1:case s.L3_2:case s.L4:case s.L4_1:case s.L4_2:case s.L5:case s.L5_1:case s.L5_2:{d=T;break}default:{g.warn(`parseProfileLevelId() | unrecognized level_idc [str:${n}, level_idc:${T}]`);return}}for(const D of R)if(M===D.profile_idc&&D.profile_iop.isMatch(I))return g.debug(`parseProfileLevelId() | result [str:${n}, profile:${D.profile}, level:${d}]`),new x(D.profile,d);g.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${n}, profile_idc:${M}, profile_iop:${I}]`)}function a(n){if(n.level==s.L1_b)switch(n.profile){case v.ConstrainedBaseline:return"42f00b";case v.Baseline:return"42100b";case v.Main:return"4d100b";default:{g.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${n.profile}`);return}}let l;switch(n.profile){case v.ConstrainedBaseline:{l="42e0";break}case v.Baseline:{l="4200";break}case v.Main:{l="4d00";break}case v.ConstrainedHigh:{l="640c";break}case v.High:{l="6400";break}case v.PredictiveHigh444:{l="f400";break}default:{g.warn(`profileLevelIdToString() | unrecognized profile ${n.profile}`);return}}let S=n.level.toString(16);return S.length===1&&(S=`0${S}`),`${l}${S}`}function o(n){switch(n){case v.ConstrainedBaseline:return"ConstrainedBaseline";case v.Baseline:return"Baseline";case v.Main:return"Main";case v.ConstrainedHigh:return"ConstrainedHigh";case v.High:return"High";case v.PredictiveHigh444:return"PredictiveHigh444";default:{g.warn(`profileToString() | unrecognized profile ${n}`);return}}}function y(n){switch(n){case s.L1_b:return"1b";case s.L1:return"1";case s.L1_1:return"1.1";case s.L1_2:return"1.2";case s.L1_3:return"1.3";case s.L2:return"2";case s.L2_1:return"2.1";case s.L2_2:return"2.2";case s.L3:return"3";case s.L3_1:return"3.1";case s.L3_2:return"3.2";case s.L4:return"4";case s.L4_1:return"4.1";case s.L4_2:return"4.2";case s.L5:return"5";case s.L5_1:return"5.1";case s.L5_2:return"5.2";default:{g.warn(`levelToString() | unrecognized level ${n}`);return}}}function b(n={}){const l=n["profile-level-id"];return l?t(l):E}function e(n={},l={}){const S=b(n),T=b(l);return!!(S&&T&&S.profile===T.profile)}function r(n={},l={}){const S=b(n),T=b(l);return!!(S&&T&&S.profile===T.profile&&S.level==T.level)}function i(n={},l={}){if(!n["profile-level-id"]&&!l["profile-level-id"]){g.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const S=b(n),T=b(l);if(!S)throw new TypeError("invalid local_profile_level_id");if(!T)throw new TypeError("invalid remote_profile_level_id");if(S.profile!==T.profile)throw new TypeError("H264 Profile mismatch");const I=u(n)&&u(l),M=S.level,d=T.level,D=m(M,d),P=I?M:D;return g.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${S.profile}, level:${P}]`),a(new x(S.profile,P))}function c(n,l){for(let T=C.length-1;T>=0;--T){const I=C[T];if(I.max_macroblock_frame_size*256<=n&&I.max_macroblocks_per_second<=l*I.max_macroblock_frame_size)return g.debug(`supportedLevel() | result [max_frame_pixel_count:${n}, max_fps:${l}, level:${I.level}]`),I.level}g.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${n}, max_fps:${l}]`)}function w(n,l){return+(l[0]===n)<<7|+(l[1]===n)<<6|+(l[2]===n)<<5|+(l[3]===n)<<4|+(l[4]===n)<<3|+(l[5]===n)<<2|+(l[6]===n)<<1|+(l[7]===n)<<0}function h(n,l){return n===s.L1_b?l!==s.L1&&l!==s.L1_b:l===s.L1_b?n!==s.L1:n<l}function m(n,l){return h(n,l)?n:l}function u(n={}){const l=n["level-asymmetry-allowed"];return l===!0||l===1||l==="1"}return N}var ft;function V(){if(ft)return j;ft=1,Object.defineProperty(j,"__esModule",{value:!0}),j.validateAndNormalizeRtpCapabilities=E,j.validateAndNormalizeRtpParameters=_,j.validateAndNormalizeSctpStreamParameters=p,j.validateSctpCapabilities=R,j.getExtendedRtpCapabilities=C,j.getRecvRtpCapabilities=t,j.getSendingRtpParameters=a,j.getSendingRemoteRtpParameters=o,j.reduceCodecs=y,j.generateProbatorRtpParameters=b,j.canSend=e,j.canReceive=r;const f=pr(),g=ee(),v="probator",s=1234,x=127;function E(d){if(typeof d!="object")throw new TypeError("caps is not an object");if(d.codecs&&!Array.isArray(d.codecs))throw new TypeError("caps.codecs is not an array");d.codecs||(d.codecs=[]);for(const D of d.codecs)i(D);if(d.headerExtensions&&!Array.isArray(d.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");d.headerExtensions||(d.headerExtensions=[]);for(const D of d.headerExtensions)w(D)}function _(d){if(typeof d!="object")throw new TypeError("params is not an object");if(d.mid&&typeof d.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(d.codecs))throw new TypeError("missing params.codecs");for(const D of d.codecs)h(D);if(d.headerExtensions&&!Array.isArray(d.headerExtensions))throw new TypeError("params.headerExtensions is not an array");d.headerExtensions||(d.headerExtensions=[]);for(const D of d.headerExtensions)m(D);if(d.encodings&&!Array.isArray(d.encodings))throw new TypeError("params.encodings is not an array");d.encodings||(d.encodings=[]);for(const D of d.encodings)u(D);if(d.rtcp&&typeof d.rtcp!="object")throw new TypeError("params.rtcp is not an object");d.rtcp||(d.rtcp={}),n(d.rtcp)}function p(d){if(typeof d!="object")throw new TypeError("params is not an object");if(typeof d.streamId!="number")throw new TypeError("missing params.streamId");let D=!1;if(typeof d.ordered=="boolean"?D=!0:d.ordered=!0,d.maxPacketLifeTime&&typeof d.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(d.maxRetransmits&&typeof d.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(d.maxPacketLifeTime&&d.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(D&&d.ordered&&(d.maxPacketLifeTime||d.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!D&&(d.maxPacketLifeTime||d.maxRetransmits)&&(d.ordered=!1),d.label&&typeof d.label!="string")throw new TypeError("invalid params.label");if(d.protocol&&typeof d.protocol!="string")throw new TypeError("invalid params.protocol")}function R(d){if(typeof d!="object")throw new TypeError("caps is not an object");if(!d.numStreams||typeof d.numStreams!="object")throw new TypeError("missing caps.numStreams");l(d.numStreams)}function C(d,D,P){const k={codecs:[],headerExtensions:[]};if(P)for(const L of d.codecs??[]){if(S(L))continue;const F=(D.codecs??[]).find(A=>T(A,L,{strict:!0,modify:!0}));if(!F)continue;const O={kind:L.kind,mimeType:L.mimeType,clockRate:L.clockRate,channels:L.channels,localPayloadType:L.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:F.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:L.parameters??{},remoteParameters:F.parameters??{},rtcpFeedback:M(L,F)};k.codecs.push(O)}else for(const L of D.codecs??[]){if(S(L))continue;const F=(d.codecs??[]).find(A=>T(A,L,{strict:!0,modify:!0}));if(!F)continue;const O={kind:F.kind,mimeType:F.mimeType,clockRate:F.clockRate,channels:F.channels,localPayloadType:F.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:L.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:F.parameters??{},remoteParameters:L.parameters??{},rtcpFeedback:M(F,L)};k.codecs.push(O)}for(const L of k.codecs){const F=d.codecs.find(A=>S(A)&&A.parameters?.apt===L.localPayloadType),O=D.codecs.find(A=>S(A)&&A.parameters?.apt===L.remotePayloadType);F&&O&&(L.localRtxPayloadType=F.preferredPayloadType,L.remoteRtxPayloadType=O.preferredPayloadType)}for(const L of D.headerExtensions){const F=d.headerExtensions.find(A=>I(A,L));if(!F)continue;const O={kind:L.kind,uri:L.uri,sendId:F.preferredId,recvId:L.preferredId,encrypt:F.preferredEncrypt??!1,direction:"sendrecv"};switch(L.direction){case"sendrecv":{O.direction="sendrecv";break}case"recvonly":{O.direction="sendonly";break}case"sendonly":{O.direction="recvonly";break}case"inactive":{O.direction="inactive";break}}k.headerExtensions.push(O)}return k}function t(d){const D={codecs:[],headerExtensions:[]};for(const P of d.codecs){const k={kind:P.kind,mimeType:P.mimeType,preferredPayloadType:P.remotePayloadType,clockRate:P.clockRate,channels:P.channels,parameters:P.localParameters,rtcpFeedback:P.rtcpFeedback};if(D.codecs.push(k),!P.remoteRtxPayloadType)continue;const L={kind:P.kind,mimeType:`${P.kind}/rtx`,preferredPayloadType:P.remoteRtxPayloadType,clockRate:P.clockRate,parameters:{apt:P.remotePayloadType},rtcpFeedback:[]};D.codecs.push(L)}for(const P of d.headerExtensions){if(P.direction!=="sendrecv"&&P.direction!=="recvonly")continue;const k={kind:P.kind,uri:P.uri,preferredId:P.recvId,preferredEncrypt:P.encrypt??!1,direction:P.direction};D.headerExtensions.push(k)}return D}function a(d,D){const P={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const k of D.codecs){if(k.kind!==d)continue;const L={mimeType:k.mimeType,payloadType:k.localPayloadType,clockRate:k.clockRate,channels:k.channels,parameters:k.localParameters,rtcpFeedback:k.rtcpFeedback};if(P.codecs.push(L),k.localRtxPayloadType){const F={mimeType:`${k.kind}/rtx`,payloadType:k.localRtxPayloadType,clockRate:k.clockRate,parameters:{apt:k.localPayloadType},rtcpFeedback:[]};P.codecs.push(F)}}for(const k of D.headerExtensions){if(k.kind&&k.kind!==d||k.direction!=="sendrecv"&&k.direction!=="sendonly")continue;const L={uri:k.uri,id:k.sendId,encrypt:k.encrypt,parameters:{}};P.headerExtensions.push(L)}return P}function o(d,D){const P={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const k of D.codecs){if(k.kind!==d)continue;const L={mimeType:k.mimeType,payloadType:k.localPayloadType,clockRate:k.clockRate,channels:k.channels,parameters:k.remoteParameters,rtcpFeedback:k.rtcpFeedback};if(P.codecs.push(L),k.localRtxPayloadType){const F={mimeType:`${k.kind}/rtx`,payloadType:k.localRtxPayloadType,clockRate:k.clockRate,parameters:{apt:k.localPayloadType},rtcpFeedback:[]};P.codecs.push(F)}}for(const k of D.headerExtensions){if(k.kind&&k.kind!==d||k.direction!=="sendrecv"&&k.direction!=="sendonly")continue;const L={uri:k.uri,id:k.sendId,encrypt:k.encrypt,parameters:{}};P.headerExtensions.push(L)}if(P.headerExtensions.some(k=>k.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const k of P.codecs)k.rtcpFeedback=(k.rtcpFeedback??[]).filter(L=>L.type!=="goog-remb");else if(P.headerExtensions.some(k=>k.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const k of P.codecs)k.rtcpFeedback=(k.rtcpFeedback??[]).filter(L=>L.type!=="transport-cc");else for(const k of P.codecs)k.rtcpFeedback=(k.rtcpFeedback??[]).filter(L=>L.type!=="transport-cc"&&L.type!=="goog-remb");return P}function y(d,D){const P=[];if(!D)P.push(d[0]),S(d[1])&&P.push(d[1]);else{for(let k=0;k<d.length;++k)if(T(d[k],D,{strict:!0})){P.push(d[k]),S(d[k+1])&&P.push(d[k+1]);break}if(P.length===0)throw new TypeError("no matching codec found")}return P}function b(d){d=g.clone(d),_(d);const D={mid:v,codecs:[],headerExtensions:[],encodings:[{ssrc:s}],rtcp:{cname:"probator"}};return D.codecs.push(d.codecs[0]),D.codecs[0].payloadType=x,D.headerExtensions=d.headerExtensions,D}function e(d,D){return(D.codecs??[]).some(P=>P.kind===d)}function r(d,D){if(_(d),d.codecs.length===0)return!1;const P=d.codecs[0];return(D.codecs??[]).some(k=>k.preferredPayloadType===P.payloadType)}function i(d){const D=new RegExp("^(audio|video)/(.+)","i");if(typeof d!="object")throw new TypeError("codec is not an object");if(!d.mimeType||typeof d.mimeType!="string")throw new TypeError("missing codec.mimeType");const P=D.exec(d.mimeType);if(!P)throw new TypeError("invalid codec.mimeType");if(d.kind=P[1].toLowerCase(),typeof d.preferredPayloadType!="number")throw new TypeError("missing codec.preferredPayloadType");if(typeof d.clockRate!="number")throw new TypeError("missing codec.clockRate");d.kind==="audio"?typeof d.channels!="number"&&(d.channels=1):delete d.channels,(!d.parameters||typeof d.parameters!="object")&&(d.parameters={});for(const k of Object.keys(d.parameters)){let L=d.parameters[k];if(L===void 0&&(d.parameters[k]="",L=""),typeof L!="string"&&typeof L!="number")throw new TypeError(`invalid codec parameter [key:${k}s, value:${L}]`);if(k==="apt"&&typeof L!="number")throw new TypeError("invalid codec apt parameter")}(!d.rtcpFeedback||!Array.isArray(d.rtcpFeedback))&&(d.rtcpFeedback=[]);for(const k of d.rtcpFeedback)c(k)}function c(d){if(typeof d!="object")throw new TypeError("fb is not an object");if(!d.type||typeof d.type!="string")throw new TypeError("missing fb.type");(!d.parameter||typeof d.parameter!="string")&&(d.parameter="")}function w(d){if(typeof d!="object")throw new TypeError("ext is not an object");if(d.kind!=="audio"&&d.kind!=="video")throw new TypeError("invalid ext.kind");if(!d.uri||typeof d.uri!="string")throw new TypeError("missing ext.uri");if(typeof d.preferredId!="number")throw new TypeError("missing ext.preferredId");if(d.preferredEncrypt&&typeof d.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(d.preferredEncrypt||(d.preferredEncrypt=!1),d.direction&&typeof d.direction!="string")throw new TypeError("invalid ext.direction");d.direction||(d.direction="sendrecv")}function h(d){const D=new RegExp("^(audio|video)/(.+)","i");if(typeof d!="object")throw new TypeError("codec is not an object");if(!d.mimeType||typeof d.mimeType!="string")throw new TypeError("missing codec.mimeType");const P=D.exec(d.mimeType);if(!P)throw new TypeError("invalid codec.mimeType");if(typeof d.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof d.clockRate!="number")throw new TypeError("missing codec.clockRate");P[1].toLowerCase()==="audio"?typeof d.channels!="number"&&(d.channels=1):delete d.channels,(!d.parameters||typeof d.parameters!="object")&&(d.parameters={});for(const L of Object.keys(d.parameters)){let F=d.parameters[L];if(F===void 0&&(d.parameters[L]="",F=""),typeof F!="string"&&typeof F!="number")throw new TypeError(`invalid codec parameter [key:${L}s, value:${F}]`);if(L==="apt"&&typeof F!="number")throw new TypeError("invalid codec apt parameter")}(!d.rtcpFeedback||!Array.isArray(d.rtcpFeedback))&&(d.rtcpFeedback=[]);for(const L of d.rtcpFeedback)c(L)}function m(d){if(typeof d!="object")throw new TypeError("ext is not an object");if(!d.uri||typeof d.uri!="string")throw new TypeError("missing ext.uri");if(typeof d.id!="number")throw new TypeError("missing ext.id");if(d.encrypt&&typeof d.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");d.encrypt||(d.encrypt=!1),(!d.parameters||typeof d.parameters!="object")&&(d.parameters={});for(const D of Object.keys(d.parameters)){let P=d.parameters[D];if(P===void 0&&(d.parameters[D]="",P=""),typeof P!="string"&&typeof P!="number")throw new TypeError("invalid header extension parameter")}}function u(d){if(typeof d!="object")throw new TypeError("encoding is not an object");if(d.ssrc&&typeof d.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(d.rid&&typeof d.rid!="string")throw new TypeError("invalid encoding.rid");if(d.rtx&&typeof d.rtx!="object")throw new TypeError("invalid encoding.rtx");if(d.rtx&&typeof d.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!d.dtx||typeof d.dtx!="boolean")&&(d.dtx=!1),d.scalabilityMode&&typeof d.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function n(d){if(typeof d!="object")throw new TypeError("rtcp is not an object");if(d.cname&&typeof d.cname!="string")throw new TypeError("invalid rtcp.cname");(!d.reducedSize||typeof d.reducedSize!="boolean")&&(d.reducedSize=!0)}function l(d){if(typeof d!="object")throw new TypeError("numStreams is not an object");if(typeof d.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof d.MIS!="number")throw new TypeError("missing numStreams.MIS")}function S(d){return d?/.+\/rtx$/i.test(d.mimeType):!1}function T(d,D,{strict:P=!1,modify:k=!1}={}){const L=d.mimeType.toLowerCase(),F=D.mimeType.toLowerCase();if(L!==F||d.clockRate!==D.clockRate||d.channels!==D.channels)return!1;switch(L){case"video/h264":{if(P){const O=d.parameters["packetization-mode"]??0,A=D.parameters["packetization-mode"]??0;if(O!==A||!f.isSameProfile(d.parameters,D.parameters))return!1;let Z;try{Z=f.generateProfileLevelIdStringForAnswer(d.parameters,D.parameters)}catch{return!1}k&&(Z?(d.parameters["profile-level-id"]=Z,D.parameters["profile-level-id"]=Z):(delete d.parameters["profile-level-id"],delete D.parameters["profile-level-id"]))}break}case"video/vp9":{if(P){const O=d.parameters["profile-id"]??0,A=D.parameters["profile-id"]??0;if(O!==A)return!1}break}}return!0}function I(d,D){return!(d.kind&&D.kind&&d.kind!==D.kind||d.uri!==D.uri)}function M(d,D){const P=[];for(const k of d.rtcpFeedback??[]){const L=(D.rtcpFeedback??[]).find(F=>F.type===k.type&&(F.parameter===k.parameter||!F.parameter&&!k.parameter));L&&P.push(L)}return P}return j}var ne={},Ge={},ae={},oe={},Le={exports:{}},Qe,mt;function lr(){if(mt)return Qe;mt=1;var f=1e3,g=f*60,v=g*60,s=v*24,x=s*7,E=s*365.25;Qe=function(t,a){a=a||{};var o=typeof t;if(o==="string"&&t.length>0)return _(t);if(o==="number"&&isFinite(t))return a.long?R(t):p(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function _(t){if(t=String(t),!(t.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(a){var o=parseFloat(a[1]),y=(a[2]||"ms").toLowerCase();switch(y){case"years":case"year":case"yrs":case"yr":case"y":return o*E;case"weeks":case"week":case"w":return o*x;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*v;case"minutes":case"minute":case"mins":case"min":case"m":return o*g;case"seconds":case"second":case"secs":case"sec":case"s":return o*f;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}function p(t){var a=Math.abs(t);return a>=s?Math.round(t/s)+"d":a>=v?Math.round(t/v)+"h":a>=g?Math.round(t/g)+"m":a>=f?Math.round(t/f)+"s":t+"ms"}function R(t){var a=Math.abs(t);return a>=s?C(t,a,s,"day"):a>=v?C(t,a,v,"hour"):a>=g?C(t,a,g,"minute"):a>=f?C(t,a,f,"second"):t+" ms"}function C(t,a,o,y){var b=a>=o*1.5;return Math.round(t/o)+" "+y+(b?"s":"")}return Qe}var We,gt;function ur(){if(gt)return We;gt=1;function f(g){s.debug=s,s.default=s,s.coerce=C,s.disable=p,s.enable=E,s.enabled=R,s.humanize=lr(),s.destroy=t,Object.keys(g).forEach(a=>{s[a]=g[a]}),s.names=[],s.skips=[],s.formatters={};function v(a){let o=0;for(let y=0;y<a.length;y++)o=(o<<5)-o+a.charCodeAt(y),o|=0;return s.colors[Math.abs(o)%s.colors.length]}s.selectColor=v;function s(a){let o,y=null,b,e;function r(...i){if(!r.enabled)return;const c=r,w=Number(new Date),h=w-(o||w);c.diff=h,c.prev=o,c.curr=w,o=w,i[0]=s.coerce(i[0]),typeof i[0]!="string"&&i.unshift("%O");let m=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(n,l)=>{if(n==="%%")return"%";m++;const S=s.formatters[l];if(typeof S=="function"){const T=i[m];n=S.call(c,T),i.splice(m,1),m--}return n}),s.formatArgs.call(c,i),(c.log||s.log).apply(c,i)}return r.namespace=a,r.useColors=s.useColors(),r.color=s.selectColor(a),r.extend=x,r.destroy=s.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:()=>y!==null?y:(b!==s.namespaces&&(b=s.namespaces,e=s.enabled(a)),e),set:i=>{y=i}}),typeof s.init=="function"&&s.init(r),r}function x(a,o){const y=s(this.namespace+(typeof o>"u"?":":o)+a);return y.log=this.log,y}function E(a){s.save(a),s.namespaces=a,s.names=[],s.skips=[];const o=(typeof a=="string"?a:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const y of o)y[0]==="-"?s.skips.push(y.slice(1)):s.names.push(y)}function _(a,o){let y=0,b=0,e=-1,r=0;for(;y<a.length;)if(b<o.length&&(o[b]===a[y]||o[b]==="*"))o[b]==="*"?(e=b,r=y,b++):(y++,b++);else if(e!==-1)b=e+1,r++,y=r;else return!1;for(;b<o.length&&o[b]==="*";)b++;return b===o.length}function p(){const a=[...s.names,...s.skips.map(o=>"-"+o)].join(",");return s.enable(""),a}function R(a){for(const o of s.skips)if(_(a,o))return!1;for(const o of s.names)if(_(a,o))return!0;return!1}function C(a){return a instanceof Error?a.stack||a.message:a}function t(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return We=f,We}var _t;function hr(){return _t||(_t=1,(function(f,g){var v={};g.formatArgs=x,g.save=E,g.load=_,g.useColors=s,g.storage=p(),g.destroy=(()=>{let C=!1;return()=>{C||(C=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),g.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let C;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(C=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(C[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function x(C){if(C[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+C[0]+(this.useColors?"%c ":" ")+"+"+f.exports.humanize(this.diff),!this.useColors)return;const t="color: "+this.color;C.splice(1,0,t,"color: inherit");let a=0,o=0;C[0].replace(/%[a-zA-Z%]/g,y=>{y!=="%%"&&(a++,y==="%c"&&(o=a))}),C.splice(o,0,t)}g.log=console.debug||console.log||(()=>{});function E(C){try{C?g.storage.setItem("debug",C):g.storage.removeItem("debug")}catch{}}function _(){let C;try{C=g.storage.getItem("debug")||g.storage.getItem("DEBUG")}catch{}return!C&&typeof process<"u"&&"env"in process&&(C=v.DEBUG),C}function p(){try{return localStorage}catch{}}f.exports=ur()(g);const{formatters:R}=f.exports;R.j=function(C){try{return JSON.stringify(C)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}})(Le,Le.exports)),Le.exports}var vt;function fr(){if(vt)return oe;vt=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.Logger=void 0;const f=hr(),g="awaitqueue";let v=class{_debug;_warn;_error;constructor(x){x?(this._debug=f(`${g}:${x}`),this._warn=f(`${g}:WARN:${x}`),this._error=f(`${g}:ERROR:${x}`)):(this._debug=f(g),this._warn=f(`${g}:WARN`),this._error=f(`${g}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};return oe.Logger=v,oe}var J={},wt;function Xt(){if(wt)return J;wt=1,Object.defineProperty(J,"__esModule",{value:!0}),J.AwaitQueueRemovedTaskError=J.AwaitQueueStoppedError=void 0;class f extends Error{constructor(s){super(s??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,f)}}J.AwaitQueueStoppedError=f;class g extends Error{constructor(s){super(s??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,g)}}return J.AwaitQueueRemovedTaskError=g,J}var bt;function mr(){if(bt)return ae;bt=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.AwaitQueue=void 0;const f=fr(),g=Xt(),v=new f.Logger("AwaitQueue");let s=class{pendingTasks=new Map;nextTaskId=0;constructor(){v.debug("constructor()")}get size(){return this.pendingTasks.size}async push(E,_,p){if(_=_??E.name,v.debug(`push() [name:${_}, options:%o]`,p),typeof E!="function")throw new TypeError("given task is not a function");if(_)try{Object.defineProperty(E,"name",{value:_})}catch{}return new Promise((R,C)=>{if(_&&p?.removeOngoingTasksWithSameName)for(const a of this.pendingTasks.values())a.name===_&&a.reject(new g.AwaitQueueRemovedTaskError,{canExecuteNextTask:!1});const t={id:this.nextTaskId++,task:E,name:_,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:a=>{if(t.completed)return;t.completed=!0,this.pendingTasks.delete(t.id),v.debug(`resolving task [name:${t.name}]`),R(a);const[o]=this.pendingTasks.values();o&&!o.executedAt&&this.execute(o)},reject:(a,{canExecuteNextTask:o})=>{if(!t.completed&&(t.completed=!0,this.pendingTasks.delete(t.id),v.debug(`rejecting task [name:${t.name}]: %s`,String(a)),C(a),o)){const[y]=this.pendingTasks.values();y&&!y.executedAt&&this.execute(y)}}};this.pendingTasks.set(t.id,t),this.pendingTasks.size===1&&this.execute(t)})}stop(){v.debug("stop()");for(const E of this.pendingTasks.values())v.debug(`stop() | stopping task [name:${E.name}]`),E.reject(new g.AwaitQueueStoppedError,{canExecuteNextTask:!1})}remove(E){v.debug(`remove() [taskIdx:${E}]`);const _=Array.from(this.pendingTasks.values())[E];if(!_){v.debug(`stop() | no task with given idx [taskIdx:${E}]`);return}_.reject(new g.AwaitQueueRemovedTaskError,{canExecuteNextTask:!0})}dump(){const E=Date.now();let _=0;return Array.from(this.pendingTasks.values()).map(p=>({idx:_++,task:p.task,name:p.name,enqueuedTime:p.executedAt?p.executedAt-p.enqueuedAt:E-p.enqueuedAt,executionTime:p.executedAt?E-p.executedAt:0}))}async execute(E){if(v.debug(`execute() [name:${E.name}]`),E.executedAt)throw new Error("task already being executed");E.executedAt=Date.now();try{const _=await E.task();E.resolve(_)}catch(_){E.reject(_,{canExecuteNextTask:!0})}}};return ae.AwaitQueue=s,ae}var yt;function gr(){return yt||(yt=1,(function(f){Object.defineProperty(f,"__esModule",{value:!0}),f.AwaitQueueRemovedTaskError=f.AwaitQueueStoppedError=f.AwaitQueue=void 0;var g=mr();Object.defineProperty(f,"AwaitQueue",{enumerable:!0,get:function(){return g.AwaitQueue}});var v=Xt();Object.defineProperty(f,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return v.AwaitQueueStoppedError}}),Object.defineProperty(f,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return v.AwaitQueueRemovedTaskError}})})(Ge)),Ge}var ce={},Ct;function _r(){if(Ct)return ce;Ct=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.Producer=void 0;const f=$(),g=z(),v=U(),s=new f.Logger("Producer");let x=class extends g.EnhancedEventEmitter{_id;_localId;_closed=!1;_rtpSender;_track;_kind;_rtpParameters;_paused;_maxSpatialLayer;_stopTracks;_disableTrackOnPause;_zeroRtpOnPause;_appData;_observer=new g.EnhancedEventEmitter;constructor({id:_,localId:p,rtpSender:R,track:C,rtpParameters:t,stopTracks:a,disableTrackOnPause:o,zeroRtpOnPause:y,appData:b}){super(),s.debug("constructor()"),this._id=_,this._localId=p,this._rtpSender=R,this._track=C,this._kind=C.kind,this._rtpParameters=t,this._paused=o?!C.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=a,this._disableTrackOnPause=o,this._zeroRtpOnPause=y,this._appData=b??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new v.InvalidStateError("closed");return new Promise((_,p)=>{this.safeEmit("@getstats",_,p)})}pause(){if(s.debug("pause()"),this._closed){s.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((_,p)=>{this.safeEmit("@pause",_,p)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(s.debug("resume()"),this._closed){s.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((_,p)=>{this.safeEmit("@resume",_,p)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:_}){if(s.debug("replaceTrack() [track:%o]",_),this._closed){if(_&&this._stopTracks)try{_.stop()}catch{}throw new v.InvalidStateError("closed")}else if(_?.readyState==="ended")throw new v.InvalidStateError("track ended");if(_===this._track){s.debug("replaceTrack() | same track, ignored");return}await new Promise((p,R)=>{this.safeEmit("@replacetrack",_,p,R)}),this.destroyTrack(),this._track=_,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(_){if(this._closed)throw new v.InvalidStateError("closed");if(this._kind!=="video")throw new v.UnsupportedError("not a video Producer");if(typeof _!="number")throw new TypeError("invalid spatialLayer");_!==this._maxSpatialLayer&&(await new Promise((p,R)=>{this.safeEmit("@setmaxspatiallayer",_,p,R)}).catch(()=>{}),this._maxSpatialLayer=_)}async setRtpEncodingParameters(_){if(this._closed)throw new v.InvalidStateError("closed");if(typeof _!="object")throw new TypeError("invalid params");await new Promise((p,R)=>{this.safeEmit("@setrtpencodingparameters",_,p,R)})}onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};return ce.Producer=x,ce}var de={},St;function vr(){if(St)return de;St=1,Object.defineProperty(de,"__esModule",{value:!0}),de.Consumer=void 0;const f=$(),g=z(),v=U(),s=new f.Logger("Consumer");let x=class extends g.EnhancedEventEmitter{_id;_localId;_producerId;_closed=!1;_rtpReceiver;_track;_rtpParameters;_paused;_appData;_observer=new g.EnhancedEventEmitter;constructor({id:_,localId:p,producerId:R,rtpReceiver:C,track:t,rtpParameters:a,appData:o}){super(),s.debug("constructor()"),this._id=_,this._localId=p,this._producerId=R,this._rtpReceiver=C,this._track=t,this._rtpParameters=a,this._paused=!t.enabled,this._appData=o??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new v.InvalidStateError("closed");return new Promise((_,p)=>{this.safeEmit("@getstats",_,p)})}pause(){if(s.debug("pause()"),this._closed){s.error("pause() | Consumer closed");return}if(this._paused){s.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(s.debug("resume()"),this._closed){s.error("resume() | Consumer closed");return}if(!this._paused){s.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};return de.Consumer=x,de}var pe={},Rt;function wr(){if(Rt)return pe;Rt=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.DataProducer=void 0;const f=$(),g=z(),v=U(),s=new f.Logger("DataProducer");let x=class extends g.EnhancedEventEmitter{_id;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new g.EnhancedEventEmitter;constructor({id:_,dataChannel:p,sctpStreamParameters:R,appData:C}){super(),s.debug("constructor()"),this._id=_,this._dataChannel=p,this._sctpStreamParameters=R,this._appData=C??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(_){this._dataChannel.bufferedAmountLowThreshold=_}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(_){if(s.debug("send()"),this._closed)throw new v.InvalidStateError("closed");this._dataChannel.send(_)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",_=>{if(this._closed)return;const p=_.error??new Error("unknown DataChannel error");_.error?.errorDetail==="sctp-failure"?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",_.error?.sctpCauseCode,_.error.message):s.error('DataChannel "error" event: %o',p),this.safeEmit("error",p)}),this._dataChannel.addEventListener("close",()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||s.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};return pe.DataProducer=x,pe}var le={},Et;function br(){if(Et)return le;Et=1,Object.defineProperty(le,"__esModule",{value:!0}),le.DataConsumer=void 0;const f=$(),g=z(),v=new f.Logger("DataConsumer");let s=class extends g.EnhancedEventEmitter{_id;_dataProducerId;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new g.EnhancedEventEmitter;constructor({id:E,dataProducerId:_,dataChannel:p,sctpStreamParameters:R,appData:C}){super(),v.debug("constructor()"),this._id=E,this._dataProducerId=_,this._dataChannel=p,this._sctpStreamParameters=R,this._appData=C??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(E){this._dataChannel.binaryType=E}get appData(){return this._appData}set appData(E){this._appData=E}get observer(){return this._observer}close(){this._closed||(v.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(v.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(v.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",E=>{if(this._closed)return;const _=E.error??new Error("unknown DataChannel error");E.error?.errorDetail==="sctp-failure"?v.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",E.error?.sctpCauseCode,E.error.message):v.error('DataChannel "error" event: %o',_),this.safeEmit("error",_)}),this._dataChannel.addEventListener("close",()=>{this._closed||(v.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",E=>{this._closed||this.safeEmit("message",E.data)})}};return le.DataConsumer=s,le}var Tt;function yr(){if(Tt)return ne;Tt=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.Transport=void 0;const f=gr(),g=$(),v=z(),s=U(),x=ee(),E=V(),_=_r(),p=vr(),R=wr(),C=br(),t=new g.Logger("Transport");class a{consumerOptions;promise;resolve;reject;constructor(b){this.consumerOptions=b,this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}let o=class extends v.EnhancedEventEmitter{_id;_closed=!1;_direction;_getSendExtendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind;_maxSctpMessageSize;_handler;_iceGatheringState="new";_connectionState="new";_appData;_producers=new Map;_consumers=new Map;_dataProducers=new Map;_dataConsumers=new Map;_probatorConsumerCreated=!1;_awaitQueue=new f.AwaitQueue;_pendingConsumerTasks=[];_consumerCreationInProgress=!1;_pendingPauseConsumers=new Map;_consumerPauseInProgress=!1;_pendingResumeConsumers=new Map;_consumerResumeInProgress=!1;_pendingCloseConsumers=new Map;_consumerCloseInProgress=!1;_observer=new v.EnhancedEventEmitter;constructor({direction:b,id:e,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w,iceServers:h,iceTransportPolicy:m,additionalSettings:u,appData:n,handlerFactory:l,getSendExtendedRtpCapabilities:S,recvRtpCapabilities:T,canProduceByKind:I}){super(),t.debug("constructor() [id:%s, direction:%s]",e,b),this._id=e,this._direction=b,this._getSendExtendedRtpCapabilities=S,this._recvRtpCapabilities=T,this._canProduceByKind=I,this._maxSctpMessageSize=w?w.maxMessageSize:null;const M=x.clone(u)??{};delete M.iceServers,delete M.iceTransportPolicy,delete M.bundlePolicy,delete M.rtcpMuxPolicy,this._handler=l.factory({direction:b,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w,iceServers:h,iceTransportPolicy:m,additionalSettings:M,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities}),this._appData=n??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(b){this._appData=b}get observer(){return this._observer}close(){if(!this._closed){t.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const b of this._producers.values())b.transportClosed();this._producers.clear();for(const b of this._consumers.values())b.transportClosed();this._consumers.clear();for(const b of this._dataProducers.values())b.transportClosed();this._dataProducers.clear();for(const b of this._dataConsumers.values())b.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close"),super.close(),this._observer.close()}}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:b}){if(t.debug("restartIce()"),this._closed)throw new s.InvalidStateError("closed");if(!b)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(b),"transport.restartIce()")}async updateIceServers({iceServers:b}={}){if(t.debug("updateIceServers()"),this._closed)throw new s.InvalidStateError("closed");if(!Array.isArray(b))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(b),"transport.updateIceServers()")}async produce({track:b,streamId:e,encodings:r,codecOptions:i,headerExtensionOptions:c,codec:w,stopTracks:h=!0,disableTrackOnPause:m=!0,zeroRtpOnPause:u=!1,onRtpSender:n,appData:l={}}={}){if(t.debug("produce() [track:%o]",b),this._closed)throw new s.InvalidStateError("closed");if(b){if(this._direction!=="send")throw new s.UnsupportedError("not a sending Transport");if(this._canProduceByKind[b.kind]){if(b.readyState==="ended")throw new s.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(l&&typeof l!="object")throw new TypeError("if given, appData must be an object")}else throw new s.UnsupportedError(`cannot produce ${b.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let S;if(r&&!Array.isArray(r))throw TypeError("encodings must be an array");r?.length===0?S=void 0:r&&(S=r.map(d=>{const D={active:!0};return d.active===!1&&(D.active=!1),typeof d.dtx=="boolean"&&(D.dtx=d.dtx),typeof d.scalabilityMode=="string"&&(D.scalabilityMode=d.scalabilityMode),typeof d.scaleResolutionDownBy=="number"&&(D.scaleResolutionDownBy=d.scaleResolutionDownBy),typeof d.maxBitrate=="number"&&(D.maxBitrate=d.maxBitrate),typeof d.maxFramerate=="number"&&(D.maxFramerate=d.maxFramerate),typeof d.adaptivePtime=="boolean"&&(D.adaptivePtime=d.adaptivePtime),typeof d.priority=="string"&&(D.priority=d.priority),typeof d.networkPriority=="string"&&(D.networkPriority=d.networkPriority),D}));const{localId:T,rtpParameters:I,rtpSender:M}=await this._handler.send({track:b,streamId:e,encodings:S,codecOptions:i,headerExtensionOptions:c,codec:w,onRtpSender:n});try{E.validateAndNormalizeRtpParameters(I);const{id:d}=await new Promise((P,k)=>{this.safeEmit("produce",{kind:b.kind,rtpParameters:I,appData:l},P,k)}),D=new _.Producer({id:d,localId:T,rtpSender:M,track:b,rtpParameters:I,stopTracks:h,disableTrackOnPause:m,zeroRtpOnPause:u,appData:l});return this._producers.set(D.id,D),this.handleProducer(D),this._observer.safeEmit("newproducer",D),D}catch(d){throw this._handler.stopSending(T).catch(()=>{}),d}},"transport.produce()").catch(S=>{if(h)try{b.stop()}catch{}throw S})}async consume({id:b,producerId:e,kind:r,rtpParameters:i,streamId:c,onRtpReceiver:w,appData:h={}}){if(t.debug("consume()"),this._closed)throw new s.InvalidStateError("closed");if(this._direction!=="recv")throw new s.UnsupportedError("not a receiving Transport");if(typeof b!="string")throw new TypeError("missing id");if(typeof e!="string")throw new TypeError("missing producerId");if(r!=="audio"&&r!=="video")throw new TypeError(`invalid kind '${r}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(h&&typeof h!="object")throw new TypeError("if given, appData must be an object");const m=x.clone(i);if(!E.canReceive(m,this._recvRtpCapabilities))throw new s.UnsupportedError("cannot consume this Producer");const n=new a({id:b,producerId:e,kind:r,rtpParameters:m,streamId:c,onRtpReceiver:w,appData:h});return this._pendingConsumerTasks.push(n),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),n.promise}async produceData({ordered:b=!0,maxPacketLifeTime:e,maxRetransmits:r,label:i="",protocol:c="",appData:w={}}={}){if(t.debug("produceData()"),this._closed)throw new s.InvalidStateError("closed");if(this._direction!=="send")throw new s.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(w&&typeof w!="object")throw new TypeError("if given, appData must be an object")}else throw new s.UnsupportedError("SCTP not enabled by remote Transport");return(e||r)&&(b=!1),this._awaitQueue.push(async()=>{const{dataChannel:h,sctpStreamParameters:m}=await this._handler.sendDataChannel({ordered:b,maxPacketLifeTime:e,maxRetransmits:r,label:i,protocol:c});E.validateAndNormalizeSctpStreamParameters(m);const{id:u}=await new Promise((l,S)=>{this.safeEmit("producedata",{sctpStreamParameters:m,label:i,protocol:c,appData:w},l,S)}),n=new R.DataProducer({id:u,dataChannel:h,sctpStreamParameters:m,appData:w});return this._dataProducers.set(n.id,n),this.handleDataProducer(n),this._observer.safeEmit("newdataproducer",n),n},"transport.produceData()")}async consumeData({id:b,dataProducerId:e,sctpStreamParameters:r,label:i="",protocol:c="",appData:w={}}){if(t.debug("consumeData()"),this._closed)throw new s.InvalidStateError("closed");if(this._direction!=="recv")throw new s.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof b!="string")throw new TypeError("missing id");if(typeof e!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(w&&typeof w!="object")throw new TypeError("if given, appData must be an object")}else throw new s.UnsupportedError("SCTP not enabled by remote Transport");const h=x.clone(r);return E.validateAndNormalizeSctpStreamParameters(h),this._awaitQueue.push(async()=>{const{dataChannel:m}=await this._handler.receiveDataChannel({sctpStreamParameters:h,label:i,protocol:c}),u=new C.DataConsumer({id:b,dataProducerId:e,dataChannel:m,sctpStreamParameters:h,appData:w});return this._dataConsumers.set(u.id,u),this.handleDataConsumer(u),this._observer.safeEmit("newdataconsumer",u),u},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){t.debug("createPendingConsumers() | there is no Consumer to be created");return}const b=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let e;const r=[];for(const i of b){const{id:c,kind:w,rtpParameters:h,streamId:m,onRtpReceiver:u}=i.consumerOptions;r.push({trackId:c,kind:w,rtpParameters:h,streamId:m,onRtpReceiver:u})}try{const i=await this._handler.receive(r);for(let c=0;c<i.length;++c){const w=b[c],h=i[c],{id:m,producerId:u,kind:n,rtpParameters:l,appData:S}=w.consumerOptions,{localId:T,rtpReceiver:I,track:M}=h,d=new p.Consumer({id:m,localId:T,producerId:u,rtpReceiver:I,track:M,rtpParameters:l,appData:S});this._consumers.set(d.id,d),this.handleConsumer(d),!this._probatorConsumerCreated&&!e&&n==="video"&&(e=d),this._observer.safeEmit("newconsumer",d),w.resolve(d)}}catch(i){for(const c of b)c.reject(i)}if(e)try{const i=E.generateProbatorRtpParameters(e.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:i}]),t.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(i){t.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",i)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){t.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const b=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const e=b.map(r=>r.localId);await this._handler.pauseReceiving(e)}catch(e){t.error("pausePendingConsumers() | failed to pause Consumers:",e)}},"transport.pausePendingConsumers()").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){t.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const b=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const e=b.map(r=>r.localId);await this._handler.resumeReceiving(e)}catch(e){t.error("resumePendingConsumers() | failed to resume Consumers:",e)}},"transport.resumePendingConsumers()").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){t.debug("closePendingConsumers() | there is no Consumer to be closed");return}const b=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(b.map(e=>e.localId))}catch(e){t.error("closePendingConsumers() | failed to close Consumers:",e)}},"transport.closePendingConsumers()").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const b=this._handler;b.on("@connect",({dtlsParameters:e},r,i)=>{if(this._closed){i(new s.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:e},r,i)}),b.on("@icegatheringstatechange",e=>{e!==this._iceGatheringState&&(t.debug("ICE gathering state changed to %s",e),this._iceGatheringState=e,this._closed||this.safeEmit("icegatheringstatechange",e))}),b.on("@icecandidateerror",e=>{t.warn(`ICE candidate error [url:${e.url}, localAddress:${e.address}, localPort:${e.port}]: ${e.errorCode} "${e.errorText}"`),this.safeEmit("icecandidateerror",e)}),b.on("@connectionstatechange",e=>{e!==this._connectionState&&(t.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))})}handleProducer(b){b.on("@close",()=>{this._producers.delete(b.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(b.localId),"producer @close event").catch(e=>t.warn("producer.close() failed:%o",e))}),b.on("@pause",(e,r)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(b.localId),"producer @pause event").then(e).catch(r)}),b.on("@resume",(e,r)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(b.localId),"producer @resume event").then(e).catch(r)}),b.on("@replacetrack",(e,r,i)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(b.localId,e),"producer @replacetrack event").then(r).catch(i)}),b.on("@setmaxspatiallayer",(e,r,i)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(b.localId,e),"producer @setmaxspatiallayer event").then(r).catch(i)}),b.on("@setrtpencodingparameters",(e,r,i)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(b.localId,e),"producer @setrtpencodingparameters event").then(r).catch(i)}),b.on("@getstats",(e,r)=>{if(this._closed)return r(new s.InvalidStateError("closed"));this._handler.getSenderStats(b.localId).then(e).catch(r)})}handleConsumer(b){b.on("@close",()=>{this._consumers.delete(b.id),this._pendingPauseConsumers.delete(b.id),this._pendingResumeConsumers.delete(b.id),!this._closed&&(this._pendingCloseConsumers.set(b.id,b),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),b.on("@pause",()=>{this._pendingResumeConsumers.has(b.id)&&this._pendingResumeConsumers.delete(b.id),this._pendingPauseConsumers.set(b.id,b),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),b.on("@resume",()=>{this._pendingPauseConsumers.has(b.id)&&this._pendingPauseConsumers.delete(b.id),this._pendingResumeConsumers.set(b.id,b),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),b.on("@getstats",(e,r)=>{if(this._closed)return r(new s.InvalidStateError("closed"));this._handler.getReceiverStats(b.localId).then(e).catch(r)})}handleDataProducer(b){b.on("@close",()=>{this._dataProducers.delete(b.id)})}handleDataConsumer(b){b.on("@close",()=>{this._dataConsumers.delete(b.id)})}};return ne.Transport=o,ne}var ue={},B={},Ke={},Je={exports:{}},xt;function Xe(){if(xt)return Je.exports;xt=1;var f=Je.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(g){return g.encoding?"rtpmap:%d %s/%s/%s":g.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(g){return g.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(g){return g.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(g){return"extmap:%d"+(g.direction?"/%s":"%v")+(g["encrypt-uri"]?" %s":"%v")+" %s"+(g.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(g){return g.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{push:"msid",reg:/^msid:([\w-]+)(?: ([\w-]+))?/,names:["id","appdata"],format:"msid:%s %s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(g){var v="candidate:%s %d %s %d %s %d typ %s";return v+=g.raddr!=null?" raddr %s rport %d":"%v%v",v+=g.tcptype!=null?" tcptype %s":"%v",g.generation!=null&&(v+=" generation %d"),v+=g["network-id"]!=null?" network-id %d":"%v",v+=g["network-cost"]!=null?" network-cost %d":"%v",v}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(g){var v="ssrc:%d";return g.attribute!=null&&(v+=" %s",g.value!=null&&(v+=":%s")),v}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(g){return g.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(g){return g.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(g){return"imageattr:%s %s %s"+(g.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(g){return"simulcast:%s %s"+(g.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(g){return"ts-refclk:%s"+(g.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(g){var v="mediaclk:";return v+=g.id!=null?"id=%s %s":"%v%s",v+=g.mediaClockValue!=null?"=%s":"",v+=g.rateNumerator!=null?" rate=%s":"",v+=g.rateDenominator!=null?"/%s":"",v}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(f).forEach(function(g){var v=f[g];v.forEach(function(s){s.reg||(s.reg=/(.*)/),s.format||(s.format="%s")})}),Je.exports}var kt;function Cr(){return kt||(kt=1,(function(f){var g=function(p){return String(Number(p))===p?Number(p):p},v=function(p,R,C,t){if(t&&!C)R[t]=g(p[1]);else for(var a=0;a<C.length;a+=1)p[a+1]!=null&&(R[C[a]]=g(p[a+1]))},s=function(p,R,C){var t=p.name&&p.names;p.push&&!R[p.push]?R[p.push]=[]:t&&!R[p.name]&&(R[p.name]={});var a=p.push?{}:t?R[p.name]:R;v(C.match(p.reg),a,p.names,p.name),p.push&&R[p.push].push(a)},x=Xe(),E=RegExp.prototype.test.bind(/^([a-z])=(.*)/);f.parse=function(p){var R={},C=[],t=R;return p.split(/(\r\n|\r|\n)/).filter(E).forEach(function(a){var o=a[0],y=a.slice(2);o==="m"&&(C.push({rtp:[],fmtp:[]}),t=C[C.length-1]);for(var b=0;b<(x[o]||[]).length;b+=1){var e=x[o][b];if(e.reg.test(y))return s(e,t,y)}}),R.media=C,R};var _=function(p,R){var C=R.split(/=(.+)/,2);return C.length===2?p[C[0]]=g(C[1]):C.length===1&&R.length>1&&(p[C[0]]=void 0),p};f.parseParams=function(p){return p.split(/;\s?/).reduce(_,{})},f.parseFmtpConfig=f.parseParams,f.parsePayloads=function(p){return p.toString().split(" ").map(Number)},f.parseRemoteCandidates=function(p){for(var R=[],C=p.split(" ").map(g),t=0;t<C.length;t+=3)R.push({component:C[t],ip:C[t+1],port:C[t+2]});return R},f.parseImageAttributes=function(p){return p.split(" ").map(function(R){return R.substring(1,R.length-1).split(",").reduce(_,{})})},f.parseSimulcastStreamList=function(p){return p.split(";").map(function(R){return R.split(",").map(function(C){var t,a=!1;return C[0]!=="~"?t=g(C):(t=g(C.substring(1,C.length)),a=!0),{scid:t,paused:a}})})}})(Ke)),Ke}var Ze,Dt;function Sr(){if(Dt)return Ze;Dt=1;var f=Xe(),g=/%[sdv%]/g,v=function(_){var p=1,R=arguments,C=R.length;return _.replace(g,function(t){if(p>=C)return t;var a=R[p];switch(p+=1,t){case"%%":return"%";case"%s":return String(a);case"%d":return Number(a);case"%v":return""}})},s=function(_,p,R){var C=p.format instanceof Function?p.format(p.push?R:R[p.name]):p.format,t=[_+"="+C];if(p.names)for(var a=0;a<p.names.length;a+=1){var o=p.names[a];p.name?t.push(R[p.name][o]):t.push(R[p.names[a]])}else t.push(R[p.name]);return v.apply(null,t)},x=["v","o","s","i","u","e","p","c","b","t","r","z","a"],E=["i","c","b","a"];return Ze=function(_,p){p=p||{},_.version==null&&(_.version=0),_.name==null&&(_.name=" "),_.media.forEach(function(a){a.payloads==null&&(a.payloads="")});var R=p.outerOrder||x,C=p.innerOrder||E,t=[];return R.forEach(function(a){f[a].forEach(function(o){o.name in _&&_[o.name]!=null?t.push(s(a,o,_)):o.push in _&&_[o.push]!=null&&_[o.push].forEach(function(y){t.push(s(a,o,y))})})}),_.media.forEach(function(a){t.push(s("m",f.m[0],a)),C.forEach(function(o){f[o].forEach(function(y){y.name in a&&a[y.name]!=null?t.push(s(o,y,a)):y.push in a&&a[y.push]!=null&&a[y.push].forEach(function(b){t.push(s(o,y,b))})})})}),t.join(`\r
`)+`\r
`},Ze}var Pt;function Q(){if(Pt)return B;Pt=1;var f=Cr(),g=Sr(),v=Xe();return B.grammar=v,B.write=g,B.parse=f.parse,B.parseParams=f.parseParams,B.parseFmtpConfig=f.parseFmtpConfig,B.parsePayloads=f.parsePayloads,B.parseRemoteCandidates=f.parseRemoteCandidates,B.parseImageAttributes=f.parseImageAttributes,B.parseSimulcastStreamList=f.parseSimulcastStreamList,B}var Ie={},Lt;function te(){if(Lt)return Ie;Lt=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.parse=g;const f=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function g(v){const s=f.exec(v??"");return s?{spatialLayers:Number(s[1]),temporalLayers:Number(s[2])}:{spatialLayers:1,temporalLayers:1}}return Ie}var he={},H={},It;function Rr(){if(It)return H;It=1,Object.defineProperty(H,"__esModule",{value:!0}),H.OfferMediaSection=H.AnswerMediaSection=H.MediaSection=void 0;const f=Q(),g=ee();let v=class{_mediaObject;constructor({iceParameters:p,iceCandidates:R,dtlsParameters:C}){if(this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},p&&this.setIceParameters(p),R){this._mediaObject.candidates=[];for(const t of R){const a={foundation:t.foundation,component:1,ip:t.address??t.ip,port:t.port,priority:t.priority,transport:t.protocol,type:t.type};t.tcpType&&(a.tcptype=t.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}C&&this.setDtlsRole(C.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(p){this._mediaObject.iceUfrag=p.usernameFragment,this._mediaObject.icePwd=p.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};H.MediaSection=v;class s extends v{constructor({iceParameters:p,iceCandidates:R,dtlsParameters:C,sctpParameters:t,plainRtpParameters:a,offerMediaObject:o,offerRtpParameters:y,answerRtpParameters:b,codecOptions:e}){switch(super({iceParameters:p,iceCandidates:R,dtlsParameters:C}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const r of b.codecs){const i={payload:r.payloadType,codec:E(r),rate:r.clockRate};r.channels>1&&(i.encoding=r.channels),this._mediaObject.rtp.push(i);const c=g.clone(r.parameters)??{};let w=g.clone(r.rtcpFeedback)??[];if(e){const{opusStereo:m,opusFec:u,opusDtx:n,opusMaxPlaybackRate:l,opusMaxAverageBitrate:S,opusPtime:T,opusNack:I,videoGoogleStartBitrate:M,videoGoogleMaxBitrate:d,videoGoogleMinBitrate:D}=e,P=y.codecs.find(k=>k.payloadType===r.payloadType);switch(r.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{m!==void 0&&(P.parameters["sprop-stereo"]=m?1:0,c.stereo=m?1:0),u!==void 0&&(P.parameters.useinbandfec=u?1:0,c.useinbandfec=u?1:0),n!==void 0&&(P.parameters.usedtx=n?1:0,c.usedtx=n?1:0),l!==void 0&&(c.maxplaybackrate=l),S!==void 0&&(c.maxaveragebitrate=S),T!==void 0&&(P.parameters.ptime=T,c.ptime=T),I||(P.rtcpFeedback=P.rtcpFeedback.filter(k=>k.type!=="nack"||k.parameter),w=w.filter(k=>k.type!=="nack"||k.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{M!==void 0&&(c["x-google-start-bitrate"]=M),d!==void 0&&(c["x-google-max-bitrate"]=d),D!==void 0&&(c["x-google-min-bitrate"]=D);break}}}const h={payload:r.payloadType,config:""};for(const m of Object.keys(c))h.config&&(h.config+=";"),h.config+=`${m}=${c[m]}`;h.config&&this._mediaObject.fmtp.push(h);for(const m of w)this._mediaObject.rtcpFb.push({payload:r.payloadType,type:m.type,subtype:m.parameter})}this._mediaObject.payloads=b.codecs.map(r=>r.payloadType).join(" "),this._mediaObject.ext=[];for(const r of b.headerExtensions)(o.ext??[]).some(c=>c.uri===r.uri)&&this._mediaObject.ext.push({uri:r.uri,value:r.id});if(o.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const r of o.rids??[])r.direction==="send"&&this._mediaObject.rids.push({id:r.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const r of o.rids??[])r.direction==="send"&&this._mediaObject.rids.push({id:r.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";break}case"application":{typeof o.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=t.port,this._mediaObject.maxMessageSize=t.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=String(t.port),this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:t.port,maxMessageSize:t.maxMessageSize});break}}}setDtlsRole(p){switch(p){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(p){if(!this._mediaObject.simulcast?.list1)return;const R={};for(const a of p)a.rid&&(R[a.rid]=a);const C=this._mediaObject.simulcast.list1,t=f.parseSimulcastStreamList(C);for(const a of t)for(const o of a)o.paused=!R[o.scid]?.active;this._mediaObject.simulcast.list1=t.map(a=>a.map(o=>`${o.paused?"~":""}${o.scid}`).join(",")).join(";")}}H.AnswerMediaSection=s;class x extends v{constructor({iceParameters:p,iceCandidates:R,dtlsParameters:C,sctpParameters:t,plainRtpParameters:a,mid:o,kind:y,offerRtpParameters:b,streamId:e,trackId:r}){switch(super({iceParameters:p,iceCandidates:R,dtlsParameters:C}),this._mediaObject.mid=String(o),this._mediaObject.type=y,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},t?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",y){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._mediaObject.msid=[{id:e,appdata:r}];for(const h of b.codecs){const m={payload:h.payloadType,codec:E(h),rate:h.clockRate};h.channels>1&&(m.encoding=h.channels),this._mediaObject.rtp.push(m);const u={payload:h.payloadType,config:""};for(const n of Object.keys(h.parameters??{}))u.config&&(u.config+=";"),u.config+=`${n}=${h.parameters[n]}`;u.config&&this._mediaObject.fmtp.push(u);for(const n of h.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:h.payloadType,type:n.type,subtype:n.parameter})}this._mediaObject.payloads=b.codecs.map(h=>h.payloadType).join(" "),this._mediaObject.ext=[];for(const h of b.headerExtensions)this._mediaObject.ext.push({uri:h.uri,value:h.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const i=b.encodings[0],c=i.ssrc,w=i.rtx?.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c&&b.rtcp.cname&&this._mediaObject.ssrcs.push({id:c,attribute:"cname",value:b.rtcp.cname}),w&&(b.rtcp.cname&&this._mediaObject.ssrcs.push({id:w,attribute:"cname",value:b.rtcp.cname}),c&&this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${c} ${w}`}));break}case"application":{this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=t.port,this._mediaObject.maxMessageSize=t.maxMessageSize;break}}}setDtlsRole(p){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}}H.OfferMediaSection=x;function E(_){const R=new RegExp("^(audio|video)/(.+)","i").exec(_.mimeType);if(!R)throw new TypeError("invalid codec.mimeType");return R[2]}return H}var Mt;function Re(){if(Mt)return he;Mt=1,Object.defineProperty(he,"__esModule",{value:!0}),he.RemoteSdp=void 0;const f=Q(),g=$(),v=Rr(),s=["av1","h264"],x=new g.Logger("RemoteSdp");let E=class{_iceParameters;_iceCandidates;_dtlsParameters;_sctpParameters;_plainRtpParameters;_mediaSections=[];_midToIndex=new Map;_firstMid;_sdpObject;constructor({iceParameters:p,iceCandidates:R,dtlsParameters:C,sctpParameters:t,plainRtpParameters:a}){if(this._iceParameters=p,this._iceCandidates=R,this._dtlsParameters=C,this._sctpParameters=t,this._plainRtpParameters=a,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},this._sdpObject.iceOptions="ice2",p?.iceLite&&(this._sdpObject.icelite="ice-lite"),C){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const o=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:C.fingerprints[o-1].algorithm,hash:C.fingerprints[o-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}a&&(this._sdpObject.origin.address=a.ip,this._sdpObject.origin.ipVer=a.ipVersion)}updateIceParameters(p){x.debug("updateIceParameters() [iceParameters:%o]",p),this._iceParameters=p,this._sdpObject.icelite=p.iceLite?"ice-lite":void 0;for(const R of this._mediaSections)R.setIceParameters(p)}updateDtlsRole(p){x.debug("updateDtlsRole() [role:%s]",p),this._dtlsParameters.role=p;for(const R of this._mediaSections)R.setDtlsRole(p)}setSessionExtmapAllowMixed(){x.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let p=0;p<this._mediaSections.length;++p){const R=this._mediaSections[p];if(R.closed)return{idx:p,reuseMid:R.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:p,reuseMid:R,offerRtpParameters:C,answerRtpParameters:t,codecOptions:a}){const o=new v.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:p,offerRtpParameters:C,answerRtpParameters:t,codecOptions:a}),y=o.getObject();y.rtp.find(e=>s.includes(e.codec.toLowerCase()))||(y.ext=y.ext?.filter(e=>e.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),R?this.replaceMediaSection(o,R):this._midToIndex.has(o.mid)?this.replaceMediaSection(o):this.addMediaSection(o)}receive({mid:p,kind:R,offerRtpParameters:C,streamId:t,trackId:a}){this.setSessionExtmapAllowMixed();const o=new v.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:p,kind:R,offerRtpParameters:C,streamId:t,trackId:a}),y=this._mediaSections.find(b=>b.closed);y?this.replaceMediaSection(o,y.mid):this.addMediaSection(o)}pauseMediaSection(p){this.findMediaSection(p).pause()}resumeSendingMediaSection(p){this.findMediaSection(p).resume()}resumeReceivingMediaSection(p){this.findMediaSection(p).resume()}disableMediaSection(p){this.findMediaSection(p).disable()}closeMediaSection(p){const R=this.findMediaSection(p);return p===this._firstMid?(x.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",p),this.disableMediaSection(p),!1):(R.close(),this.regenerateBundleMids(),!0)}muxMediaSectionSimulcast(p,R){const C=this.findMediaSection(p);C.muxSimulcastStreams(R),this.replaceMediaSection(C)}sendSctpAssociation({offerMediaObject:p}){const R=new v.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:p});this.addMediaSection(R)}receiveSctpAssociation(){const p=new v.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this.addMediaSection(p)}getSdp(){return this._sdpObject.origin.sessionVersion++,f.write(this._sdpObject)}addMediaSection(p){this._firstMid||(this._firstMid=p.mid),this._mediaSections.push(p),this._midToIndex.set(p.mid,this._mediaSections.length-1),this._sdpObject.media.push(p.getObject()),this.regenerateBundleMids()}replaceMediaSection(p,R){if(typeof R=="string"){const C=this._midToIndex.get(R);if(C===void 0)throw new Error(`no media section found for reuseMid '${R}'`);const t=this._mediaSections[C];this._mediaSections[C]=p,this._midToIndex.delete(t.mid),this._midToIndex.set(p.mid,C),this._sdpObject.media[C]=p.getObject(),this.regenerateBundleMids()}else{const C=this._midToIndex.get(p.mid);if(C===void 0)throw new Error(`no media section found with mid '${p.mid}'`);this._mediaSections[C]=p,this._sdpObject.media[C]=p.getObject()}}findMediaSection(p){const R=this._midToIndex.get(p);if(R===void 0)throw new Error(`no media section found with mid '${p}'`);return this._mediaSections[R]}regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(p=>!p.closed).map(p=>p.mid).join(" "))}};return he.RemoteSdp=E,he}var G={},Ft;function Ee(){if(Ft)return G;Ft=1,Object.defineProperty(G,"__esModule",{value:!0}),G.extractRtpCapabilities=g,G.extractDtlsParameters=v,G.getCname=s,G.applyCodecParameters=x,G.addHeaderExtension=E;const f=Q();function g({sdpObject:_}){const p=new Map,R=new Map;for(const t of _.media){const a=t.type;switch(a){case"audio":case"video":break;default:continue}for(const o of t.rtp){const y={kind:a,mimeType:`${a}/${o.codec}`,preferredPayloadType:o.payload,clockRate:o.rate,channels:o.encoding,parameters:{},rtcpFeedback:[]};p.set(y.preferredPayloadType,y)}for(const o of t.fmtp??[]){const y=f.parseParams(o.config),b=p.get(o.payload);b&&(y?.hasOwnProperty("profile-level-id")&&(y["profile-level-id"]=String(y["profile-level-id"])),b.parameters=y)}for(const o of t.rtcpFb??[]){const y={type:o.type,parameter:o.subtype};if(y.parameter||delete y.parameter,o.payload!=="*"){const b=p.get(Number(o.payload));if(!b)continue;b.rtcpFeedback.push(y)}else for(const b of p.values())b.kind===a&&!/.+\/rtx$/i.test(b.mimeType)&&b.rtcpFeedback.push(y)}for(const o of t.ext??[]){if(o["encrypt-uri"])continue;const y={kind:a,uri:o.uri,preferredId:o.value};R.set(y.preferredId,y)}}return{codecs:Array.from(p.values()),headerExtensions:Array.from(R.values())}}function v({sdpObject:_}){let p=_.setup,R=_.fingerprint;if(!p||!R){const a=(_.media??[]).find(o=>o.port!==0);a&&(p=p??a.setup,R=R??a.fingerprint)}if(p){if(!R)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let C;switch(p){case"active":{C="client";break}case"passive":{C="server";break}case"actpass":{C="auto";break}}return{role:C,fingerprints:[{algorithm:R.type,value:R.hash}]}}function s({offerMediaObject:_}){const p=(_.ssrcs??[]).find(R=>R.attribute==="cname");return p?p.value:""}function x({offerRtpParameters:_,answerMediaObject:p}){for(const R of _.codecs){const C=R.mimeType.toLowerCase();if(C!=="audio/opus"||!(p.rtp??[]).find(y=>y.payload===R.payloadType))continue;p.fmtp=p.fmtp??[];let a=p.fmtp.find(y=>y.payload===R.payloadType);a||(a={payload:R.payloadType,config:""},p.fmtp.push(a));const o=f.parseParams(a.config);switch(C){case"audio/opus":{const y=R.parameters?.["sprop-stereo"];y!==void 0&&(o.stereo=Number(y)?1:0);break}}a.config="";for(const y of Object.keys(o))a.config&&(a.config+=";"),a.config+=`${y}=${o[y]}`}}function E({offerMediaObject:_,headerExtensionUri:p,headerExtensionId:R}){_.ext||(_.ext=[]),_.ext.push({uri:p,value:R})}return G}var fe={},Ot;function Te(){if(Ot)return fe;Ot=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.getRtpEncodings=f,fe.addLegacySimulcast=g;function f({offerMediaObject:v}){const s=new Set;for(const _ of v.ssrcs??[]){const p=_.id;p&&s.add(p)}if(s.size===0)throw new Error("no a=ssrc lines found");const x=new Map;for(const _ of v.ssrcGroups??[]){if(_.semantics!=="FID")continue;const p=_.ssrcs.split(/\s+/),R=Number(p[0]),C=Number(p[1]);s.has(R)&&(s.delete(R),s.delete(C),x.set(R,C))}for(const _ of s)x.set(_,void 0);const E=[];for(const[_,p]of x){const R={ssrc:_};p&&(R.rtx={ssrc:p}),E.push(R)}return E}function g({offerMediaObject:v,numStreams:s}){if(s<=1)throw new TypeError("numStreams must be greater than 1");const x=(v.ssrcs??[]).find(y=>y.attribute==="msid");if(!x)throw new Error("a=ssrc line with msid information not found");const[E,_]=x.value.split(" "),p=Number(x.id);let R;(v.ssrcGroups??[]).some(y=>{if(y.semantics!=="FID")return!1;const b=y.ssrcs.split(/\s+/);return Number(b[0])===p?(R=Number(b[1]),!0):!1});const C=(v.ssrcs??[]).find(y=>y.attribute==="cname");if(!C)throw new Error("a=ssrc line with cname information not found");const t=C.value,a=[],o=[];for(let y=0;y<s;++y)a.push(p+y),R&&o.push(R+y);v.ssrcGroups=[],v.ssrcs=[],v.ssrcGroups.push({semantics:"SIM",ssrcs:a.join(" ")});for(const y of a)v.ssrcs.push({id:y,attribute:"cname",value:t}),v.ssrcs.push({id:y,attribute:"msid",value:`${E} ${_}`});for(let y=0;y<o.length;++y){const b=a[y],e=o[y];v.ssrcs.push({id:e,attribute:"cname",value:t}),v.ssrcs.push({id:e,attribute:"msid",value:`${E} ${_}`}),v.ssrcGroups.push({semantics:"FID",ssrcs:`${b} ${e}`})}}return fe}var X={},At;function xe(){if(At)return X;At=1,Object.defineProperty(X,"__esModule",{value:!0}),X.addNackSupportForOpus=f,X.addHeaderExtensionSupport=g,X.getMsidStreamIdAndTrackId=v;function f(s){for(const x of s.codecs??[])(x.mimeType.toLowerCase()==="audio/opus"||x.mimeType.toLowerCase()==="audio/multiopus")&&!x.rtcpFeedback?.some(E=>E.type==="nack"&&!E.parameter)&&(x.rtcpFeedback||(x.rtcpFeedback=[]),x.rtcpFeedback.push({type:"nack"}))}function g(s,x){if(s.headerExtensions?.some(R=>R.kind===x.kind&&R.uri===x.uri))return;s.headerExtensions||(s.headerExtensions=[]);const E=new Set(s.headerExtensions.filter(R=>R.uri!==x.uri).map(R=>R.preferredId));let _=1;for(;E.has(_);)++_;const p={kind:x.kind,uri:x.uri,preferredId:_,preferredEncrypt:!1,direction:x.direction};s.headerExtensions.push(p)}function v(s){if(!s||typeof s!="string")return{msidStreamId:void 0,msidTrackId:void 0};const[x,E]=s.trim().split(/\s+/);return x?{msidStreamId:x,msidTrackId:E}:{msidStreamId:void 0,msidTrackId:void 0}}return X}var Nt;function Er(){if(Nt)return ue;Nt=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.Chrome111=void 0;const f=Q(),g=z(),v=$(),s=V(),x=U(),E=te(),_=Re(),p=Ee(),R=Te(),C=xe(),t=new v.Logger("Chrome111"),a="Chrome111",o={OS:1024,MIS:1024};let y=class Fe extends g.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:a,factory:e=>new Fe(e),getNativeRtpCapabilities:async()=>{t.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const r=await e.createOffer();try{e.close()}catch{}e=void 0;const i=f.parse(r.sdp);return Fe.getLocalRtpCapabilities(i)}catch(r){try{e?.close()}catch{}throw e=void 0,r}},getNativeSctpCapabilities:async()=>(t.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e,r=[]){const i=p.extractRtpCapabilities({sdpObject:e});s.validateAndNormalizeRtpCapabilities(i),C.addNackSupportForOpus(i);for(const c of r)C.addHeaderExtensionSupport(i,c);return i}constructor({direction:e,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w,iceServers:h,iceTransportPolicy:m,additionalSettings:u,getSendExtendedRtpCapabilities:n}){super(),t.debug("constructor()"),this._direction=e,this._remoteSdp=new _.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w}),this._getSendExtendedRtpCapabilities=n,c.role&&c.role!=="auto"&&(this._forcedLocalDtlsRole=c.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:m??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(t.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return a}close(){if(t.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),t.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=e,this._pc.setConfiguration(r)}async restartIce(e){if(this.assertNotClosed(),t.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});t.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:r,encodings:i,codecOptions:c,headerExtensionOptions:w,codec:h,onRtpSender:m}){if(this.assertNotClosed(),this.assertSendDirection(),t.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,r),i&&i.length>1){let F=1;for(const O of i){const A=O.scalabilityMode?(0,E.parse)(O.scalabilityMode).temporalLayers:3;A>F&&(F=A)}i.forEach((O,A)=>{O.rid=`r${A}`,O.scalabilityMode=`L1T${F}`})}const u=this._remoteSdp.getNextMediaSectionIdx(),n=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i});m&&m(n.sender);let l=await this._pc.createOffer(),S=f.parse(l.sdp);S.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const T=[];T.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:e.kind,direction:"sendonly"});const I=Fe.getLocalRtpCapabilities(S,T),M=this._getSendExtendedRtpCapabilities(I),d=s.getSendingRtpParameters(e.kind,M);d.codecs=s.reduceCodecs(d.codecs,h);const D=s.getSendingRemoteRtpParameters(e.kind,M);if(D.codecs=s.reduceCodecs(D.codecs,h),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:S}),w?.absCaptureTime){const F=S.media[u.idx];p.addHeaderExtension({offerMediaObject:F,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:D.headerExtensions.find(O=>O.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),l={type:"offer",sdp:f.write(S)}}t.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const P=n.mid;d.mid=P,S=f.parse(this._pc.localDescription.sdp);const k=S.media[u.idx];if(d.rtcp.cname=p.getCname({offerMediaObject:k}),d.msid=`${r??this._sendStream.id} ${e.id}`,!i)d.encodings=R.getRtpEncodings({offerMediaObject:k});else if(i.length===1){const F=R.getRtpEncodings({offerMediaObject:k});Object.assign(F[0],i[0]),d.encodings=F}else d.encodings=i;this._remoteSdp.send({offerMediaObject:k,reuseMid:u.reuseMid,offerRtpParameters:d,answerRtpParameters:D,codecOptions:c});const L={type:"answer",sdp:this._remoteSdp.getSdp()};return t.debug("send() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L),this._mapMidTransceiver.set(P,n),{localId:P,rtpParameters:d,rtpSender:n.sender}}async stopSending(e){if(this.assertSendDirection(),t.debug("stopSending() [localId:%s]",e),this._closed)return;const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const c=await this._pc.createOffer();t.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const w={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();t.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const i=await this._pc.createOffer();t.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?t.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):t.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{u<=r?m.active=!0:m.active=!1}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{c.encodings[u]={...m,...r}}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:w}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:i,protocol:w};t.debug("sendDataChannel() [options:%o]",h);const m=this._pc.createDataChannel(c,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const n=await this._pc.createOffer(),l=f.parse(n.sdp),S=l.media.find(I=>I.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),t.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),this._remoteSdp.sendSctpAssociation({offerMediaObject:S});const T={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._hasDataChannelMediaSection=!0}const u={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:m,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const m of e){const{trackId:u,kind:n,rtpParameters:l,streamId:S}=m;t.debug("receive() [trackId:%s, kind:%s]",u,n);const T=l.mid??String(this._mapMidTransceiver.size);i.set(u,T);const{msidStreamId:I}=C.getMsidStreamIdAndTrackId(l.msid);this._remoteSdp.receive({mid:T,kind:n,offerRtpParameters:l,streamId:S??I??l.rtcp?.cname??"-",trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const m of e){const{trackId:u,onRtpReceiver:n}=m;if(n){const l=i.get(u),S=this._pc.getTransceivers().find(T=>T.mid===l);if(!S)throw new Error("transceiver not found");n(S.receiver)}}let w=await this._pc.createAnswer();const h=f.parse(w.sdp);for(const m of e){const{trackId:u,rtpParameters:n}=m,l=i.get(u),S=h.media.find(T=>String(T.mid)===l);p.applyCodecParameters({offerRtpParameters:n,answerMediaObject:S})}w={type:"answer",sdp:f.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),t.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w);for(const m of e){const{trackId:u}=m,n=i.get(u),l=this._pc.getTransceivers().find(S=>S.mid===n);if(l)this._mapMidTransceiver.set(n,l),r.push({localId:n,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){t.debug("stopReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(w.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("pauseReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("resumeReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m}=e,u={negotiated:!0,id:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m,protocol:i};t.debug("receiveDataChannel() [options:%o]",u);const n=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const S=await this._pc.createAnswer();if(!this._transportReady){const T=f.parse(S.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T})}t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setLocalDescription(S),this._hasDataChannelMediaSection=!0}return{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=f.parse(this._pc.localDescription.sdp));const i=p.extractDtlsParameters({sdpObject:r});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,w)=>{this.safeEmit("@connect",{dtlsParameters:i},c,w)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new x.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ue.Chrome111=y,ue}var me={},jt;function Tr(){if(jt)return me;jt=1,Object.defineProperty(me,"__esModule",{value:!0}),me.Chrome74=void 0;const f=Q(),g=$(),v=z(),s=V(),x=U(),E=te(),_=Re(),p=Ee(),R=Te(),C=xe(),t=new g.Logger("Chrome74"),a="Chrome74",o={OS:1024,MIS:1024};let y=class Oe extends v.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:a,factory:e=>new Oe(e),getNativeRtpCapabilities:async()=>{t.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch{}e=void 0;const i=f.parse(r.sdp);return Oe.getLocalRtpCapabilities(i)}catch(r){try{e?.close()}catch{}throw e=void 0,r}},getNativeSctpCapabilities:async()=>(t.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e,r=[]){const i=p.extractRtpCapabilities({sdpObject:e});s.validateAndNormalizeRtpCapabilities(i),C.addNackSupportForOpus(i);for(const c of r)C.addHeaderExtensionSupport(i,c);return i}constructor({direction:e,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w,iceServers:h,iceTransportPolicy:m,additionalSettings:u,getSendExtendedRtpCapabilities:n}){super(),t.debug("constructor()"),this._direction=e,this._remoteSdp=new _.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w}),this._getSendExtendedRtpCapabilities=n,c.role&&c.role!=="auto"&&(this._forcedLocalDtlsRole=c.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:m??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(t.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return a}close(){if(t.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),t.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=e,this._pc.setConfiguration(r)}async restartIce(e){if(this.assertNotClosed(),t.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});t.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:r,encodings:i,codecOptions:c,headerExtensionOptions:w,codec:h}){this.assertNotClosed(),this.assertSendDirection(),t.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,r),i&&i.length>1&&i.forEach((O,A)=>{O.rid=`r${A}`});const m=this._remoteSdp.getNextMediaSectionIdx(),u=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i});let n=await this._pc.createOffer(),l=f.parse(n.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const S=[];S.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:e.kind,direction:"sendonly"});const T=Oe.getLocalRtpCapabilities(l,S),I=this._getSendExtendedRtpCapabilities(T),M=s.getSendingRtpParameters(e.kind,I);M.codecs=s.reduceCodecs(M.codecs,h);const d=s.getSendingRemoteRtpParameters(e.kind,I);d.codecs=s.reduceCodecs(d.codecs,h),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l});let D=!1;const P=(0,E.parse)((i??[{}])[0].scalabilityMode);let k;i?.length===1&&P.spatialLayers>1&&M.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(t.debug("send() | enabling legacy simulcast for VP9 SVC"),D=!0,l=f.parse(n.sdp),k=l.media[m.idx],R.addLegacySimulcast({offerMediaObject:k,numStreams:P.spatialLayers}),n={type:"offer",sdp:f.write(l)}),t.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),w?.absCaptureTime&&(k=l.media[m.idx],p.addHeaderExtension({offerMediaObject:k,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:d.headerExtensions.find(O=>O.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),n={type:"offer",sdp:f.write(l)}),await this._pc.setLocalDescription(n);const L=u.mid;if(M.mid=L,l=f.parse(this._pc.localDescription.sdp),k=l.media[m.idx],M.rtcp.cname=p.getCname({offerMediaObject:k}),M.msid=`${r??this._sendStream.id} ${e.id}`,!i)M.encodings=R.getRtpEncodings({offerMediaObject:k});else if(i.length===1){let O=R.getRtpEncodings({offerMediaObject:k});Object.assign(O[0],i[0]),D&&(O=[O[0]]),M.encodings=O}else M.encodings=i;if(M.encodings.length>1&&(M.codecs[0].mimeType.toLowerCase()==="video/vp8"||M.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const O of M.encodings)O.scalabilityMode?O.scalabilityMode=`L1T${P.temporalLayers}`:O.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,reuseMid:m.reuseMid,offerRtpParameters:M,answerRtpParameters:d,codecOptions:c});const F={type:"answer",sdp:this._remoteSdp.getSdp()};return t.debug("send() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._mapMidTransceiver.set(L,u),{localId:L,rtpParameters:M,rtpSender:u.sender}}async stopSending(e){if(this.assertSendDirection(),t.debug("stopSending() [localId:%s]",e),this._closed)return;const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const c=await this._pc.createOffer();t.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const w={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();t.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const i=await this._pc.createOffer();t.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?t.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):t.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{u<=r?m.active=!0:m.active=!1}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{c.encodings[u]={...m,...r}}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:w}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:i,protocol:w};t.debug("sendDataChannel() [options:%o]",h);const m=this._pc.createDataChannel(c,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const n=await this._pc.createOffer(),l=f.parse(n.sdp),S=l.media.find(I=>I.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),t.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),this._remoteSdp.sendSctpAssociation({offerMediaObject:S});const T={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._hasDataChannelMediaSection=!0}const u={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:m,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const m of e){const{trackId:u,kind:n,rtpParameters:l,streamId:S}=m;t.debug("receive() [trackId:%s, kind:%s]",u,n);const T=l.mid??String(this._mapMidTransceiver.size);i.set(u,T);const{msidStreamId:I}=C.getMsidStreamIdAndTrackId(l.msid);this._remoteSdp.receive({mid:T,kind:n,offerRtpParameters:l,streamId:S??I??l.rtcp?.cname??"-",trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let w=await this._pc.createAnswer();const h=f.parse(w.sdp);for(const m of e){const{trackId:u,rtpParameters:n}=m,l=i.get(u),S=h.media.find(T=>String(T.mid)===l);p.applyCodecParameters({offerRtpParameters:n,answerMediaObject:S})}w={type:"answer",sdp:f.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),t.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w);for(const m of e){const{trackId:u}=m,n=i.get(u),l=this._pc.getTransceivers().find(S=>S.mid===n);if(l)this._mapMidTransceiver.set(n,l),r.push({localId:n,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){t.debug("stopReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(w.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("pauseReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("resumeReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m}=e,u={negotiated:!0,id:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m,protocol:i};t.debug("receiveDataChannel() [options:%o]",u);const n=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const S=await this._pc.createAnswer();if(!this._transportReady){const T=f.parse(S.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T})}t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setLocalDescription(S),this._hasDataChannelMediaSection=!0}return{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=f.parse(this._pc.localDescription.sdp));const i=p.extractDtlsParameters({sdpObject:r});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,w)=>{this.safeEmit("@connect",{dtlsParameters:i},c,w)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new x.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return me.Chrome74=y,me}var ge={},$t;function xr(){if($t)return ge;$t=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.Firefox120=void 0;const f=Q(),g=z(),v=$(),s=U(),x=V(),E=te(),_=Re(),p=Ee(),R=Te(),C=xe(),t=new v.Logger("Firefox120"),a="Firefox120",o={OS:16,MIS:2048};let y=class Ae extends g.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:a,factory:e=>new Ae(e),getNativeRtpCapabilities:async()=>{t.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const r=document.createElement("canvas");r.getContext("2d");const c=r.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"}),e.addTransceiver(c,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const w=await e.createOffer();try{r.remove()}catch{}try{c.stop()}catch{}try{e.close()}catch{}e=void 0;const h=f.parse(w.sdp);return Ae.getLocalRtpCapabilities(h)}catch(w){try{r.remove()}catch{}try{c.stop()}catch{}try{e?.close()}catch{}throw e=void 0,w}},getNativeSctpCapabilities:async()=>(t.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e){const r=p.extractRtpCapabilities({sdpObject:e});return x.validateAndNormalizeRtpCapabilities(r),r}constructor({direction:e,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w,iceServers:h,iceTransportPolicy:m,additionalSettings:u,getSendExtendedRtpCapabilities:n}){super(),t.debug("constructor()"),this._direction=e,this._remoteSdp=new _.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w}),this._getSendExtendedRtpCapabilities=n,this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:m??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(t.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return a}close(){if(t.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){throw this.assertNotClosed(),new s.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),t.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});t.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:r,encodings:i,codecOptions:c,codec:w,onRtpSender:h}){this.assertNotClosed(),this.assertSendDirection(),t.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,r),i&&i.length>1&&i.forEach((k,L)=>{k.rid=`r${L}`});const m=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i});h&&h(m.sender);const u=await this._pc.createOffer();let n=f.parse(u.sdp);n.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const l=Ae.getLocalRtpCapabilities(n),S=this._getSendExtendedRtpCapabilities(l),T=x.getSendingRtpParameters(e.kind,S);T.codecs=x.reduceCodecs(T.codecs,w);const I=x.getSendingRemoteRtpParameters(e.kind,S);I.codecs=x.reduceCodecs(I.codecs,w),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:n});const M=(0,E.parse)((i??[{}])[0].scalabilityMode);t.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const d=m.mid;T.mid=d,n=f.parse(this._pc.localDescription.sdp);const D=n.media[n.media.length-1];if(T.rtcp.cname=p.getCname({offerMediaObject:D}),T.msid=`${r??this._sendStream.id} ${e.id}`,!i)T.encodings=R.getRtpEncodings({offerMediaObject:D});else if(i.length===1){const k=R.getRtpEncodings({offerMediaObject:D});Object.assign(k[0],i[0]),T.encodings=k}else T.encodings=i;if(T.encodings.length>1&&(T.codecs[0].mimeType.toLowerCase()==="video/vp8"||T.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const k of T.encodings)k.scalabilityMode?k.scalabilityMode=`L1T${M.temporalLayers}`:k.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:D,offerRtpParameters:T,answerRtpParameters:I,codecOptions:c});const P={type:"answer",sdp:this._remoteSdp.getSdp()};return t.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._mapMidTransceiver.set(d,m),{localId:d,rtpParameters:T,rtpSender:m.sender}}async stopSending(e){if(this.assertSendDirection(),t.debug("stopSending() [localId:%s]",e),this._closed)return;const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid);const i=await this._pc.createOffer();t.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();t.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const i=await this._pc.createOffer();t.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?t.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):t.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated transceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{u<=r?m.active=!0:m.active=!1}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{c.encodings[u]={...m,...r}}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:w}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:i,protocol:w};t.debug("sendDataChannel() [options:%o]",h);const m=this._pc.createDataChannel(c,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const n=await this._pc.createOffer(),l=f.parse(n.sdp),S=l.media.find(I=>I.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l}),t.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),this._remoteSdp.sendSctpAssociation({offerMediaObject:S});const T={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._hasDataChannelMediaSection=!0}const u={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:m,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const m of e){const{trackId:u,kind:n,rtpParameters:l,streamId:S}=m;t.debug("receive() [trackId:%s, kind:%s]",u,n);const T=l.mid??String(this._mapMidTransceiver.size);i.set(u,T);const{msidStreamId:I}=C.getMsidStreamIdAndTrackId(l.msid);this._remoteSdp.receive({mid:T,kind:n,offerRtpParameters:l,streamId:S??I??l.rtcp?.cname??"-",trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const m of e){const{trackId:u,onRtpReceiver:n}=m;if(n){const l=i.get(u),S=this._pc.getTransceivers().find(T=>T.mid===l);if(!S)throw new Error("transceiver not found");n(S.receiver)}}let w=await this._pc.createAnswer();const h=f.parse(w.sdp);for(const m of e){const{trackId:u,rtpParameters:n}=m,l=i.get(u),S=h.media.find(T=>String(T.mid)===l);p.applyCodecParameters({offerRtpParameters:n,answerMediaObject:S}),w={type:"answer",sdp:f.write(h)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:h}),t.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w);for(const m of e){const{trackId:u}=m,n=i.get(u),l=this._pc.getTransceivers().find(S=>S.mid===n);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,l),r.push({localId:n,track:l.receiver.track,rtpReceiver:l.receiver})}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){t.debug("stopReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(w.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("pauseReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("resumeReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m}=e,u={negotiated:!0,id:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m,protocol:i};t.debug("receiveDataChannel() [options:%o]",u);const n=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const S=await this._pc.createAnswer();if(!this._transportReady){const T=f.parse(S.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:T})}t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setLocalDescription(S),this._hasDataChannelMediaSection=!0}return{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=f.parse(this._pc.localDescription.sdp));const i=p.extractDtlsParameters({sdpObject:r});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,w)=>{this.safeEmit("@connect",{dtlsParameters:i},c,w)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new s.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ge.Firefox120=y,ge}var _e={},zt;function kr(){if(zt)return _e;zt=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.Safari12=void 0;const f=Q(),g=z(),v=$(),s=V(),x=U(),E=te(),_=Re(),p=Ee(),R=Te(),C=xe(),t=new v.Logger("Safari12"),a="Safari12",o={OS:1024,MIS:1024};let y=class Ne extends g.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:a,factory:e=>new Ne(e),getNativeRtpCapabilities:async()=>{t.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch{}e=void 0;const i=f.parse(r.sdp);return Ne.getLocalRtpCapabilities(i)}catch(r){try{e?.close()}catch{}throw e=void 0,r}},getNativeSctpCapabilities:async()=>(t.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e,r=[]){const i=p.extractRtpCapabilities({sdpObject:e});s.validateAndNormalizeRtpCapabilities(i),C.addNackSupportForOpus(i);for(const c of r)C.addHeaderExtensionSupport(i,c);return i}constructor({direction:e,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w,iceServers:h,iceTransportPolicy:m,additionalSettings:u,getSendExtendedRtpCapabilities:n}){super(),t.debug("constructor()"),this._direction=e,this._remoteSdp=new _.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w}),this._getSendExtendedRtpCapabilities=n,c.role&&c.role!=="auto"&&(this._forcedLocalDtlsRole=c.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:m??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",l=>{this.emit("@icecandidateerror",l)}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(t.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return a}close(){if(t.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),t.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=e,this._pc.setConfiguration(r)}async restartIce(e){if(this.assertNotClosed(),t.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});t.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:r,encodings:i,codecOptions:c,headerExtensionOptions:w,codec:h,onRtpSender:m}){this.assertNotClosed(),this.assertSendDirection(),t.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,r);const u=this._remoteSdp.getNextMediaSectionIdx(),n=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});m&&m(n.sender);let l=await this._pc.createOffer(),S=f.parse(l.sdp);S.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const T=[];T.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:e.kind,direction:"sendonly"});const I=Ne.getLocalRtpCapabilities(S,T),M=this._getSendExtendedRtpCapabilities(I),d=s.getSendingRtpParameters(e.kind,M);d.codecs=s.reduceCodecs(d.codecs,h);const D=s.getSendingRemoteRtpParameters(e.kind,M);D.codecs=s.reduceCodecs(D.codecs,h);let P;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:S});const k=(0,E.parse)((i??[{}])[0].scalabilityMode);i&&i.length>1&&(t.debug("send() | enabling legacy simulcast"),S=f.parse(l.sdp),P=S.media[u.idx],R.addLegacySimulcast({offerMediaObject:P,numStreams:i.length}),l={type:"offer",sdp:f.write(S)}),w?.absCaptureTime&&(P=S.media[u.idx],p.addHeaderExtension({offerMediaObject:P,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:D.headerExtensions.find(O=>O.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),l={type:"offer",sdp:f.write(S)}),t.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const L=n.mid;if(d.mid=L,S=f.parse(this._pc.localDescription.sdp),P=S.media[u.idx],d.rtcp.cname=p.getCname({offerMediaObject:P}),d.msid=`${r??this._sendStream.id} ${e.id}`,d.encodings=R.getRtpEncodings({offerMediaObject:P}),i)for(let O=0;O<d.encodings.length;++O)i[O]&&Object.assign(d.encodings[O],i[O]);if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const O of d.encodings)O.scalabilityMode?O.scalabilityMode=`L1T${k.temporalLayers}`:O.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,reuseMid:u.reuseMid,offerRtpParameters:d,answerRtpParameters:D,codecOptions:c});const F={type:"answer",sdp:this._remoteSdp.getSdp()};return t.debug("send() | calling pc.setRemoteDescription() [answer:%o]",F),await this._pc.setRemoteDescription(F),this._mapMidTransceiver.set(L,n),{localId:L,rtpParameters:d,rtpSender:n.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;t.debug("stopSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const c=await this._pc.createOffer();t.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const w={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();t.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const i=await this._pc.createOffer();t.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?t.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):t.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{u<=r?m.active=!0:m.active=!1}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{c.encodings[u]={...m,...r}}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:w}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:i,protocol:w};t.debug("sendDataChannel() [options:%o]",h);const m=this._pc.createDataChannel(c,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const n=await this._pc.createOffer(),l=f.parse(n.sdp),S=l.media.find(I=>I.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),t.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),this._remoteSdp.sendSctpAssociation({offerMediaObject:S});const T={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._hasDataChannelMediaSection=!0}const u={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:m,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const m of e){const{trackId:u,kind:n,rtpParameters:l,streamId:S}=m;t.debug("receive() [trackId:%s, kind:%s]",u,n);const T=l.mid??String(this._mapMidTransceiver.size);i.set(u,T);const{msidStreamId:I}=C.getMsidStreamIdAndTrackId(l.msid);this._remoteSdp.receive({mid:T,kind:n,offerRtpParameters:l,streamId:S??I??l.rtcp?.cname??"-",trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const m of e){const{trackId:u,onRtpReceiver:n}=m;if(n){const l=i.get(u),S=this._pc.getTransceivers().find(T=>T.mid===l);if(!S)throw new Error("transceiver not found");n(S.receiver)}}let w=await this._pc.createAnswer();const h=f.parse(w.sdp);for(const m of e){const{trackId:u,rtpParameters:n}=m,l=i.get(u),S=h.media.find(T=>String(T.mid)===l);p.applyCodecParameters({offerRtpParameters:n,answerMediaObject:S})}w={type:"answer",sdp:f.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),t.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w);for(const m of e){const{trackId:u}=m,n=i.get(u),l=this._pc.getTransceivers().find(S=>S.mid===n);if(!l)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,l),r.push({localId:n,track:l.receiver.track,rtpReceiver:l.receiver})}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){t.debug("stopReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(w.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("pauseReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("resumeReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m}=e,u={negotiated:!0,id:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m,protocol:i};t.debug("receiveDataChannel() [options:%o]",u);const n=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const S=await this._pc.createAnswer();if(!this._transportReady){const T=f.parse(S.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T})}t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setLocalDescription(S),this._hasDataChannelMediaSection=!0}return{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=f.parse(this._pc.localDescription.sdp));const i=p.extractDtlsParameters({sdpObject:r});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,w)=>{this.safeEmit("@connect",{dtlsParameters:i},c,w)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new x.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return _e.Safari12=y,_e}var ve={},qt;function Dr(){if(qt)return ve;qt=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.ReactNative106=void 0;const f=Q(),g=z(),v=$(),s=V(),x=U(),E=te(),_=Re(),p=Ee(),R=Te(),C=xe(),t=new v.Logger("ReactNative106"),a="ReactNative106",o={OS:1024,MIS:1024};let y=class je extends g.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:a,factory:e=>new je(e),getNativeRtpCapabilities:async()=>{t.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch{}e=void 0;const i=f.parse(r.sdp);return je.getLocalRtpCapabilities(i)}catch(r){try{e?.close()}catch{}throw e=void 0,r}},getNativeSctpCapabilities:async()=>(t.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e,r=[]){const i=p.extractRtpCapabilities({sdpObject:e});s.validateAndNormalizeRtpCapabilities(i),C.addNackSupportForOpus(i);for(const c of r)C.addHeaderExtensionSupport(i,c);return i}constructor({direction:e,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w,iceServers:h,iceTransportPolicy:m,additionalSettings:u,getSendExtendedRtpCapabilities:n}){super(),t.debug("constructor()"),this._direction=e,this._remoteSdp=new _.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:w}),this._getSendExtendedRtpCapabilities=n,c.role&&c.role!=="auto"&&(this._forcedLocalDtlsRole=c.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:m??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(t.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return a}close(){if(t.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),t.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=e,this._pc.setConfiguration(r)}async restartIce(e){if(this.assertNotClosed(),t.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});t.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,streamId:r,encodings:i,codecOptions:c,headerExtensionOptions:w,codec:h,onRtpSender:m}){this.assertNotClosed(),this.assertSendDirection(),t.debug("send() [kind:%s, track.id:%s, streamId:%s]",e.kind,e.id,r),i&&i.length>1&&i.forEach((A,Z)=>{A.rid=`r${Z}`});const u=this._remoteSdp.getNextMediaSectionIdx(),n=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i});m&&m(n.sender);let l=await this._pc.createOffer(),S=f.parse(l.sdp);S.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const T=[];T.push({uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",kind:e.kind,direction:"sendonly"});const I=je.getLocalRtpCapabilities(S,T),M=this._getSendExtendedRtpCapabilities(I),d=s.getSendingRtpParameters(e.kind,M);d.codecs=s.reduceCodecs(d.codecs,h);const D=s.getSendingRemoteRtpParameters(e.kind,M);D.codecs=s.reduceCodecs(D.codecs,h),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:S});let P=!1;const k=(0,E.parse)((i??[{}])[0].scalabilityMode);let L;i?.length===1&&k.spatialLayers>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(t.debug("send() | enabling legacy simulcast for VP9 SVC"),P=!0,S=f.parse(l.sdp),L=S.media[u.idx],R.addLegacySimulcast({offerMediaObject:L,numStreams:k.spatialLayers}),l={type:"offer",sdp:f.write(S)}),w?.absCaptureTime&&(L=S.media[u.idx],p.addHeaderExtension({offerMediaObject:L,headerExtensionUri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time",headerExtensionId:D.headerExtensions.find(A=>A.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time").id}),l={type:"offer",sdp:f.write(S)}),t.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);let F=n.mid??void 0;if(F||t.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),d.mid=F,S=f.parse(this._pc.localDescription.sdp),L=S.media[u.idx],d.rtcp.cname=p.getCname({offerMediaObject:L}),d.msid=`${r??this._sendStream.id} ${e.id}`,!i)d.encodings=R.getRtpEncodings({offerMediaObject:L});else if(i.length===1){let A=R.getRtpEncodings({offerMediaObject:L});Object.assign(A[0],i[0]),P&&(A=[A[0]]),d.encodings=A}else d.encodings=i;if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const A of d.encodings)A.scalabilityMode?A.scalabilityMode=`L1T${k.temporalLayers}`:A.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:L,reuseMid:u.reuseMid,offerRtpParameters:d,answerRtpParameters:D,codecOptions:c});const O={type:"answer",sdp:this._remoteSdp.getSdp()};return t.debug("send() | calling pc.setRemoteDescription() [answer:%o]",O),await this._pc.setRemoteDescription(O),F||(F=n.mid,d.mid=F),this._mapMidTransceiver.set(F,n),{localId:F,rtpParameters:d,rtpSender:n.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;t.debug("stopSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const c=await this._pc.createOffer();t.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const w={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("pauseSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(e);const i=await this._pc.createOffer();t.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),t.debug("resumeSending() [localId:%s]",e);const r=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const i=await this._pc.createOffer();t.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,r){this.assertNotClosed(),this.assertSendDirection(),r?t.debug("replaceTrack() [localId:%s, track.id:%s]",e,r.id):t.debug("replaceTrack() [localId:%s, no track]",e);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{u<=r?m.active=!0:m.active=!1}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(e,r){this.assertNotClosed(),this.assertSendDirection(),t.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((m,u)=>{c.encodings[u]={...m,...r}}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const w=await this._pc.createOffer();t.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const h={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:w}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:r,maxRetransmits:i,protocol:w};t.debug("sendDataChannel() [options:%o]",h);const m=this._pc.createDataChannel(c,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const n=await this._pc.createOffer(),l=f.parse(n.sdp),S=l.media.find(I=>I.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),t.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),this._remoteSdp.sendSctpAssociation({offerMediaObject:S});const T={type:"answer",sdp:this._remoteSdp.getSdp()};t.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._hasDataChannelMediaSection=!0}const u={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:m,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const m of e){const{trackId:u,kind:n,rtpParameters:l,streamId:S}=m;t.debug("receive() [trackId:%s, kind:%s]",u,n);const T=l.mid??String(this._mapMidTransceiver.size);i.set(u,T);const{msidStreamId:I}=C.getMsidStreamIdAndTrackId(l.msid);this._remoteSdp.receive({mid:T,kind:n,offerRtpParameters:l,streamId:S??I??l.rtcp?.cname??"-",trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const m of e){const{trackId:u,onRtpReceiver:n}=m;if(n){const l=i.get(u),S=this._pc.getTransceivers().find(T=>T.mid===l);if(!S)throw new Error("transceiver not found");n(S.receiver)}}let w=await this._pc.createAnswer();const h=f.parse(w.sdp);for(const m of e){const{trackId:u,rtpParameters:n}=m,l=i.get(u),S=h.media.find(T=>String(T.mid)===l);p.applyCodecParameters({offerRtpParameters:n,answerMediaObject:S})}w={type:"answer",sdp:f.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),t.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w);for(const m of e){const{trackId:u}=m,n=i.get(u),l=this._pc.getTransceivers().find(S=>S.mid===n);if(l)this._mapMidTransceiver.set(n,l),r.push({localId:n,track:l.receiver.track,rtpReceiver:l.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){t.debug("stopReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(w.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("pauseReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){t.debug("resumeReceiving() [localId:%s]",c);const w=this._mapMidTransceiver.get(c);if(!w)throw new Error("associated RTCRtpTransceiver not found");w.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();t.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m}=e,u={negotiated:!0,id:c,ordered:w,maxPacketLifeTime:h,maxRetransmits:m,protocol:i};t.debug("receiveDataChannel() [options:%o]",u);const n=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const l={type:"offer",sdp:this._remoteSdp.getSdp()};t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),await this._pc.setRemoteDescription(l);const S=await this._pc.createAnswer();if(!this._transportReady){const T=f.parse(S.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T})}t.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setLocalDescription(S),this._hasDataChannelMediaSection=!0}return{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:r}){r||(r=f.parse(this._pc.localDescription.sdp));const i=p.extractDtlsParameters({sdpObject:r});i.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,w)=>{this.safeEmit("@connect",{dtlsParameters:i},c,w)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new x.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ve.ReactNative106=y,ve}var Bt;function Pr(){if(Bt)return W;Bt=1,Object.defineProperty(W,"__esModule",{value:!0}),W.Device=void 0,W.detectDevice=o,W.detectDeviceAsync=y;const f=$(),g=z(),v=U(),s=ee(),x=V(),E=yr(),_=Er(),p=Tr(),R=xr(),C=kr(),t=Dr(),a=new f.Logger("Device");function o(u,n){return a.debug("detectDevice()"),!u&&typeof navigator=="object"&&(u=navigator.userAgent),!n&&typeof navigator=="object"&&(n=navigator.userAgentData),e(u,n)}async function y(u,n){return a.debug("detectDeviceAsync()"),!u&&typeof navigator=="object"&&(u=navigator.userAgent),!n&&typeof navigator=="object"&&(n=navigator.userAgentData),e(u,n)}let b=class er{_handlerFactory;_handlerName;_loaded=!1;_getSendExtendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind={audio:!1,video:!1};_sctpCapabilities;_observer=new g.EnhancedEventEmitter;static async factory({handlerName:n,handlerFactory:l}={}){if(a.debug("factory()"),n&&l)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!n&&!l&&(n=await y(),!n))throw new v.UnsupportedError("device not supported");return new er({handlerName:n,handlerFactory:l})}constructor({handlerName:n,handlerFactory:l}={}){if(a.debug("constructor()"),n&&l)throw new TypeError("just one of handlerName or handlerInterface can be given");if(l)this._handlerFactory=l;else{if(n)a.debug("constructor() | handler given: %s",n);else if(n=o(),n)a.debug("constructor() | detected handler: %s",n);else throw new v.UnsupportedError("device not supported");switch(n){case"Chrome111":{this._handlerFactory=_.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=p.Chrome74.createFactory();break}case"Firefox120":{this._handlerFactory=R.Firefox120.createFactory();break}case"Safari12":{this._handlerFactory=C.Safari12.createFactory();break}case"ReactNative106":{this._handlerFactory=t.ReactNative106.createFactory();break}default:throw new TypeError(`unknown handlerName "${n}"`)}}this._handlerName=this._handlerFactory.name}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new v.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new v.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:n,preferLocalCodecsOrder:l=!1}){if(a.debug("load() [routerRtpCapabilities:%o]",n),this._loaded)throw new v.InvalidStateError("already loaded");const S=s.clone(n);x.validateAndNormalizeRtpCapabilities(S);const{getNativeRtpCapabilities:T,getNativeSctpCapabilities:I}=this._handlerFactory,M=s.clone(await T());x.validateAndNormalizeRtpCapabilities(M),a.debug("load() | got native RTP capabilities:%o",M),this._getSendExtendedRtpCapabilities=D=>s.clone(x.getExtendedRtpCapabilities(D,S,l));const d=x.getExtendedRtpCapabilities(M,S,!1);this._recvRtpCapabilities=x.getRecvRtpCapabilities(d),x.validateAndNormalizeRtpCapabilities(this._recvRtpCapabilities),a.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=x.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=x.canSend("video",this._recvRtpCapabilities),this._sctpCapabilities=await I(),x.validateSctpCapabilities(this._sctpCapabilities),a.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),a.debug("load() succeeded"),this._loaded=!0}canProduce(n){if(this._loaded){if(n!=="audio"&&n!=="video")throw new TypeError(`invalid kind "${n}"`)}else throw new v.InvalidStateError("not loaded");return this._canProduceByKind[n]}createSendTransport({id:n,iceParameters:l,iceCandidates:S,dtlsParameters:T,sctpParameters:I,iceServers:M,iceTransportPolicy:d,additionalSettings:D,appData:P}){return a.debug("createSendTransport()"),this.createTransport({direction:"send",id:n,iceParameters:l,iceCandidates:S,dtlsParameters:T,sctpParameters:I,iceServers:M,iceTransportPolicy:d,additionalSettings:D,appData:P})}createRecvTransport({id:n,iceParameters:l,iceCandidates:S,dtlsParameters:T,sctpParameters:I,iceServers:M,iceTransportPolicy:d,additionalSettings:D,appData:P}){return a.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:n,iceParameters:l,iceCandidates:S,dtlsParameters:T,sctpParameters:I,iceServers:M,iceTransportPolicy:d,additionalSettings:D,appData:P})}createTransport({direction:n,id:l,iceParameters:S,iceCandidates:T,dtlsParameters:I,sctpParameters:M,iceServers:d,iceTransportPolicy:D,additionalSettings:P,appData:k}){if(this._loaded){if(typeof l!="string")throw new TypeError("missing id");if(typeof S!="object")throw new TypeError("missing iceParameters");if(Array.isArray(T)){if(typeof I!="object")throw new TypeError("missing dtlsParameters");if(M&&typeof M!="object")throw new TypeError("wrong sctpParameters");if(k&&typeof k!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new v.InvalidStateError("not loaded");const L=new E.Transport({direction:n,id:l,iceParameters:S,iceCandidates:T,dtlsParameters:I,sctpParameters:M,iceServers:d,iceTransportPolicy:D,additionalSettings:P,appData:k,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",L),L}};W.Device=b;function e(u,n){a.debug('detectDeviceImpl() [userAgent:"%s", userAgentData:%o]',u,n);const l=r(u,n);if(l){if(l>=111)return a.debug("detectDeviceImpl() | using Chrome111 handler"),"Chrome111";if(l>=74)return a.debug("detectDeviceImpl() | using Chrome74 handler"),"Chrome74";a.warn("detectDeviceImpl() | unsupported Chromium based browser/version");return}const S=i(u);if(S){if(S>=120)return a.debug("detectDeviceImpl() | using Firefox120 handler"),"Firefox120";a.warn("detectDeviceImpl() | unsupported Firefox browser/version");return}const T=c(u);if(T){if(T>=605)return a.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";a.warn("detectDeviceImpl() | unsupported desktop Safari browser/version");return}const I=w(u);if(I){if(I>=605)return a.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";a.warn("detectDeviceImpl() | unsupported iOS Safari based browser/version");return}if(m()){if(typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u")return a.debug("detectDeviceImpl() | using ReactNative106 handler"),"ReactNative106";a.warn("detectDeviceImpl() | unsupported react-native-webrtc version without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?");return}a.warn('detectDeviceImpl() | device not supported [userAgent:"%s", userAgentData:%o]',u,n)}function r(u,n){if(a.debug("getChromiumMajorVersion()"),h(u,n)){a.debug("getChromiumMajorVersion() | this is iOS => undefined");return}if(m()){a.debug("getChromiumMajorVersion() | this is React-Native => undefined");return}if(n){const S=(n.brands??[]).find(T=>T.brand==="Chromium");if(S){const T=Number(S.version);return a.debug(`getChromiumMajorVersion() | Chromium major version based on NavigatorUAData => ${T}`),T}}const l=u?.match(/\b(?:Chrome|Chromium)\/(\w+)/i);if(l?.[1]){const S=Number(l[1]);return a.debug(`getChromiumMajorVersion() | Chromium major version based on User-Agent => ${S}`),S}a.debug("getChromiumMajorVersion() | this is not Chromium => undefined")}function i(u){if(a.debug("getFirefoxMajorVersion()"),h(u)){a.debug("getFirefoxMajorVersion() | this is iOS => undefined");return}if(m()){a.debug("getFirefoxMajorVersion() | this is React-Native => undefined");return}const n=u?.match(/\bFirefox\/(\w+)/i);if(n?.[1]){const l=Number(n[1]);return a.debug(`getFirefoxMajorVersion() | Firefox major version based on User-Agent => ${l}`),l}a.debug("getFirefoxMajorVersion() | this is not Firefox => undefined")}function c(u){if(a.debug("getMacOSWebKitMajorVersion()"),h(u)){a.debug("getMacOSWebKitMajorVersion() | this is iOS => undefined");return}if(m()){a.debug("getMacOSWebKitMajorVersion() | this is React-Native => undefined");return}if(!(u&&/\bSafari\b/i.test(u)&&!/\bChrome\b/i.test(u)&&!/\bChromium\b/i.test(u)&&!/\bFirefox\b/i.test(u))){a.debug("getMacOSWebKitMajorVersion() | this is not Safari => undefined");return}const l=u.match(/AppleWebKit\/(\w+)/i);if(l?.[1]){const S=Number(l[1]);return a.debug(`getMacOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${S}`),S}a.debug("getMacOSWebKitMajorVersion() | this is not WebKit => undefined")}function w(u){if(a.debug("getIOSWebKitMajorVersion()"),!h(u)){a.debug("getIOSWebKitMajorVersion() | this is not iOS => undefined");return}if(m()){a.debug("getIOSWebKitMajorVersion() | this is React-Native => undefined");return}const n=u?.match(/AppleWebKit\/(\w+)/i);if(n?.[1]){const l=Number(n[1]);return a.debug(`getIOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${l}`),l}a.debug("getIOSWebKitMajorVersion() | this is not WebKit => undefined")}function h(u,n){return a.debug("isIOS()"),n?.platform==="iOS"?(a.debug("isIOS() | this is iOS based on NavigatorUAData.platform => true"),!0):n?.platform?(a.debug("isIOS() | this is not iOS based on NavigatorUAData.platform => false"),!1):u&&/iPad|iPhone|iPod/.test(u)?(a.debug("isIOS() | this is iOS based on User-Agent => true"),!0):typeof navigator=="object"&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?(a.debug("isIOS() | this is iPadOS 13+ based on User-Agent => true"),!0):(a.debug("isIOS() | this is not iOS => false"),!1)}function m(){return a.debug("isReactNative()"),typeof navigator=="object"&&navigator.product==="ReactNative"?(a.debug("isReactNative() | this is React-Native based on navigator.product"),!0):(a.debug("isReactNative() | this is not React-Native => false"),!1)}return W}var we={},be={},Ye={},Ut;function Lr(){if(Ut)return Ye;Ut=1;for(var f=256,g=[],v;f--;)g[f]=(f+256).toString(16).substring(1);function s(){var x=0,E,_="";if(!v||f+16>256){for(v=Array(x=256);x--;)v[x]=256*Math.random()|0;x=f=0}for(;x<16;x++)E=v[f+x],x==6?_+=g[E&15|64]:x==8?_+=g[E&63|128]:_+=g[E],x&1&&x>1&&x<11&&(_+="-");return f++,_}return Ye.v4=s,Ye}var ye={},Ht;function Ir(){if(Ht)return ye;Ht=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.FakeEventTarget=void 0;class f{listeners={};addEventListener(v,s,x){s&&(this.listeners[v]=this.listeners[v]??[],this.listeners[v].push({callback:typeof s=="function"?s:s.handleEvent,once:typeof x=="object"&&x.once===!0}))}removeEventListener(v,s,x){this.listeners[v]&&s&&(this.listeners[v]=this.listeners[v].filter(E=>E.callback!==(typeof s=="function"?s:s.handleEvent)))}dispatchEvent(v){if(!v||typeof v.type!="string")throw new Error("invalid event object");const s=this.listeners[v.type];if(!s)return!0;for(const x of[...s]){try{x.callback.call(this,v)}catch(E){setTimeout(()=>{throw E},0)}x.once&&this.removeEventListener(v.type,x.callback)}return!v.defaultPrevented}}return ye.FakeEventTarget=f,ye}var Ce={},Vt;function Mr(){if(Vt)return Ce;Vt=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.FakeEvent=void 0;let f=class{NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;type;bubbles;cancelable;defaultPrevented=!1;composed=!1;currentTarget=null;eventPhase=this.NONE;isTrusted=!0;target=null;timeStamp=0;cancelBubble=!1;returnValue=!0;srcElement=null;constructor(v,s={}){this.type=v,this.bubbles=s.bubbles??!1,this.cancelable=s.cancelable??!1}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopPropagation(){}stopImmediatePropagation(){}composedPath(){return[]}initEvent(v,s,x){}};return Ce.FakeEvent=f,Ce}var Me={},Gt;function Fr(){if(Gt)return Me;Gt=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.clone=f;function f(g){if(g!==void 0)return Number.isNaN(g)?NaN:typeof structuredClone=="function"?structuredClone(g):JSON.parse(JSON.stringify(g))}return Me}var Qt;function Or(){if(Qt)return be;Qt=1,Object.defineProperty(be,"__esModule",{value:!0}),be.FakeMediaStreamTrack=void 0;const f=Lr(),g=Ir(),v=Mr(),s=Fr();class x extends g.FakeEventTarget{#m;#l;#u;#e;#r;#t;#s;#h;#i;#f;#n;#a=null;#o=null;#c=null;#d=null;#p=null;constructor({kind:_,id:p,label:R,contentHint:C,enabled:t,muted:a,readyState:o,capabilities:y,constraints:b,settings:e,data:r}){super(),this.#m=p??(0,f.v4)(),this.#l=_,this.#u=R??"",this.#s=C??"",this.#r=t??!0,this.#t=a??!1,this.#e=o??"live",this.#h=y??{},this.#i=b??{},this.#f=e??{},this.#n=r??{}}get id(){return this.#m}get kind(){return this.#l}get label(){return this.#u}get contentHint(){return this.#s}set contentHint(_){this.#s=_}get enabled(){return this.#r}set enabled(_){const p=this.#r!==_;this.#r=_,p&&this.dispatchEvent(new v.FakeEvent("enabledchange"))}get muted(){return this.#t}get readyState(){return this.#e}get data(){return this.#n}set data(_){this.#n=_}get onmute(){return this.#a}set onmute(_){this.#a&&this.removeEventListener("mute",this.#a),this.#a=_,_&&this.addEventListener("mute",_)}get onunmute(){return this.#o}set onunmute(_){this.#o&&this.removeEventListener("unmute",this.#o),this.#o=_,_&&this.addEventListener("unmute",_)}get onended(){return this.#c}set onended(_){this.#c&&this.removeEventListener("ended",this.#c),this.#c=_,_&&this.addEventListener("ended",_)}get onenabledchange(){return this.#d}set onenabledchange(_){this.#d&&this.removeEventListener("enabledchange",this.#d),this.#d=_,_&&this.addEventListener("enabledchange",_)}get onstopped(){return this.#p}set onstopped(_){this.#p&&this.removeEventListener("stopped",this.#p),this.#p=_,_&&this.addEventListener("stopped",_)}addEventListener(_,p,R){super.addEventListener(_,p,R)}removeEventListener(_,p,R){super.removeEventListener(_,p,R)}stop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new v.FakeEvent("stopped")))}clone({id:_,data:p}={}){return new x({id:_??(0,f.v4)(),kind:this.#l,label:this.#u,contentHint:this.#s,enabled:this.#r,muted:this.#t,readyState:this.#e,capabilities:(0,s.clone)(this.#h),constraints:(0,s.clone)(this.#i),settings:(0,s.clone)(this.#f),data:p??(0,s.clone)(this.#n)})}getCapabilities(){return this.#h}getConstraints(){return this.#i}async applyConstraints(_={}){return this.#i=_,Promise.resolve()}getSettings(){return this.#f}remoteStop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new v.FakeEvent("stopped")),this.dispatchEvent(new v.FakeEvent("ended")))}remoteMute(){this.#t||(this.#t=!0,this.dispatchEvent(new v.FakeEvent("mute")))}remoteUnmute(){this.#t&&(this.#t=!1,this.dispatchEvent(new v.FakeEvent("unmute")))}}return be.FakeMediaStreamTrack=x,be}var Se={},Wt;function Ar(){if(Wt)return Se;Wt=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.FakeEventTarget=void 0;let f=class{listeners={};addEventListener(v,s,x){s&&(this.listeners[v]=this.listeners[v]??[],this.listeners[v].push({callback:typeof s=="function"?s:s.handleEvent,once:typeof x=="object"&&x.once===!0}))}removeEventListener(v,s,x){this.listeners[v]&&s&&(this.listeners[v]=this.listeners[v].filter(E=>E.callback!==(typeof s=="function"?s:s.handleEvent)))}dispatchEvent(v){if(!v||typeof v.type!="string")throw new Error("invalid event object");const s=this.listeners[v.type];if(!s)return!0;for(const x of[...s]){try{x.callback.call(this,v)}catch(E){setTimeout(()=>{throw E},0)}x.once&&this.removeEventListener(v.type,x.callback)}return!v.defaultPrevented}};return Se.FakeEventTarget=f,Se}var Kt;function Nr(){if(Kt)return we;Kt=1,Object.defineProperty(we,"__esModule",{value:!0}),we.FakeHandler=void 0;const f=Or(),g=z(),v=$(),s=ee(),x=V(),E=U(),_=Ar(),p=new v.Logger("FakeHandler"),R="FakeHandler";let C=class $e extends g.EnhancedEventEmitter{_closed=!1;_fakeParameters;_getSendExtendedRtpCapabilities;_cname=`CNAME-${s.generateRandomNumber()}`;_defaultSendStreamId=`${s.generateRandomNumber()}`;_transportReady=!1;_nextLocalId=1;_tracks=new Map;_nextSctpStreamId=0;static createFactory(o){return{name:R,factory:y=>new $e(y,o),getNativeRtpCapabilities:async()=>(p.debug("getNativeRtpCapabilities()"),$e.getLocalRtpCapabilities(o)),getNativeSctpCapabilities:async()=>(p.debug("getNativeSctpCapabilities()"),o.generateNativeSctpCapabilities())}}static getLocalRtpCapabilities(o){const y=o.generateNativeRtpCapabilities();return x.validateAndNormalizeRtpCapabilities(y),y}constructor({getSendExtendedRtpCapabilities:o},y){super(),p.debug("constructor()"),this._getSendExtendedRtpCapabilities=o,this._fakeParameters=y}get name(){return R}close(){p.debug("close()"),!this._closed&&(this._closed=!0,super.close())}setIceGatheringState(o){this.emit("@icegatheringstatechange",o)}setConnectionState(o){this.emit("@connectionstatechange",o)}async updateIceServers(o){this.assertNotClosed(),p.debug("updateIceServers()")}async restartIce(o){this.assertNotClosed(),p.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:o,streamId:y,encodings:b,codecOptions:e,codec:r}){this.assertNotClosed(),p.debug("send() [kind:%s, track.id:%s]",o.kind,o.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const i=$e.getLocalRtpCapabilities(this._fakeParameters),c=this._getSendExtendedRtpCapabilities(i),w=x.getSendingRtpParameters(o.kind,c);w.codecs=x.reduceCodecs(w.codecs,r);const h=w.codecs.some(u=>/.+\/rtx$/i.test(u.mimeType));w.mid=`mid-${s.generateRandomNumber()}`,w.msid=`${y??"-"} ${o.id}`,b||(b=[{}]);for(const u of b)u.ssrc=s.generateRandomNumber(),h&&(u.rtx={ssrc:s.generateRandomNumber()});w.encodings=b,w.rtcp={cname:this._cname,reducedSize:!0,mux:!0},w.msid=`${y??this._defaultSendStreamId} ${o.id}`;const m=this._nextLocalId++;return this._tracks.set(m,o),{localId:String(m),rtpParameters:w}}async stopSending(o){if(p.debug("stopSending() [localId:%s]",o),!this._closed){if(!this._tracks.has(Number(o)))throw new Error("local track not found");this._tracks.delete(Number(o))}}async pauseSending(o){this.assertNotClosed()}async resumeSending(o){this.assertNotClosed()}async replaceTrack(o,y){this.assertNotClosed(),y?p.debug("replaceTrack() [localId:%s, track.id:%s]",o,y.id):p.debug("replaceTrack() [localId:%s, no track]",o),this._tracks.delete(Number(o)),this._tracks.set(Number(o),y)}async setMaxSpatialLayer(o,y){this.assertNotClosed(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",o,y)}async setRtpEncodingParameters(o,y){this.assertNotClosed(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",o,y)}async getSenderStats(o){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:o,maxPacketLifeTime:y,maxRetransmits:b,label:e,protocol:r}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),p.debug("sendDataChannel()");const i=new t({id:this._nextSctpStreamId++,ordered:o,maxPacketLifeTime:y,maxRetransmits:b,label:e,protocol:r}),c={streamId:this._nextSctpStreamId,ordered:o,maxPacketLifeTime:y,maxRetransmits:b};return{dataChannel:i,sctpStreamParameters:c}}async receive(o){this.assertNotClosed();const y=[];for(const b of o){const{trackId:e,kind:r}=b;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),p.debug("receive() [trackId:%s, kind:%s]",e,r);const i=this._nextLocalId++,c=new f.FakeMediaStreamTrack({kind:r});this._tracks.set(i,c),y.push({localId:String(i),track:c})}return y}async stopReceiving(o){if(!this._closed)for(const y of o)p.debug("stopReceiving() [localId:%s]",y),this._tracks.delete(Number(y))}async pauseReceiving(o){this.assertNotClosed()}async resumeReceiving(o){this.assertNotClosed()}async getReceiverStats(o){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:o,label:y,protocol:b}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),p.debug("receiveDataChannel()"),{dataChannel:new t({id:o.streamId,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits,label:y,protocol:b})}}async setupTransport({localDtlsRole:o,localSdpObject:y}){const b=s.clone(this._fakeParameters.generateLocalDtlsParameters());o&&(b.role=o),this.emit("@connectionstatechange","connecting"),await new Promise((e,r)=>this.emit("@connect",{dtlsParameters:b},e,r)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new E.InvalidStateError("method called in a closed handler")}};we.FakeHandler=C;class t extends _.FakeEventTarget{_id;_negotiated=!0;_ordered;_maxPacketLifeTime;_maxRetransmits;_label;_protocol;_readyState="connecting";_bufferedAmount=0;_bufferedAmountLowThreshold=0;_binaryType="arraybuffer";_onopen=null;_onclosing=null;_onclose=null;_onmessage=null;_onbufferedamountlow=null;_onerror=null;constructor({id:o,ordered:y=!0,maxPacketLifeTime:b=null,maxRetransmits:e=null,label:r="",protocol:i=""}){super(),p.debug(`constructor() [id:${o}, ordered:${y}, maxPacketLifeTime:${b}, maxRetransmits:${e}, label:${r}, protocol:${i}`),this._id=o,this._ordered=y,this._maxPacketLifeTime=b,this._maxRetransmits=e,this._label=r,this._protocol=i}get id(){return this._id}get negotiated(){return this._negotiated}get ordered(){return this._ordered}get maxPacketLifeTime(){return this._maxPacketLifeTime}get maxRetransmits(){return this._maxRetransmits}get label(){return this._label}get protocol(){return this._protocol}get readyState(){return this._readyState}get bufferedAmount(){return this._bufferedAmount}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(o){this._bufferedAmountLowThreshold=o}get binaryType(){return this._binaryType}set binaryType(o){this._binaryType=o}get onopen(){return this._onopen}set onopen(o){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=o,o&&this.addEventListener("open",o)}get onclosing(){return this._onclosing}set onclosing(o){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=o,o&&this.addEventListener("closing",o)}get onclose(){return this._onclose}set onclose(o){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=o,o&&this.addEventListener("close",o)}get onmessage(){return this._onmessage}set onmessage(o){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=o,o&&this.addEventListener("message",o)}get onbufferedamountlow(){return this._onbufferedamountlow}set onbufferedamountlow(o){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=o,o&&this.addEventListener("bufferedamountlow",o)}get onerror(){return this._onerror}set onerror(o){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=o,o&&this.addEventListener("error",o)}addEventListener(o,y,b){super.addEventListener(o,y,b)}removeEventListener(o,y,b){super.removeEventListener(o,y,b)}close(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}send(o){if(this._readyState!=="open")throw new E.InvalidStateError("not open")}}return we}var q={},Jt;function jr(){if(Jt)return q;Jt=1,Object.defineProperty(q,"__esModule",{value:!0}),q.generateRouterRtpCapabilities=v,q.generateNativeRtpCapabilities=s,q.generateNativeSctpCapabilities=x,q.generateLocalDtlsParameters=E,q.generateTransportRemoteParameters=_,q.generateProducerRemoteParameters=p,q.generateConsumerRemoteParameters=R,q.generateDataProducerRemoteParameters=C,q.generateDataConsumerRemoteParameters=t;const f=ee();function g(){return String(f.generateRandomNumber())}function v(){return f.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function s(){return{codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]}}function x(){return f.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function E(){return f.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function _(){return{id:g(),iceParameters:f.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:f.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:f.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:f.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function p(){return f.deepFreeze({id:g()})}function R({id:a,codecMimeType:o}={}){switch(o){case"audio/opus":return{id:a??g(),producerId:g(),kind:"audio",rtpParameters:f.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:a??g(),producerId:g(),kind:"audio",rtpParameters:f.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:a??g(),producerId:g(),kind:"video",rtpParameters:f.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:a??g(),producerId:g(),kind:"video",rtpParameters:f.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${o}'`)}}function C(){return f.deepFreeze({id:g()})}function t({id:a}={}){return{id:a??g(),dataProducerId:g(),sctpStreamParameters:f.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}return q}var Zt;function $r(){return Zt||(Zt=1,(function(f){Object.defineProperty(f,"__esModule",{value:!0}),f.debug=f.testFakeParameters=f.FakeHandler=f.enhancedEvents=f.ortc=f.parseScalabilityMode=f.detectDeviceAsync=f.detectDevice=f.Device=f.version=f.types=void 0;const g=Yt();f.debug=g.default,f.types=ir(),f.version="3.18.1";var v=Pr();Object.defineProperty(f,"Device",{enumerable:!0,get:function(){return v.Device}}),Object.defineProperty(f,"detectDevice",{enumerable:!0,get:function(){return v.detectDevice}}),Object.defineProperty(f,"detectDeviceAsync",{enumerable:!0,get:function(){return v.detectDeviceAsync}});var s=te();Object.defineProperty(f,"parseScalabilityMode",{enumerable:!0,get:function(){return s.parse}}),f.ortc=V(),f.enhancedEvents=z();var x=Nr();Object.defineProperty(f,"FakeHandler",{enumerable:!0,get:function(){return x.FakeHandler}}),f.testFakeParameters=jr()})(ze)),ze}var zr=$r();const Xr=tr({__proto__:null},[zr]);export{Xr as i};
