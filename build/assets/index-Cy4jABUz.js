function tr(v,w){for(var b=0;b<w.length;b++){const s=w[b];if(typeof s!="string"&&!Array.isArray(s)){for(const k in s)if(k!=="default"&&!(k in v)){const R=Object.getOwnPropertyDescriptor(s,k);R&&Object.defineProperty(v,k,R.get?R:{enumerable:!0,get:()=>s[k]})}}}return Object.freeze(Object.defineProperty(v,Symbol.toStringTag,{value:"Module"}))}var ze={},Te={exports:{}},qe,et;function rr(){if(et)return qe;et=1;var v=1e3,w=v*60,b=w*60,s=b*24,k=s*7,R=s*365.25;qe=function(r,n){n=n||{};var o=typeof r;if(o==="string"&&r.length>0)return _(r);if(o==="number"&&isFinite(r))return n.long?T(r):d(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function _(r){if(r=String(r),!(r.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(n){var o=parseFloat(n[1]),S=(n[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return o*R;case"weeks":case"week":case"w":return o*k;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*b;case"minutes":case"minute":case"mins":case"min":case"m":return o*w;case"seconds":case"second":case"secs":case"sec":case"s":return o*v;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}function d(r){var n=Math.abs(r);return n>=s?Math.round(r/s)+"d":n>=b?Math.round(r/b)+"h":n>=w?Math.round(r/w)+"m":n>=v?Math.round(r/v)+"s":r+"ms"}function T(r){var n=Math.abs(r);return n>=s?m(r,n,s,"day"):n>=b?m(r,n,b,"hour"):n>=w?m(r,n,w,"minute"):n>=v?m(r,n,v,"second"):r+" ms"}function m(r,n,o,S){var p=n>=o*1.5;return Math.round(r/o)+" "+S+(p?"s":"")}return qe}var Be,tt;function sr(){if(tt)return Be;tt=1;function v(w){s.debug=s,s.default=s,s.coerce=m,s.disable=d,s.enable=R,s.enabled=T,s.humanize=rr(),s.destroy=r,Object.keys(w).forEach(n=>{s[n]=w[n]}),s.names=[],s.skips=[],s.formatters={};function b(n){let o=0;for(let S=0;S<n.length;S++)o=(o<<5)-o+n.charCodeAt(S),o|=0;return s.colors[Math.abs(o)%s.colors.length]}s.selectColor=b;function s(n){let o,S=null,p,e;function t(...a){if(!t.enabled)return;const c=t,y=Number(new Date),g=y-(o||y);c.diff=g,c.prev=o,c.curr=y,o=y,a[0]=s.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");let l=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(i,f)=>{if(i==="%%")return"%";l++;const C=s.formatters[f];if(typeof C=="function"){const E=a[l];i=C.call(c,E),a.splice(l,1),l--}return i}),s.formatArgs.call(c,a),(c.log||s.log).apply(c,a)}return t.namespace=n,t.useColors=s.useColors(),t.color=s.selectColor(n),t.extend=k,t.destroy=s.destroy,Object.defineProperty(t,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(p!==s.namespaces&&(p=s.namespaces,e=s.enabled(n)),e),set:a=>{S=a}}),typeof s.init=="function"&&s.init(t),t}function k(n,o){const S=s(this.namespace+(typeof o>"u"?":":o)+n);return S.log=this.log,S}function R(n){s.save(n),s.namespaces=n,s.names=[],s.skips=[];const o=(typeof n=="string"?n:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const S of o)S[0]==="-"?s.skips.push(S.slice(1)):s.names.push(S)}function _(n,o){let S=0,p=0,e=-1,t=0;for(;S<n.length;)if(p<o.length&&(o[p]===n[S]||o[p]==="*"))o[p]==="*"?(e=p,t=S,p++):(S++,p++);else if(e!==-1)p=e+1,t++,S=t;else return!1;for(;p<o.length&&o[p]==="*";)p++;return p===o.length}function d(){const n=[...s.names,...s.skips.map(o=>"-"+o)].join(",");return s.enable(""),n}function T(n){for(const o of s.skips)if(_(n,o))return!1;for(const o of s.names)if(_(n,o))return!0;return!1}function m(n){return n instanceof Error?n.stack||n.message:n}function r(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return Be=v,Be}var rt;function Yt(){return rt||(rt=1,(function(v,w){var b={};w.formatArgs=k,w.save=R,w.load=_,w.useColors=s,w.storage=d(),w.destroy=(()=>{let m=!1;return()=>{m||(m=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),w.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let m;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(m=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(m[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function k(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+v.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;m.splice(1,0,r,"color: inherit");let n=0,o=0;m[0].replace(/%[a-zA-Z%]/g,S=>{S!=="%%"&&(n++,S==="%c"&&(o=n))}),m.splice(o,0,r)}w.log=console.debug||console.log||(()=>{});function R(m){try{m?w.storage.setItem("debug",m):w.storage.removeItem("debug")}catch{}}function _(){let m;try{m=w.storage.getItem("debug")||w.storage.getItem("DEBUG")}catch{}return!m&&typeof process<"u"&&"env"in process&&(m=b.DEBUG),m}function d(){try{return localStorage}catch{}}v.exports=sr()(w);const{formatters:T}=v.exports;T.j=function(m){try{return JSON.stringify(m)}catch(r){return"[UnexpectedJSONParseError]: "+r.message}}})(Te,Te.exports)),Te.exports}var Ue={},st;function ir(){return st||(st=1,Object.defineProperty(Ue,"__esModule",{value:!0})),Ue}var Q={},te={},it;function $(){if(it)return te;it=1,Object.defineProperty(te,"__esModule",{value:!0}),te.Logger=void 0;const v=Yt(),w="mediasoup-client";class b{_debug;_warn;_error;constructor(k){k?(this._debug=(0,v.default)(`${w}:${k}`),this._warn=(0,v.default)(`${w}:WARN:${k}`),this._error=(0,v.default)(`${w}:ERROR:${k}`)):(this._debug=(0,v.default)(w),this._warn=(0,v.default)(`${w}:WARN`),this._error=(0,v.default)(`${w}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return te.Logger=b,te}var re={},ke={exports:{}},nt;function nr(){if(nt)return ke.exports;nt=1;var v=typeof Reflect=="object"?Reflect:null,w=v&&typeof v.apply=="function"?v.apply:function(l,u,i){return Function.prototype.apply.call(l,u,i)},b;v&&typeof v.ownKeys=="function"?b=v.ownKeys:Object.getOwnPropertySymbols?b=function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:b=function(l){return Object.getOwnPropertyNames(l)};function s(g){console&&console.warn&&console.warn(g)}var k=Number.isNaN||function(l){return l!==l};function R(){R.init.call(this)}ke.exports=R,ke.exports.once=a,R.EventEmitter=R,R.prototype._events=void 0,R.prototype._eventsCount=0,R.prototype._maxListeners=void 0;var _=10;function d(g){if(typeof g!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}Object.defineProperty(R,"defaultMaxListeners",{enumerable:!0,get:function(){return _},set:function(g){if(typeof g!="number"||g<0||k(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");_=g}}),R.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},R.prototype.setMaxListeners=function(l){if(typeof l!="number"||l<0||k(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this};function T(g){return g._maxListeners===void 0?R.defaultMaxListeners:g._maxListeners}R.prototype.getMaxListeners=function(){return T(this)},R.prototype.emit=function(l){for(var u=[],i=1;i<arguments.length;i++)u.push(arguments[i]);var f=l==="error",C=this._events;if(C!==void 0)f=f&&C.error===void 0;else if(!f)return!1;if(f){var E;if(u.length>0&&(E=u[0]),E instanceof Error)throw E;var L=new Error("Unhandled error."+(E?" ("+E.message+")":""));throw L.context=E,L}var I=C[l];if(I===void 0)return!1;if(typeof I=="function")w(I,this,u);else for(var h=I.length,x=p(I,h),i=0;i<h;++i)w(x[i],this,u);return!0};function m(g,l,u,i){var f,C,E;if(d(u),C=g._events,C===void 0?(C=g._events=Object.create(null),g._eventsCount=0):(C.newListener!==void 0&&(g.emit("newListener",l,u.listener?u.listener:u),C=g._events),E=C[l]),E===void 0)E=C[l]=u,++g._eventsCount;else if(typeof E=="function"?E=C[l]=i?[u,E]:[E,u]:i?E.unshift(u):E.push(u),f=T(g),f>0&&E.length>f&&!E.warned){E.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(l)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=g,L.type=l,L.count=E.length,s(L)}return g}R.prototype.addListener=function(l,u){return m(this,l,u,!1)},R.prototype.on=R.prototype.addListener,R.prototype.prependListener=function(l,u){return m(this,l,u,!0)};function r(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function n(g,l,u){var i={fired:!1,wrapFn:void 0,target:g,type:l,listener:u},f=r.bind(i);return f.listener=u,i.wrapFn=f,f}R.prototype.once=function(l,u){return d(u),this.on(l,n(this,l,u)),this},R.prototype.prependOnceListener=function(l,u){return d(u),this.prependListener(l,n(this,l,u)),this},R.prototype.removeListener=function(l,u){var i,f,C,E,L;if(d(u),f=this._events,f===void 0)return this;if(i=f[l],i===void 0)return this;if(i===u||i.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete f[l],f.removeListener&&this.emit("removeListener",l,i.listener||u));else if(typeof i!="function"){for(C=-1,E=i.length-1;E>=0;E--)if(i[E]===u||i[E].listener===u){L=i[E].listener,C=E;break}if(C<0)return this;C===0?i.shift():e(i,C),i.length===1&&(f[l]=i[0]),f.removeListener!==void 0&&this.emit("removeListener",l,L||u)}return this},R.prototype.off=R.prototype.removeListener,R.prototype.removeAllListeners=function(l){var u,i,f;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[l]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[l]),this;if(arguments.length===0){var C=Object.keys(i),E;for(f=0;f<C.length;++f)E=C[f],E!=="removeListener"&&this.removeAllListeners(E);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=i[l],typeof u=="function")this.removeListener(l,u);else if(u!==void 0)for(f=u.length-1;f>=0;f--)this.removeListener(l,u[f]);return this};function o(g,l,u){var i=g._events;if(i===void 0)return[];var f=i[l];return f===void 0?[]:typeof f=="function"?u?[f.listener||f]:[f]:u?t(f):p(f,f.length)}R.prototype.listeners=function(l){return o(this,l,!0)},R.prototype.rawListeners=function(l){return o(this,l,!1)},R.listenerCount=function(g,l){return typeof g.listenerCount=="function"?g.listenerCount(l):S.call(g,l)},R.prototype.listenerCount=S;function S(g){var l=this._events;if(l!==void 0){var u=l[g];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}R.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]};function p(g,l){for(var u=new Array(l),i=0;i<l;++i)u[i]=g[i];return u}function e(g,l){for(;l+1<g.length;l++)g[l]=g[l+1];g.pop()}function t(g){for(var l=new Array(g.length),u=0;u<l.length;++u)l[u]=g[u].listener||g[u];return l}function a(g,l){return new Promise(function(u,i){function f(E){g.removeListener(l,C),i(E)}function C(){typeof g.removeListener=="function"&&g.removeListener("error",f),u([].slice.call(arguments))}y(g,l,C,{once:!0}),l!=="error"&&c(g,f,{once:!0})})}function c(g,l,u){typeof g.on=="function"&&y(g,"error",l,u)}function y(g,l,u,i){if(typeof g.on=="function")i.once?g.once(l,u):g.on(l,u);else if(typeof g.addEventListener=="function")g.addEventListener(l,function f(C){i.once&&g.removeEventListener(l,f),u(C)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g)}return ke.exports}var at;function z(){if(at)return re;at=1,Object.defineProperty(re,"__esModule",{value:!0}),re.EnhancedEventEmitter=void 0;const v=nr(),w=$(),b=new w.Logger("EnhancedEventEmitter");class s extends v.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}close(){super.removeAllListeners()}emit(R,..._){return super.emit(R,..._)}safeEmit(R,..._){try{return super.emit(R,..._)}catch(d){b.error("safeEmit() | event listener threw an error [eventName:%s]:%o",R,d);try{super.emit("listenererror",R,d)}catch{}return!!super.listenerCount(R)}}on(R,_){return super.on(R,_),this}off(R,_){return super.off(R,_),this}addListener(R,_){return super.on(R,_),this}prependListener(R,_){return super.prependListener(R,_),this}once(R,_){return super.once(R,_),this}prependOnceListener(R,_){return super.prependOnceListener(R,_),this}removeListener(R,_){return super.off(R,_),this}removeAllListeners(R){return super.removeAllListeners(R),this}listenerCount(R){return super.listenerCount(R)}listeners(R){return super.listeners(R)}rawListeners(R){return super.rawListeners(R)}}return re.EnhancedEventEmitter=s,re}var W={},ot;function U(){if(ot)return W;ot=1,Object.defineProperty(W,"__esModule",{value:!0}),W.InvalidStateError=W.UnsupportedError=void 0;class v extends Error{constructor(s){super(s),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,v):this.stack=new Error(s).stack}}W.UnsupportedError=v;class w extends Error{constructor(s){super(s),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,w):this.stack=new Error(s).stack}}return W.InvalidStateError=w,W}var Y={},ct;function X(){if(ct)return Y;ct=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.clone=v,Y.generateRandomNumber=w,Y.deepFreeze=b;function v(s){if(s!==void 0)return Number.isNaN(s)?NaN:typeof structuredClone=="function"?structuredClone(s):JSON.parse(JSON.stringify(s))}function w(){return Math.round(Math.random()*1e7)}function b(s){const k=Reflect.ownKeys(s);for(const R of k){const _=s[R];(_&&typeof _=="object"||typeof _=="function")&&b(_)}return Object.freeze(s)}return Y}var j={},O={},K={},De={exports:{}},Ve,dt;function ar(){if(dt)return Ve;dt=1;var v=1e3,w=v*60,b=w*60,s=b*24,k=s*7,R=s*365.25;Ve=function(r,n){n=n||{};var o=typeof r;if(o==="string"&&r.length>0)return _(r);if(o==="number"&&isFinite(r))return n.long?T(r):d(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function _(r){if(r=String(r),!(r.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(n){var o=parseFloat(n[1]),S=(n[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return o*R;case"weeks":case"week":case"w":return o*k;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*b;case"minutes":case"minute":case"mins":case"min":case"m":return o*w;case"seconds":case"second":case"secs":case"sec":case"s":return o*v;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}function d(r){var n=Math.abs(r);return n>=s?Math.round(r/s)+"d":n>=b?Math.round(r/b)+"h":n>=w?Math.round(r/w)+"m":n>=v?Math.round(r/v)+"s":r+"ms"}function T(r){var n=Math.abs(r);return n>=s?m(r,n,s,"day"):n>=b?m(r,n,b,"hour"):n>=w?m(r,n,w,"minute"):n>=v?m(r,n,v,"second"):r+" ms"}function m(r,n,o,S){var p=n>=o*1.5;return Math.round(r/o)+" "+S+(p?"s":"")}return Ve}var Ge,pt;function or(){if(pt)return Ge;pt=1;function v(w){s.debug=s,s.default=s,s.coerce=m,s.disable=d,s.enable=R,s.enabled=T,s.humanize=ar(),s.destroy=r,Object.keys(w).forEach(n=>{s[n]=w[n]}),s.names=[],s.skips=[],s.formatters={};function b(n){let o=0;for(let S=0;S<n.length;S++)o=(o<<5)-o+n.charCodeAt(S),o|=0;return s.colors[Math.abs(o)%s.colors.length]}s.selectColor=b;function s(n){let o,S=null,p,e;function t(...a){if(!t.enabled)return;const c=t,y=Number(new Date),g=y-(o||y);c.diff=g,c.prev=o,c.curr=y,o=y,a[0]=s.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");let l=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(i,f)=>{if(i==="%%")return"%";l++;const C=s.formatters[f];if(typeof C=="function"){const E=a[l];i=C.call(c,E),a.splice(l,1),l--}return i}),s.formatArgs.call(c,a),(c.log||s.log).apply(c,a)}return t.namespace=n,t.useColors=s.useColors(),t.color=s.selectColor(n),t.extend=k,t.destroy=s.destroy,Object.defineProperty(t,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(p!==s.namespaces&&(p=s.namespaces,e=s.enabled(n)),e),set:a=>{S=a}}),typeof s.init=="function"&&s.init(t),t}function k(n,o){const S=s(this.namespace+(typeof o>"u"?":":o)+n);return S.log=this.log,S}function R(n){s.save(n),s.namespaces=n,s.names=[],s.skips=[];const o=(typeof n=="string"?n:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const S of o)S[0]==="-"?s.skips.push(S.slice(1)):s.names.push(S)}function _(n,o){let S=0,p=0,e=-1,t=0;for(;S<n.length;)if(p<o.length&&(o[p]===n[S]||o[p]==="*"))o[p]==="*"?(e=p,t=S,p++):(S++,p++);else if(e!==-1)p=e+1,t++,S=t;else return!1;for(;p<o.length&&o[p]==="*";)p++;return p===o.length}function d(){const n=[...s.names,...s.skips.map(o=>"-"+o)].join(",");return s.enable(""),n}function T(n){for(const o of s.skips)if(_(n,o))return!1;for(const o of s.names)if(_(n,o))return!0;return!1}function m(n){return n instanceof Error?n.stack||n.message:n}function r(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return Ge=v,Ge}var lt;function cr(){return lt||(lt=1,(function(v,w){var b={};w.formatArgs=k,w.save=R,w.load=_,w.useColors=s,w.storage=d(),w.destroy=(()=>{let m=!1;return()=>{m||(m=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),w.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let m;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(m=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(m[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function k(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+v.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;m.splice(1,0,r,"color: inherit");let n=0,o=0;m[0].replace(/%[a-zA-Z%]/g,S=>{S!=="%%"&&(n++,S==="%c"&&(o=n))}),m.splice(o,0,r)}w.log=console.debug||console.log||(()=>{});function R(m){try{m?w.storage.setItem("debug",m):w.storage.removeItem("debug")}catch{}}function _(){let m;try{m=w.storage.getItem("debug")||w.storage.getItem("DEBUG")}catch{}return!m&&typeof process<"u"&&"env"in process&&(m=b.DEBUG),m}function d(){try{return localStorage}catch{}}v.exports=or()(w);const{formatters:T}=v.exports;T.j=function(m){try{return JSON.stringify(m)}catch(r){return"[UnexpectedJSONParseError]: "+r.message}}})(De,De.exports)),De.exports}var ut;function dr(){if(ut)return K;ut=1;var v=K&&K.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(K,"__esModule",{value:!0}),K.Logger=void 0;const w=v(cr()),b="h264-profile-level-id";class s{constructor(R){R?(this._debug=(0,w.default)(`${b}:${R}`),this._warn=(0,w.default)(`${b}:WARN:${R}`),this._error=(0,w.default)(`${b}:ERROR:${R}`)):(this._debug=(0,w.default)(b),this._warn=(0,w.default)(`${b}:WARN`),this._error=(0,w.default)(`${b}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return K.Logger=s,K}var ht;function pr(){if(ht)return O;ht=1,Object.defineProperty(O,"__esModule",{value:!0}),O.ProfileLevelId=O.Level=O.Profile=void 0,O.parseProfileLevelId=r,O.profileLevelIdToString=n,O.profileToString=o,O.levelToString=S,O.parseSdpProfileLevelId=p,O.isSameProfile=e,O.isSameProfileAndLevel=t,O.generateProfileLevelIdStringForAnswer=a,O.supportedLevel=c;const v=dr(),w=new v.Logger;var b;(function(i){i[i.ConstrainedBaseline=1]="ConstrainedBaseline",i[i.Baseline=2]="Baseline",i[i.Main=3]="Main",i[i.ConstrainedHigh=4]="ConstrainedHigh",i[i.High=5]="High",i[i.PredictiveHigh444=6]="PredictiveHigh444"})(b||(O.Profile=b={}));var s;(function(i){i[i.L1_b=0]="L1_b",i[i.L1=10]="L1",i[i.L1_1=11]="L1_1",i[i.L1_2=12]="L1_2",i[i.L1_3=13]="L1_3",i[i.L2=20]="L2",i[i.L2_1=21]="L2_1",i[i.L2_2=22]="L2_2",i[i.L3=30]="L3",i[i.L3_1=31]="L3_1",i[i.L3_2=32]="L3_2",i[i.L4=40]="L4",i[i.L4_1=41]="L4_1",i[i.L4_2=42]="L4_2",i[i.L5=50]="L5",i[i.L5_1=51]="L5_1",i[i.L5_2=52]="L5_2"})(s||(O.Level=s={}));class k{constructor(f,C){this.profile=f,this.level=C}}O.ProfileLevelId=k;const R=new k(b.ConstrainedBaseline,s.L3_1);class _{constructor(f){this.mask=~y("x",f),this.masked_value=y("1",f)}isMatch(f){return this.masked_value===(f&this.mask)}}class d{constructor(f,C,E){this.profile_idc=f,this.profile_iop=C,this.profile=E}}const T=[new d(66,new _("x1xx0000"),b.ConstrainedBaseline),new d(77,new _("1xxx0000"),b.ConstrainedBaseline),new d(88,new _("11xx0000"),b.ConstrainedBaseline),new d(66,new _("x0xx0000"),b.Baseline),new d(88,new _("10xx0000"),b.Baseline),new d(77,new _("0x0x0000"),b.Main),new d(100,new _("00000000"),b.High),new d(100,new _("00001100"),b.ConstrainedHigh),new d(244,new _("00000000"),b.PredictiveHigh444)],m=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:s.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:s.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:s.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:s.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:s.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:s.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:s.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:s.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:s.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:s.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:s.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:s.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:s.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:s.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:s.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:s.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:s.L5_2}];function r(i){if(typeof i!="string"||i.length!==6)return;const C=parseInt(i,16);if(C===0)return;const E=C&255,L=C>>8&255,I=C>>16&255;let h;switch(E){case s.L1_1:{h=(L&16)!==0?s.L1_b:s.L1_1;break}case s.L1:case s.L1_2:case s.L1_3:case s.L2:case s.L2_1:case s.L2_2:case s.L3:case s.L3_1:case s.L3_2:case s.L4:case s.L4_1:case s.L4_2:case s.L5:case s.L5_1:case s.L5_2:{h=E;break}default:{w.warn(`parseProfileLevelId() | unrecognized level_idc [str:${i}, level_idc:${E}]`);return}}for(const x of T)if(I===x.profile_idc&&x.profile_iop.isMatch(L))return w.debug(`parseProfileLevelId() | result [str:${i}, profile:${x.profile}, level:${h}]`),new k(x.profile,h);w.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${i}, profile_idc:${I}, profile_iop:${L}]`)}function n(i){if(i.level==s.L1_b)switch(i.profile){case b.ConstrainedBaseline:return"42f00b";case b.Baseline:return"42100b";case b.Main:return"4d100b";default:{w.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${i.profile}`);return}}let f;switch(i.profile){case b.ConstrainedBaseline:{f="42e0";break}case b.Baseline:{f="4200";break}case b.Main:{f="4d00";break}case b.ConstrainedHigh:{f="640c";break}case b.High:{f="6400";break}case b.PredictiveHigh444:{f="f400";break}default:{w.warn(`profileLevelIdToString() | unrecognized profile ${i.profile}`);return}}let C=i.level.toString(16);return C.length===1&&(C=`0${C}`),`${f}${C}`}function o(i){switch(i){case b.ConstrainedBaseline:return"ConstrainedBaseline";case b.Baseline:return"Baseline";case b.Main:return"Main";case b.ConstrainedHigh:return"ConstrainedHigh";case b.High:return"High";case b.PredictiveHigh444:return"PredictiveHigh444";default:{w.warn(`profileToString() | unrecognized profile ${i}`);return}}}function S(i){switch(i){case s.L1_b:return"1b";case s.L1:return"1";case s.L1_1:return"1.1";case s.L1_2:return"1.2";case s.L1_3:return"1.3";case s.L2:return"2";case s.L2_1:return"2.1";case s.L2_2:return"2.2";case s.L3:return"3";case s.L3_1:return"3.1";case s.L3_2:return"3.2";case s.L4:return"4";case s.L4_1:return"4.1";case s.L4_2:return"4.2";case s.L5:return"5";case s.L5_1:return"5.1";case s.L5_2:return"5.2";default:{w.warn(`levelToString() | unrecognized level ${i}`);return}}}function p(i={}){const f=i["profile-level-id"];return f?r(f):R}function e(i={},f={}){const C=p(i),E=p(f);return!!(C&&E&&C.profile===E.profile)}function t(i={},f={}){const C=p(i),E=p(f);return!!(C&&E&&C.profile===E.profile&&C.level==E.level)}function a(i={},f={}){if(!i["profile-level-id"]&&!f["profile-level-id"]){w.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const C=p(i),E=p(f);if(!C)throw new TypeError("invalid local_profile_level_id");if(!E)throw new TypeError("invalid remote_profile_level_id");if(C.profile!==E.profile)throw new TypeError("H264 Profile mismatch");const L=u(i)&&u(f),I=C.level,h=E.level,x=l(I,h),P=L?I:x;return w.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${C.profile}, level:${P}]`),n(new k(C.profile,P))}function c(i,f){for(let E=m.length-1;E>=0;--E){const L=m[E];if(L.max_macroblock_frame_size*256<=i&&L.max_macroblocks_per_second<=f*L.max_macroblock_frame_size)return w.debug(`supportedLevel() | result [max_frame_pixel_count:${i}, max_fps:${f}, level:${L.level}]`),L.level}w.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${i}, max_fps:${f}]`)}function y(i,f){return+(f[0]===i)<<7|+(f[1]===i)<<6|+(f[2]===i)<<5|+(f[3]===i)<<4|+(f[4]===i)<<3|+(f[5]===i)<<2|+(f[6]===i)<<1|+(f[7]===i)<<0}function g(i,f){return i===s.L1_b?f!==s.L1&&f!==s.L1_b:f===s.L1_b?i!==s.L1:i<f}function l(i,f){return g(i,f)?i:f}function u(i={}){const f=i["level-asymmetry-allowed"];return f===!0||f===1||f==="1"}return O}var ft;function G(){if(ft)return j;ft=1,Object.defineProperty(j,"__esModule",{value:!0}),j.validateAndNormalizeRtpCapabilities=R,j.validateAndNormalizeRtpParameters=_,j.validateAndNormalizeSctpStreamParameters=d,j.validateSctpCapabilities=T,j.getExtendedRtpCapabilities=m,j.getRecvRtpCapabilities=r,j.getSendingRtpParameters=n,j.getSendingRemoteRtpParameters=o,j.reduceCodecs=S,j.generateProbatorRtpParameters=p,j.canSend=e,j.canReceive=t;const v=pr(),w=X(),b="probator",s=1234,k=127;function R(h){if(typeof h!="object")throw new TypeError("caps is not an object");if(h.codecs&&!Array.isArray(h.codecs))throw new TypeError("caps.codecs is not an array");h.codecs||(h.codecs=[]);for(const x of h.codecs)a(x);if(h.headerExtensions&&!Array.isArray(h.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");h.headerExtensions||(h.headerExtensions=[]);for(const x of h.headerExtensions)y(x)}function _(h){if(typeof h!="object")throw new TypeError("params is not an object");if(h.mid&&typeof h.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(h.codecs))throw new TypeError("missing params.codecs");for(const x of h.codecs)g(x);if(h.headerExtensions&&!Array.isArray(h.headerExtensions))throw new TypeError("params.headerExtensions is not an array");h.headerExtensions||(h.headerExtensions=[]);for(const x of h.headerExtensions)l(x);if(h.encodings&&!Array.isArray(h.encodings))throw new TypeError("params.encodings is not an array");h.encodings||(h.encodings=[]);for(const x of h.encodings)u(x);if(h.rtcp&&typeof h.rtcp!="object")throw new TypeError("params.rtcp is not an object");h.rtcp||(h.rtcp={}),i(h.rtcp)}function d(h){if(typeof h!="object")throw new TypeError("params is not an object");if(typeof h.streamId!="number")throw new TypeError("missing params.streamId");let x=!1;if(typeof h.ordered=="boolean"?x=!0:h.ordered=!0,h.maxPacketLifeTime&&typeof h.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(h.maxRetransmits&&typeof h.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(h.maxPacketLifeTime&&h.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(x&&h.ordered&&(h.maxPacketLifeTime||h.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!x&&(h.maxPacketLifeTime||h.maxRetransmits)&&(h.ordered=!1),h.label&&typeof h.label!="string")throw new TypeError("invalid params.label");if(h.protocol&&typeof h.protocol!="string")throw new TypeError("invalid params.protocol")}function T(h){if(typeof h!="object")throw new TypeError("caps is not an object");if(!h.numStreams||typeof h.numStreams!="object")throw new TypeError("missing caps.numStreams");f(h.numStreams)}function m(h,x,P){const D={codecs:[],headerExtensions:[]};if(P)for(const M of h.codecs??[]){if(C(M))continue;const F=(x.codecs??[]).find(N=>E(N,M,{strict:!0,modify:!0}));if(!F)continue;const A={kind:M.kind,mimeType:M.mimeType,clockRate:M.clockRate,channels:M.channels,localPayloadType:M.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:F.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:M.parameters??{},remoteParameters:F.parameters??{},rtcpFeedback:I(M,F)};D.codecs.push(A)}else for(const M of x.codecs??[]){if(C(M))continue;const F=(h.codecs??[]).find(N=>E(N,M,{strict:!0,modify:!0}));if(!F)continue;const A={kind:F.kind,mimeType:F.mimeType,clockRate:F.clockRate,channels:F.channels,localPayloadType:F.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:M.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:F.parameters??{},remoteParameters:M.parameters??{},rtcpFeedback:I(F,M)};D.codecs.push(A)}for(const M of D.codecs){const F=h.codecs.find(N=>C(N)&&N.parameters?.apt===M.localPayloadType),A=x.codecs.find(N=>C(N)&&N.parameters?.apt===M.remotePayloadType);F&&A&&(M.localRtxPayloadType=F.preferredPayloadType,M.remoteRtxPayloadType=A.preferredPayloadType)}for(const M of x.headerExtensions){const F=h.headerExtensions.find(N=>L(N,M));if(!F)continue;const A={kind:M.kind,uri:M.uri,sendId:F.preferredId,recvId:M.preferredId,encrypt:F.preferredEncrypt??!1,direction:"sendrecv"};switch(M.direction){case"sendrecv":{A.direction="sendrecv";break}case"recvonly":{A.direction="sendonly";break}case"sendonly":{A.direction="recvonly";break}case"inactive":{A.direction="inactive";break}}D.headerExtensions.push(A)}return D}function r(h){const x={codecs:[],headerExtensions:[]};for(const P of h.codecs){const D={kind:P.kind,mimeType:P.mimeType,preferredPayloadType:P.remotePayloadType,clockRate:P.clockRate,channels:P.channels,parameters:P.localParameters,rtcpFeedback:P.rtcpFeedback};if(x.codecs.push(D),!P.remoteRtxPayloadType)continue;const M={kind:P.kind,mimeType:`${P.kind}/rtx`,preferredPayloadType:P.remoteRtxPayloadType,clockRate:P.clockRate,parameters:{apt:P.remotePayloadType},rtcpFeedback:[]};x.codecs.push(M)}for(const P of h.headerExtensions){if(P.direction!=="sendrecv"&&P.direction!=="recvonly")continue;const D={kind:P.kind,uri:P.uri,preferredId:P.recvId,preferredEncrypt:P.encrypt??!1,direction:P.direction};x.headerExtensions.push(D)}return x}function n(h,x){const P={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const D of x.codecs){if(D.kind!==h)continue;const M={mimeType:D.mimeType,payloadType:D.localPayloadType,clockRate:D.clockRate,channels:D.channels,parameters:D.localParameters,rtcpFeedback:D.rtcpFeedback};if(P.codecs.push(M),D.localRtxPayloadType){const F={mimeType:`${D.kind}/rtx`,payloadType:D.localRtxPayloadType,clockRate:D.clockRate,parameters:{apt:D.localPayloadType},rtcpFeedback:[]};P.codecs.push(F)}}for(const D of x.headerExtensions){if(D.kind&&D.kind!==h||D.direction!=="sendrecv"&&D.direction!=="sendonly")continue;const M={uri:D.uri,id:D.sendId,encrypt:D.encrypt,parameters:{}};P.headerExtensions.push(M)}return P}function o(h,x){const P={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const D of x.codecs){if(D.kind!==h)continue;const M={mimeType:D.mimeType,payloadType:D.localPayloadType,clockRate:D.clockRate,channels:D.channels,parameters:D.remoteParameters,rtcpFeedback:D.rtcpFeedback};if(P.codecs.push(M),D.localRtxPayloadType){const F={mimeType:`${D.kind}/rtx`,payloadType:D.localRtxPayloadType,clockRate:D.clockRate,parameters:{apt:D.localPayloadType},rtcpFeedback:[]};P.codecs.push(F)}}for(const D of x.headerExtensions){if(D.kind&&D.kind!==h||D.direction!=="sendrecv"&&D.direction!=="sendonly")continue;const M={uri:D.uri,id:D.sendId,encrypt:D.encrypt,parameters:{}};P.headerExtensions.push(M)}if(P.headerExtensions.some(D=>D.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const D of P.codecs)D.rtcpFeedback=(D.rtcpFeedback??[]).filter(M=>M.type!=="goog-remb");else if(P.headerExtensions.some(D=>D.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const D of P.codecs)D.rtcpFeedback=(D.rtcpFeedback??[]).filter(M=>M.type!=="transport-cc");else for(const D of P.codecs)D.rtcpFeedback=(D.rtcpFeedback??[]).filter(M=>M.type!=="transport-cc"&&M.type!=="goog-remb");return P}function S(h,x){const P=[];if(!x)P.push(h[0]),C(h[1])&&P.push(h[1]);else{for(let D=0;D<h.length;++D)if(E(h[D],x,{strict:!0})){P.push(h[D]),C(h[D+1])&&P.push(h[D+1]);break}if(P.length===0)throw new TypeError("no matching codec found")}return P}function p(h){h=w.clone(h),_(h);const x={mid:b,codecs:[],headerExtensions:[],encodings:[{ssrc:s}],rtcp:{cname:"probator"}};return x.codecs.push(h.codecs[0]),x.codecs[0].payloadType=k,x.headerExtensions=h.headerExtensions,x}function e(h,x){return(x.codecs??[]).some(P=>P.kind===h)}function t(h,x){if(_(h),h.codecs.length===0)return!1;const P=h.codecs[0];return(x.codecs??[]).some(D=>D.preferredPayloadType===P.payloadType)}function a(h){const x=new RegExp("^(audio|video)/(.+)","i");if(typeof h!="object")throw new TypeError("codec is not an object");if(!h.mimeType||typeof h.mimeType!="string")throw new TypeError("missing codec.mimeType");const P=x.exec(h.mimeType);if(!P)throw new TypeError("invalid codec.mimeType");if(h.kind=P[1].toLowerCase(),typeof h.preferredPayloadType!="number")throw new TypeError("missing codec.preferredPayloadType");if(typeof h.clockRate!="number")throw new TypeError("missing codec.clockRate");h.kind==="audio"?typeof h.channels!="number"&&(h.channels=1):delete h.channels,(!h.parameters||typeof h.parameters!="object")&&(h.parameters={});for(const D of Object.keys(h.parameters)){let M=h.parameters[D];if(M===void 0&&(h.parameters[D]="",M=""),typeof M!="string"&&typeof M!="number")throw new TypeError(`invalid codec parameter [key:${D}s, value:${M}]`);if(D==="apt"&&typeof M!="number")throw new TypeError("invalid codec apt parameter")}(!h.rtcpFeedback||!Array.isArray(h.rtcpFeedback))&&(h.rtcpFeedback=[]);for(const D of h.rtcpFeedback)c(D)}function c(h){if(typeof h!="object")throw new TypeError("fb is not an object");if(!h.type||typeof h.type!="string")throw new TypeError("missing fb.type");(!h.parameter||typeof h.parameter!="string")&&(h.parameter="")}function y(h){if(typeof h!="object")throw new TypeError("ext is not an object");if(h.kind!=="audio"&&h.kind!=="video")throw new TypeError("invalid ext.kind");if(!h.uri||typeof h.uri!="string")throw new TypeError("missing ext.uri");if(typeof h.preferredId!="number")throw new TypeError("missing ext.preferredId");if(h.preferredEncrypt&&typeof h.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(h.preferredEncrypt||(h.preferredEncrypt=!1),h.direction&&typeof h.direction!="string")throw new TypeError("invalid ext.direction");h.direction||(h.direction="sendrecv")}function g(h){const x=new RegExp("^(audio|video)/(.+)","i");if(typeof h!="object")throw new TypeError("codec is not an object");if(!h.mimeType||typeof h.mimeType!="string")throw new TypeError("missing codec.mimeType");const P=x.exec(h.mimeType);if(!P)throw new TypeError("invalid codec.mimeType");if(typeof h.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof h.clockRate!="number")throw new TypeError("missing codec.clockRate");P[1].toLowerCase()==="audio"?typeof h.channels!="number"&&(h.channels=1):delete h.channels,(!h.parameters||typeof h.parameters!="object")&&(h.parameters={});for(const M of Object.keys(h.parameters)){let F=h.parameters[M];if(F===void 0&&(h.parameters[M]="",F=""),typeof F!="string"&&typeof F!="number")throw new TypeError(`invalid codec parameter [key:${M}s, value:${F}]`);if(M==="apt"&&typeof F!="number")throw new TypeError("invalid codec apt parameter")}(!h.rtcpFeedback||!Array.isArray(h.rtcpFeedback))&&(h.rtcpFeedback=[]);for(const M of h.rtcpFeedback)c(M)}function l(h){if(typeof h!="object")throw new TypeError("ext is not an object");if(!h.uri||typeof h.uri!="string")throw new TypeError("missing ext.uri");if(typeof h.id!="number")throw new TypeError("missing ext.id");if(h.encrypt&&typeof h.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");h.encrypt||(h.encrypt=!1),(!h.parameters||typeof h.parameters!="object")&&(h.parameters={});for(const x of Object.keys(h.parameters)){let P=h.parameters[x];if(P===void 0&&(h.parameters[x]="",P=""),typeof P!="string"&&typeof P!="number")throw new TypeError("invalid header extension parameter")}}function u(h){if(typeof h!="object")throw new TypeError("encoding is not an object");if(h.ssrc&&typeof h.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(h.rid&&typeof h.rid!="string")throw new TypeError("invalid encoding.rid");if(h.rtx&&typeof h.rtx!="object")throw new TypeError("invalid encoding.rtx");if(h.rtx&&typeof h.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!h.dtx||typeof h.dtx!="boolean")&&(h.dtx=!1),h.scalabilityMode&&typeof h.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function i(h){if(typeof h!="object")throw new TypeError("rtcp is not an object");if(h.cname&&typeof h.cname!="string")throw new TypeError("invalid rtcp.cname");(!h.reducedSize||typeof h.reducedSize!="boolean")&&(h.reducedSize=!0)}function f(h){if(typeof h!="object")throw new TypeError("numStreams is not an object");if(typeof h.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof h.MIS!="number")throw new TypeError("missing numStreams.MIS")}function C(h){return h?/.+\/rtx$/i.test(h.mimeType):!1}function E(h,x,{strict:P=!1,modify:D=!1}={}){const M=h.mimeType.toLowerCase(),F=x.mimeType.toLowerCase();if(M!==F||h.clockRate!==x.clockRate||h.channels!==x.channels)return!1;switch(M){case"video/h264":{if(P){const A=h.parameters["packetization-mode"]??0,N=x.parameters["packetization-mode"]??0;if(A!==N||!v.isSameProfile(h.parameters,x.parameters))return!1;let Ee;try{Ee=v.generateProfileLevelIdStringForAnswer(h.parameters,x.parameters)}catch{return!1}D&&(Ee?(h.parameters["profile-level-id"]=Ee,x.parameters["profile-level-id"]=Ee):(delete h.parameters["profile-level-id"],delete x.parameters["profile-level-id"]))}break}case"video/vp9":{if(P){const A=h.parameters["profile-id"]??0,N=x.parameters["profile-id"]??0;if(A!==N)return!1}break}}return!0}function L(h,x){return!(h.kind&&x.kind&&h.kind!==x.kind||h.uri!==x.uri)}function I(h,x){const P=[];for(const D of h.rtcpFeedback??[]){const M=(x.rtcpFeedback??[]).find(F=>F.type===D.type&&(F.parameter===D.parameter||!F.parameter&&!D.parameter));M&&P.push(M)}return P}return j}var se={},He={},ie={},ne={},xe={exports:{}},Qe,mt;function lr(){if(mt)return Qe;mt=1;var v=1e3,w=v*60,b=w*60,s=b*24,k=s*7,R=s*365.25;Qe=function(r,n){n=n||{};var o=typeof r;if(o==="string"&&r.length>0)return _(r);if(o==="number"&&isFinite(r))return n.long?T(r):d(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function _(r){if(r=String(r),!(r.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(n){var o=parseFloat(n[1]),S=(n[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return o*R;case"weeks":case"week":case"w":return o*k;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*b;case"minutes":case"minute":case"mins":case"min":case"m":return o*w;case"seconds":case"second":case"secs":case"sec":case"s":return o*v;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}function d(r){var n=Math.abs(r);return n>=s?Math.round(r/s)+"d":n>=b?Math.round(r/b)+"h":n>=w?Math.round(r/w)+"m":n>=v?Math.round(r/v)+"s":r+"ms"}function T(r){var n=Math.abs(r);return n>=s?m(r,n,s,"day"):n>=b?m(r,n,b,"hour"):n>=w?m(r,n,w,"minute"):n>=v?m(r,n,v,"second"):r+" ms"}function m(r,n,o,S){var p=n>=o*1.5;return Math.round(r/o)+" "+S+(p?"s":"")}return Qe}var We,gt;function ur(){if(gt)return We;gt=1;function v(w){s.debug=s,s.default=s,s.coerce=m,s.disable=d,s.enable=R,s.enabled=T,s.humanize=lr(),s.destroy=r,Object.keys(w).forEach(n=>{s[n]=w[n]}),s.names=[],s.skips=[],s.formatters={};function b(n){let o=0;for(let S=0;S<n.length;S++)o=(o<<5)-o+n.charCodeAt(S),o|=0;return s.colors[Math.abs(o)%s.colors.length]}s.selectColor=b;function s(n){let o,S=null,p,e;function t(...a){if(!t.enabled)return;const c=t,y=Number(new Date),g=y-(o||y);c.diff=g,c.prev=o,c.curr=y,o=y,a[0]=s.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");let l=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(i,f)=>{if(i==="%%")return"%";l++;const C=s.formatters[f];if(typeof C=="function"){const E=a[l];i=C.call(c,E),a.splice(l,1),l--}return i}),s.formatArgs.call(c,a),(c.log||s.log).apply(c,a)}return t.namespace=n,t.useColors=s.useColors(),t.color=s.selectColor(n),t.extend=k,t.destroy=s.destroy,Object.defineProperty(t,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(p!==s.namespaces&&(p=s.namespaces,e=s.enabled(n)),e),set:a=>{S=a}}),typeof s.init=="function"&&s.init(t),t}function k(n,o){const S=s(this.namespace+(typeof o>"u"?":":o)+n);return S.log=this.log,S}function R(n){s.save(n),s.namespaces=n,s.names=[],s.skips=[];const o=(typeof n=="string"?n:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const S of o)S[0]==="-"?s.skips.push(S.slice(1)):s.names.push(S)}function _(n,o){let S=0,p=0,e=-1,t=0;for(;S<n.length;)if(p<o.length&&(o[p]===n[S]||o[p]==="*"))o[p]==="*"?(e=p,t=S,p++):(S++,p++);else if(e!==-1)p=e+1,t++,S=t;else return!1;for(;p<o.length&&o[p]==="*";)p++;return p===o.length}function d(){const n=[...s.names,...s.skips.map(o=>"-"+o)].join(",");return s.enable(""),n}function T(n){for(const o of s.skips)if(_(n,o))return!1;for(const o of s.names)if(_(n,o))return!0;return!1}function m(n){return n instanceof Error?n.stack||n.message:n}function r(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return We=v,We}var _t;function hr(){return _t||(_t=1,(function(v,w){var b={};w.formatArgs=k,w.save=R,w.load=_,w.useColors=s,w.storage=d(),w.destroy=(()=>{let m=!1;return()=>{m||(m=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),w.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let m;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(m=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(m[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function k(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+v.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;m.splice(1,0,r,"color: inherit");let n=0,o=0;m[0].replace(/%[a-zA-Z%]/g,S=>{S!=="%%"&&(n++,S==="%c"&&(o=n))}),m.splice(o,0,r)}w.log=console.debug||console.log||(()=>{});function R(m){try{m?w.storage.setItem("debug",m):w.storage.removeItem("debug")}catch{}}function _(){let m;try{m=w.storage.getItem("debug")||w.storage.getItem("DEBUG")}catch{}return!m&&typeof process<"u"&&"env"in process&&(m=b.DEBUG),m}function d(){try{return localStorage}catch{}}v.exports=ur()(w);const{formatters:T}=v.exports;T.j=function(m){try{return JSON.stringify(m)}catch(r){return"[UnexpectedJSONParseError]: "+r.message}}})(xe,xe.exports)),xe.exports}var vt;function fr(){if(vt)return ne;vt=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.Logger=void 0;const v=hr(),w="awaitqueue";let b=class{_debug;_warn;_error;constructor(k){k?(this._debug=v(`${w}:${k}`),this._warn=v(`${w}:WARN:${k}`),this._error=v(`${w}:ERROR:${k}`)):(this._debug=v(w),this._warn=v(`${w}:WARN`),this._error=v(`${w}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};return ne.Logger=b,ne}var J={},wt;function Xt(){if(wt)return J;wt=1,Object.defineProperty(J,"__esModule",{value:!0}),J.AwaitQueueRemovedTaskError=J.AwaitQueueStoppedError=void 0;class v extends Error{constructor(s){super(s??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,v)}}J.AwaitQueueStoppedError=v;class w extends Error{constructor(s){super(s??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,w)}}return J.AwaitQueueRemovedTaskError=w,J}var bt;function mr(){if(bt)return ie;bt=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.AwaitQueue=void 0;const v=fr(),w=Xt(),b=new v.Logger("AwaitQueue");let s=class{pendingTasks=new Map;nextTaskId=0;stopping=!1;constructor(){b.debug("constructor()")}get size(){return this.pendingTasks.size}async push(R,_){if(_=_??R.name,b.debug(`push() [name:${_}]`),typeof R!="function")throw new TypeError("given task is not a function");if(_)try{Object.defineProperty(R,"name",{value:_})}catch{}return new Promise((d,T)=>{const m={id:this.nextTaskId++,task:R,name:_,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:r=>{if(m.completed)return;m.completed=!0,this.pendingTasks.delete(m.id),b.debug(`resolving task [name:${m.name}]`),d(r);const[n]=this.pendingTasks.values();n&&!n.executedAt&&this.execute(n)},reject:r=>{if(!m.completed&&(m.completed=!0,this.pendingTasks.delete(m.id),b.debug(`rejecting task [name:${m.name}]: %s`,String(r)),T(r),!this.stopping)){const[n]=this.pendingTasks.values();n&&!n.executedAt&&this.execute(n)}}};this.pendingTasks.set(m.id,m),this.pendingTasks.size===1&&this.execute(m)})}stop(){b.debug("stop()"),this.stopping=!0;for(const R of this.pendingTasks.values())b.debug(`stop() | stopping task [name:${R.name}]`),R.reject(new w.AwaitQueueStoppedError);this.stopping=!1}remove(R){b.debug(`remove() [taskIdx:${R}]`);const _=Array.from(this.pendingTasks.values())[R];if(!_){b.debug(`stop() | no task with given idx [taskIdx:${R}]`);return}_.reject(new w.AwaitQueueRemovedTaskError)}dump(){const R=Date.now();let _=0;return Array.from(this.pendingTasks.values()).map(d=>({idx:_++,task:d.task,name:d.name,enqueuedTime:d.executedAt?d.executedAt-d.enqueuedAt:R-d.enqueuedAt,executionTime:d.executedAt?R-d.executedAt:0}))}async execute(R){if(b.debug(`execute() [name:${R.name}]`),R.executedAt)throw new Error("task already being executed");R.executedAt=Date.now();try{const _=await R.task();R.resolve(_)}catch(_){R.reject(_)}}};return ie.AwaitQueue=s,ie}var yt;function gr(){return yt||(yt=1,(function(v){Object.defineProperty(v,"__esModule",{value:!0}),v.AwaitQueueRemovedTaskError=v.AwaitQueueStoppedError=v.AwaitQueue=void 0;var w=mr();Object.defineProperty(v,"AwaitQueue",{enumerable:!0,get:function(){return w.AwaitQueue}});var b=Xt();Object.defineProperty(v,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return b.AwaitQueueStoppedError}}),Object.defineProperty(v,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return b.AwaitQueueRemovedTaskError}})})(He)),He}var ae={},Ct;function _r(){if(Ct)return ae;Ct=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.Producer=void 0;const v=$(),w=z(),b=U(),s=new v.Logger("Producer");let k=class extends w.EnhancedEventEmitter{_id;_localId;_closed=!1;_rtpSender;_track;_kind;_rtpParameters;_paused;_maxSpatialLayer;_stopTracks;_disableTrackOnPause;_zeroRtpOnPause;_appData;_observer=new w.EnhancedEventEmitter;constructor({id:_,localId:d,rtpSender:T,track:m,rtpParameters:r,stopTracks:n,disableTrackOnPause:o,zeroRtpOnPause:S,appData:p}){super(),s.debug("constructor()"),this._id=_,this._localId=d,this._rtpSender=T,this._track=m,this._kind=m.kind,this._rtpParameters=r,this._paused=o?!m.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=n,this._disableTrackOnPause=o,this._zeroRtpOnPause=S,this._appData=p??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new b.InvalidStateError("closed");return new Promise((_,d)=>{this.safeEmit("@getstats",_,d)})}pause(){if(s.debug("pause()"),this._closed){s.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((_,d)=>{this.safeEmit("@pause",_,d)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(s.debug("resume()"),this._closed){s.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((_,d)=>{this.safeEmit("@resume",_,d)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:_}){if(s.debug("replaceTrack() [track:%o]",_),this._closed){if(_&&this._stopTracks)try{_.stop()}catch{}throw new b.InvalidStateError("closed")}else if(_&&_.readyState==="ended")throw new b.InvalidStateError("track ended");if(_===this._track){s.debug("replaceTrack() | same track, ignored");return}await new Promise((d,T)=>{this.safeEmit("@replacetrack",_,d,T)}),this.destroyTrack(),this._track=_,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(_){if(this._closed)throw new b.InvalidStateError("closed");if(this._kind!=="video")throw new b.UnsupportedError("not a video Producer");if(typeof _!="number")throw new TypeError("invalid spatialLayer");_!==this._maxSpatialLayer&&(await new Promise((d,T)=>{this.safeEmit("@setmaxspatiallayer",_,d,T)}).catch(()=>{}),this._maxSpatialLayer=_)}async setRtpEncodingParameters(_){if(this._closed)throw new b.InvalidStateError("closed");if(typeof _!="object")throw new TypeError("invalid params");await new Promise((d,T)=>{this.safeEmit("@setrtpencodingparameters",_,d,T)})}onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};return ae.Producer=k,ae}var oe={},St;function vr(){if(St)return oe;St=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.Consumer=void 0;const v=$(),w=z(),b=U(),s=new v.Logger("Consumer");let k=class extends w.EnhancedEventEmitter{_id;_localId;_producerId;_closed=!1;_rtpReceiver;_track;_rtpParameters;_paused;_appData;_observer=new w.EnhancedEventEmitter;constructor({id:_,localId:d,producerId:T,rtpReceiver:m,track:r,rtpParameters:n,appData:o}){super(),s.debug("constructor()"),this._id=_,this._localId=d,this._producerId=T,this._rtpReceiver=m,this._track=r,this._rtpParameters=n,this._paused=!r.enabled,this._appData=o??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new b.InvalidStateError("closed");return new Promise((_,d)=>{this.safeEmit("@getstats",_,d)})}pause(){if(s.debug("pause()"),this._closed){s.error("pause() | Consumer closed");return}if(this._paused){s.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(s.debug("resume()"),this._closed){s.error("resume() | Consumer closed");return}if(!this._paused){s.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};return oe.Consumer=k,oe}var ce={},Rt;function wr(){if(Rt)return ce;Rt=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.DataProducer=void 0;const v=$(),w=z(),b=U(),s=new v.Logger("DataProducer");let k=class extends w.EnhancedEventEmitter{_id;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new w.EnhancedEventEmitter;constructor({id:_,dataChannel:d,sctpStreamParameters:T,appData:m}){super(),s.debug("constructor()"),this._id=_,this._dataChannel=d,this._sctpStreamParameters=T,this._appData=m??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(_){this._dataChannel.bufferedAmountLowThreshold=_}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(_){if(s.debug("send()"),this._closed)throw new b.InvalidStateError("closed");this._dataChannel.send(_)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",_=>{if(this._closed)return;const d=_.error??new Error("unknown DataChannel error");_.error?.errorDetail==="sctp-failure"?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",_.error?.sctpCauseCode,_.error.message):s.error('DataChannel "error" event: %o',d),this.safeEmit("error",d)}),this._dataChannel.addEventListener("close",()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||s.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};return ce.DataProducer=k,ce}var de={},Et;function br(){if(Et)return de;Et=1,Object.defineProperty(de,"__esModule",{value:!0}),de.DataConsumer=void 0;const v=$(),w=z(),b=new v.Logger("DataConsumer");let s=class extends w.EnhancedEventEmitter{_id;_dataProducerId;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new w.EnhancedEventEmitter;constructor({id:R,dataProducerId:_,dataChannel:d,sctpStreamParameters:T,appData:m}){super(),b.debug("constructor()"),this._id=R,this._dataProducerId=_,this._dataChannel=d,this._sctpStreamParameters=T,this._appData=m??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(R){this._dataChannel.binaryType=R}get appData(){return this._appData}set appData(R){this._appData=R}get observer(){return this._observer}close(){this._closed||(b.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(b.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(b.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",R=>{if(this._closed)return;const _=R.error??new Error("unknown DataChannel error");R.error?.errorDetail==="sctp-failure"?b.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",R.error?.sctpCauseCode,R.error.message):b.error('DataChannel "error" event: %o',_),this.safeEmit("error",_)}),this._dataChannel.addEventListener("close",()=>{this._closed||(b.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",R=>{this._closed||this.safeEmit("message",R.data)})}};return de.DataConsumer=s,de}var Tt;function yr(){if(Tt)return se;Tt=1,Object.defineProperty(se,"__esModule",{value:!0}),se.Transport=void 0;const v=gr(),w=$(),b=z(),s=U(),k=X(),R=G(),_=_r(),d=vr(),T=wr(),m=br(),r=new w.Logger("Transport");class n{consumerOptions;promise;resolve;reject;constructor(p){this.consumerOptions=p,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}let o=class extends b.EnhancedEventEmitter{_id;_closed=!1;_direction;_getSendExtendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind;_maxSctpMessageSize;_handler;_iceGatheringState="new";_connectionState="new";_appData;_producers=new Map;_consumers=new Map;_dataProducers=new Map;_dataConsumers=new Map;_probatorConsumerCreated=!1;_awaitQueue=new v.AwaitQueue;_pendingConsumerTasks=[];_consumerCreationInProgress=!1;_pendingPauseConsumers=new Map;_consumerPauseInProgress=!1;_pendingResumeConsumers=new Map;_consumerResumeInProgress=!1;_pendingCloseConsumers=new Map;_consumerCloseInProgress=!1;_observer=new b.EnhancedEventEmitter;constructor({direction:p,id:e,iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y,iceServers:g,iceTransportPolicy:l,additionalSettings:u,appData:i,handlerFactory:f,getSendExtendedRtpCapabilities:C,recvRtpCapabilities:E,canProduceByKind:L}){super(),r.debug("constructor() [id:%s, direction:%s]",e,p),this._id=e,this._direction=p,this._getSendExtendedRtpCapabilities=C,this._recvRtpCapabilities=E,this._canProduceByKind=L,this._maxSctpMessageSize=y?y.maxMessageSize:null;const I=k.clone(u)??{};delete I.iceServers,delete I.iceTransportPolicy,delete I.bundlePolicy,delete I.rtcpMuxPolicy,this._handler=f.factory({direction:p,iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y,iceServers:g,iceTransportPolicy:l,additionalSettings:I,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities}),this._appData=i??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(p){this._appData=p}get observer(){return this._observer}close(){if(!this._closed){r.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const p of this._producers.values())p.transportClosed();this._producers.clear();for(const p of this._consumers.values())p.transportClosed();this._consumers.clear();for(const p of this._dataProducers.values())p.transportClosed();this._dataProducers.clear();for(const p of this._dataConsumers.values())p.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close"),super.close(),this._observer.close()}}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:p}){if(r.debug("restartIce()"),this._closed)throw new s.InvalidStateError("closed");if(!p)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(p),"transport.restartIce()")}async updateIceServers({iceServers:p}={}){if(r.debug("updateIceServers()"),this._closed)throw new s.InvalidStateError("closed");if(!Array.isArray(p))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(p),"transport.updateIceServers()")}async produce({track:p,encodings:e,codecOptions:t,codec:a,stopTracks:c=!0,disableTrackOnPause:y=!0,zeroRtpOnPause:g=!1,onRtpSender:l,appData:u={}}={}){if(r.debug("produce() [track:%o]",p),this._closed)throw new s.InvalidStateError("closed");if(p){if(this._direction!=="send")throw new s.UnsupportedError("not a sending Transport");if(this._canProduceByKind[p.kind]){if(p.readyState==="ended")throw new s.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(u&&typeof u!="object")throw new TypeError("if given, appData must be an object")}else throw new s.UnsupportedError(`cannot produce ${p.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let i;if(e&&!Array.isArray(e))throw TypeError("encodings must be an array");e&&e.length===0?i=void 0:e&&(i=e.map(L=>{const I={active:!0};return L.active===!1&&(I.active=!1),typeof L.dtx=="boolean"&&(I.dtx=L.dtx),typeof L.scalabilityMode=="string"&&(I.scalabilityMode=L.scalabilityMode),typeof L.scaleResolutionDownBy=="number"&&(I.scaleResolutionDownBy=L.scaleResolutionDownBy),typeof L.maxBitrate=="number"&&(I.maxBitrate=L.maxBitrate),typeof L.maxFramerate=="number"&&(I.maxFramerate=L.maxFramerate),typeof L.adaptivePtime=="boolean"&&(I.adaptivePtime=L.adaptivePtime),typeof L.priority=="string"&&(I.priority=L.priority),typeof L.networkPriority=="string"&&(I.networkPriority=L.networkPriority),I}));const{localId:f,rtpParameters:C,rtpSender:E}=await this._handler.send({track:p,encodings:i,codecOptions:t,codec:a,onRtpSender:l});try{R.validateAndNormalizeRtpParameters(C);const{id:L}=await new Promise((h,x)=>{this.safeEmit("produce",{kind:p.kind,rtpParameters:C,appData:u},h,x)}),I=new _.Producer({id:L,localId:f,rtpSender:E,track:p,rtpParameters:C,stopTracks:c,disableTrackOnPause:y,zeroRtpOnPause:g,appData:u});return this._producers.set(I.id,I),this.handleProducer(I),this._observer.safeEmit("newproducer",I),I}catch(L){throw this._handler.stopSending(f).catch(()=>{}),L}},"transport.produce()").catch(i=>{if(c)try{p.stop()}catch{}throw i})}async consume({id:p,producerId:e,kind:t,rtpParameters:a,streamId:c,onRtpReceiver:y,appData:g={}}){if(r.debug("consume()"),this._closed)throw new s.InvalidStateError("closed");if(this._direction!=="recv")throw new s.UnsupportedError("not a receiving Transport");if(typeof p!="string")throw new TypeError("missing id");if(typeof e!="string")throw new TypeError("missing producerId");if(t!=="audio"&&t!=="video")throw new TypeError(`invalid kind '${t}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(g&&typeof g!="object")throw new TypeError("if given, appData must be an object");const l=k.clone(a);if(!R.canReceive(l,this._recvRtpCapabilities))throw new s.UnsupportedError("cannot consume this Producer");const i=new n({id:p,producerId:e,kind:t,rtpParameters:l,streamId:c,onRtpReceiver:y,appData:g});return this._pendingConsumerTasks.push(i),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),i.promise}async produceData({ordered:p=!0,maxPacketLifeTime:e,maxRetransmits:t,label:a="",protocol:c="",appData:y={}}={}){if(r.debug("produceData()"),this._closed)throw new s.InvalidStateError("closed");if(this._direction!=="send")throw new s.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(y&&typeof y!="object")throw new TypeError("if given, appData must be an object")}else throw new s.UnsupportedError("SCTP not enabled by remote Transport");return(e||t)&&(p=!1),this._awaitQueue.push(async()=>{const{dataChannel:g,sctpStreamParameters:l}=await this._handler.sendDataChannel({ordered:p,maxPacketLifeTime:e,maxRetransmits:t,label:a,protocol:c});R.validateAndNormalizeSctpStreamParameters(l);const{id:u}=await new Promise((f,C)=>{this.safeEmit("producedata",{sctpStreamParameters:l,label:a,protocol:c,appData:y},f,C)}),i=new T.DataProducer({id:u,dataChannel:g,sctpStreamParameters:l,appData:y});return this._dataProducers.set(i.id,i),this.handleDataProducer(i),this._observer.safeEmit("newdataproducer",i),i},"transport.produceData()")}async consumeData({id:p,dataProducerId:e,sctpStreamParameters:t,label:a="",protocol:c="",appData:y={}}){if(r.debug("consumeData()"),this._closed)throw new s.InvalidStateError("closed");if(this._direction!=="recv")throw new s.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof p!="string")throw new TypeError("missing id");if(typeof e!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(y&&typeof y!="object")throw new TypeError("if given, appData must be an object")}else throw new s.UnsupportedError("SCTP not enabled by remote Transport");const g=k.clone(t);return R.validateAndNormalizeSctpStreamParameters(g),this._awaitQueue.push(async()=>{const{dataChannel:l}=await this._handler.receiveDataChannel({sctpStreamParameters:g,label:a,protocol:c}),u=new m.DataConsumer({id:p,dataProducerId:e,dataChannel:l,sctpStreamParameters:g,appData:y});return this._dataConsumers.set(u.id,u),this.handleDataConsumer(u),this._observer.safeEmit("newdataconsumer",u),u},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){r.debug("createPendingConsumers() | there is no Consumer to be created");return}const p=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let e;const t=[];for(const a of p){const{id:c,kind:y,rtpParameters:g,streamId:l,onRtpReceiver:u}=a.consumerOptions;t.push({trackId:c,kind:y,rtpParameters:g,streamId:l,onRtpReceiver:u})}try{const a=await this._handler.receive(t);for(let c=0;c<a.length;++c){const y=p[c],g=a[c],{id:l,producerId:u,kind:i,rtpParameters:f,appData:C}=y.consumerOptions,{localId:E,rtpReceiver:L,track:I}=g,h=new d.Consumer({id:l,localId:E,producerId:u,rtpReceiver:L,track:I,rtpParameters:f,appData:C});this._consumers.set(h.id,h),this.handleConsumer(h),!this._probatorConsumerCreated&&!e&&i==="video"&&(e=h),this._observer.safeEmit("newconsumer",h),y.resolve(h)}}catch(a){for(const c of p)c.reject(a)}if(e)try{const a=R.generateProbatorRtpParameters(e.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:a}]),r.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(a){r.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",a)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){r.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const p=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const e=p.map(t=>t.localId);await this._handler.pauseReceiving(e)}catch(e){r.error("pausePendingConsumers() | failed to pause Consumers:",e)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){r.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const p=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const e=p.map(t=>t.localId);await this._handler.resumeReceiving(e)}catch(e){r.error("resumePendingConsumers() | failed to resume Consumers:",e)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){r.debug("closePendingConsumers() | there is no Consumer to be closed");return}const p=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(p.map(e=>e.localId))}catch(e){r.error("closePendingConsumers() | failed to close Consumers:",e)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const p=this._handler;p.on("@connect",({dtlsParameters:e},t,a)=>{if(this._closed){a(new s.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:e},t,a)}),p.on("@icegatheringstatechange",e=>{e!==this._iceGatheringState&&(r.debug("ICE gathering state changed to %s",e),this._iceGatheringState=e,this._closed||this.safeEmit("icegatheringstatechange",e))}),p.on("@icecandidateerror",e=>{r.warn(`ICE candidate error [url:${e.url}, localAddress:${e.address}, localPort:${e.port}]: ${e.errorCode} "${e.errorText}"`),this.safeEmit("icecandidateerror",e)}),p.on("@connectionstatechange",e=>{e!==this._connectionState&&(r.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))})}handleProducer(p){p.on("@close",()=>{this._producers.delete(p.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(p.localId),"producer @close event").catch(e=>r.warn("producer.close() failed:%o",e))}),p.on("@pause",(e,t)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(p.localId),"producer @pause event").then(e).catch(t)}),p.on("@resume",(e,t)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(p.localId),"producer @resume event").then(e).catch(t)}),p.on("@replacetrack",(e,t,a)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(p.localId,e),"producer @replacetrack event").then(t).catch(a)}),p.on("@setmaxspatiallayer",(e,t,a)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(p.localId,e),"producer @setmaxspatiallayer event").then(t).catch(a)}),p.on("@setrtpencodingparameters",(e,t,a)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(p.localId,e),"producer @setrtpencodingparameters event").then(t).catch(a)}),p.on("@getstats",(e,t)=>{if(this._closed)return t(new s.InvalidStateError("closed"));this._handler.getSenderStats(p.localId).then(e).catch(t)})}handleConsumer(p){p.on("@close",()=>{this._consumers.delete(p.id),this._pendingPauseConsumers.delete(p.id),this._pendingResumeConsumers.delete(p.id),!this._closed&&(this._pendingCloseConsumers.set(p.id,p),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),p.on("@pause",()=>{this._pendingResumeConsumers.has(p.id)&&this._pendingResumeConsumers.delete(p.id),this._pendingPauseConsumers.set(p.id,p),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),p.on("@resume",()=>{this._pendingPauseConsumers.has(p.id)&&this._pendingPauseConsumers.delete(p.id),this._pendingResumeConsumers.set(p.id,p),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),p.on("@getstats",(e,t)=>{if(this._closed)return t(new s.InvalidStateError("closed"));this._handler.getReceiverStats(p.localId).then(e).catch(t)})}handleDataProducer(p){p.on("@close",()=>{this._dataProducers.delete(p.id)})}handleDataConsumer(p){p.on("@close",()=>{this._dataConsumers.delete(p.id)})}};return se.Transport=o,se}var pe={},B={},Ke={},Je={exports:{}},kt;function Xe(){if(kt)return Je.exports;kt=1;var v=Je.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(w){return w.encoding?"rtpmap:%d %s/%s/%s":w.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(w){return w.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(w){return w.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(w){return"extmap:%d"+(w.direction?"/%s":"%v")+(w["encrypt-uri"]?" %s":"%v")+" %s"+(w.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(w){return w.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(w){var b="candidate:%s %d %s %d %s %d typ %s";return b+=w.raddr!=null?" raddr %s rport %d":"%v%v",b+=w.tcptype!=null?" tcptype %s":"%v",w.generation!=null&&(b+=" generation %d"),b+=w["network-id"]!=null?" network-id %d":"%v",b+=w["network-cost"]!=null?" network-cost %d":"%v",b}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(w){var b="ssrc:%d";return w.attribute!=null&&(b+=" %s",w.value!=null&&(b+=":%s")),b}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(w){return w.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(w){return w.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(w){return"imageattr:%s %s %s"+(w.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(w){return"simulcast:%s %s"+(w.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(w){return"ts-refclk:%s"+(w.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(w){var b="mediaclk:";return b+=w.id!=null?"id=%s %s":"%v%s",b+=w.mediaClockValue!=null?"=%s":"",b+=w.rateNumerator!=null?" rate=%s":"",b+=w.rateDenominator!=null?"/%s":"",b}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(v).forEach(function(w){var b=v[w];b.forEach(function(s){s.reg||(s.reg=/(.*)/),s.format||(s.format="%s")})}),Je.exports}var Dt;function Cr(){return Dt||(Dt=1,(function(v){var w=function(d){return String(Number(d))===d?Number(d):d},b=function(d,T,m,r){if(r&&!m)T[r]=w(d[1]);else for(var n=0;n<m.length;n+=1)d[n+1]!=null&&(T[m[n]]=w(d[n+1]))},s=function(d,T,m){var r=d.name&&d.names;d.push&&!T[d.push]?T[d.push]=[]:r&&!T[d.name]&&(T[d.name]={});var n=d.push?{}:r?T[d.name]:T;b(m.match(d.reg),n,d.names,d.name),d.push&&T[d.push].push(n)},k=Xe(),R=RegExp.prototype.test.bind(/^([a-z])=(.*)/);v.parse=function(d){var T={},m=[],r=T;return d.split(/(\r\n|\r|\n)/).filter(R).forEach(function(n){var o=n[0],S=n.slice(2);o==="m"&&(m.push({rtp:[],fmtp:[]}),r=m[m.length-1]);for(var p=0;p<(k[o]||[]).length;p+=1){var e=k[o][p];if(e.reg.test(S))return s(e,r,S)}}),T.media=m,T};var _=function(d,T){var m=T.split(/=(.+)/,2);return m.length===2?d[m[0]]=w(m[1]):m.length===1&&T.length>1&&(d[m[0]]=void 0),d};v.parseParams=function(d){return d.split(/;\s?/).reduce(_,{})},v.parseFmtpConfig=v.parseParams,v.parsePayloads=function(d){return d.toString().split(" ").map(Number)},v.parseRemoteCandidates=function(d){for(var T=[],m=d.split(" ").map(w),r=0;r<m.length;r+=3)T.push({component:m[r],ip:m[r+1],port:m[r+2]});return T},v.parseImageAttributes=function(d){return d.split(" ").map(function(T){return T.substring(1,T.length-1).split(",").reduce(_,{})})},v.parseSimulcastStreamList=function(d){return d.split(";").map(function(T){return T.split(",").map(function(m){var r,n=!1;return m[0]!=="~"?r=w(m):(r=w(m.substring(1,m.length)),n=!0),{scid:r,paused:n}})})}})(Ke)),Ke}var Ze,xt;function Sr(){if(xt)return Ze;xt=1;var v=Xe(),w=/%[sdv%]/g,b=function(_){var d=1,T=arguments,m=T.length;return _.replace(w,function(r){if(d>=m)return r;var n=T[d];switch(d+=1,r){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}})},s=function(_,d,T){var m=d.format instanceof Function?d.format(d.push?T:T[d.name]):d.format,r=[_+"="+m];if(d.names)for(var n=0;n<d.names.length;n+=1){var o=d.names[n];d.name?r.push(T[d.name][o]):r.push(T[d.names[n]])}else r.push(T[d.name]);return b.apply(null,r)},k=["v","o","s","i","u","e","p","c","b","t","r","z","a"],R=["i","c","b","a"];return Ze=function(_,d){d=d||{},_.version==null&&(_.version=0),_.name==null&&(_.name=" "),_.media.forEach(function(n){n.payloads==null&&(n.payloads="")});var T=d.outerOrder||k,m=d.innerOrder||R,r=[];return T.forEach(function(n){v[n].forEach(function(o){o.name in _&&_[o.name]!=null?r.push(s(n,o,_)):o.push in _&&_[o.push]!=null&&_[o.push].forEach(function(S){r.push(s(n,o,S))})})}),_.media.forEach(function(n){r.push(s("m",v.m[0],n)),m.forEach(function(o){v[o].forEach(function(S){S.name in n&&n[S.name]!=null?r.push(s(o,S,n)):S.push in n&&n[S.push]!=null&&n[S.push].forEach(function(p){r.push(s(o,S,p))})})})}),r.join(`\r
`)+`\r
`},Ze}var Pt;function H(){if(Pt)return B;Pt=1;var v=Cr(),w=Sr(),b=Xe();return B.grammar=b,B.write=w,B.parse=v.parse,B.parseParams=v.parseParams,B.parseFmtpConfig=v.parseFmtpConfig,B.parsePayloads=v.parsePayloads,B.parseRemoteCandidates=v.parseRemoteCandidates,B.parseImageAttributes=v.parseImageAttributes,B.parseSimulcastStreamList=v.parseSimulcastStreamList,B}var Pe={},Lt;function ee(){if(Lt)return Pe;Lt=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.parse=w;const v=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function w(b){const s=v.exec(b??"");return s?{spatialLayers:Number(s[1]),temporalLayers:Number(s[2])}:{spatialLayers:1,temporalLayers:1}}return Pe}var Z={},Mt;function Ce(){if(Mt)return Z;Mt=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.extractRtpCapabilities=w,Z.extractDtlsParameters=b,Z.getCname=s,Z.applyCodecParameters=k;const v=H();function w({sdpObject:R}){const _=new Map,d=new Map;for(const m of R.media){const r=m.type;switch(r){case"audio":case"video":break;default:continue}for(const n of m.rtp){const o={kind:r,mimeType:`${r}/${n.codec}`,preferredPayloadType:n.payload,clockRate:n.rate,channels:n.encoding,parameters:{},rtcpFeedback:[]};_.set(o.preferredPayloadType,o)}for(const n of m.fmtp??[]){const o=v.parseParams(n.config),S=_.get(n.payload);S&&(o?.hasOwnProperty("profile-level-id")&&(o["profile-level-id"]=String(o["profile-level-id"])),S.parameters=o)}for(const n of m.rtcpFb??[]){const o={type:n.type,parameter:n.subtype};if(o.parameter||delete o.parameter,n.payload!=="*"){const S=_.get(Number(n.payload));if(!S)continue;S.rtcpFeedback.push(o)}else for(const S of _.values())S.kind===r&&!/.+\/rtx$/i.test(S.mimeType)&&S.rtcpFeedback.push(o)}for(const n of m.ext??[]){if(n["encrypt-uri"])continue;const o={kind:r,uri:n.uri,preferredId:n.value};d.set(o.preferredId,o)}}return{codecs:Array.from(_.values()),headerExtensions:Array.from(d.values())}}function b({sdpObject:R}){let _=R.setup,d=R.fingerprint;if(!_||!d){const r=(R.media??[]).find(n=>n.port!==0);r&&(_??=r.setup,d??=r.fingerprint)}if(_){if(!d)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let T;switch(_){case"active":{T="client";break}case"passive":{T="server";break}case"actpass":{T="auto";break}}return{role:T,fingerprints:[{algorithm:d.type,value:d.hash}]}}function s({offerMediaObject:R}){const _=(R.ssrcs??[]).find(d=>d.attribute==="cname");return _?_.value:""}function k({offerRtpParameters:R,answerMediaObject:_}){for(const d of R.codecs){const T=d.mimeType.toLowerCase();if(T!=="audio/opus"||!(_.rtp??[]).find(o=>o.payload===d.payloadType))continue;_.fmtp=_.fmtp??[];let r=_.fmtp.find(o=>o.payload===d.payloadType);r||(r={payload:d.payloadType,config:""},_.fmtp.push(r));const n=v.parseParams(r.config);switch(T){case"audio/opus":{const o=d.parameters?.["sprop-stereo"];o!==void 0&&(n.stereo=Number(o)?1:0);break}}r.config="";for(const o of Object.keys(n))r.config&&(r.config+=";"),r.config+=`${o}=${n[o]}`}}return Z}var le={},It;function Se(){if(It)return le;It=1,Object.defineProperty(le,"__esModule",{value:!0}),le.getRtpEncodings=v,le.addLegacySimulcast=w;function v({offerMediaObject:b}){const s=new Set;for(const _ of b.ssrcs??[]){const d=_.id;d&&s.add(d)}if(s.size===0)throw new Error("no a=ssrc lines found");const k=new Map;for(const _ of b.ssrcGroups??[]){if(_.semantics!=="FID")continue;const d=_.ssrcs.split(/\s+/),T=Number(d[0]),m=Number(d[1]);s.has(T)&&(s.delete(T),s.delete(m),k.set(T,m))}for(const _ of s)k.set(_,void 0);const R=[];for(const[_,d]of k){const T={ssrc:_};d&&(T.rtx={ssrc:d}),R.push(T)}return R}function w({offerMediaObject:b,numStreams:s}){if(s<=1)throw new TypeError("numStreams must be greater than 1");const k=(b.ssrcs??[]).find(S=>S.attribute==="msid");if(!k)throw new Error("a=ssrc line with msid information not found");const[R,_]=k.value.split(" "),d=Number(k.id);let T;(b.ssrcGroups??[]).some(S=>{if(S.semantics!=="FID")return!1;const p=S.ssrcs.split(/\s+/);return Number(p[0])===d?(T=Number(p[1]),!0):!1});const m=(b.ssrcs??[]).find(S=>S.attribute==="cname");if(!m)throw new Error("a=ssrc line with cname information not found");const r=m.value,n=[],o=[];for(let S=0;S<s;++S)n.push(d+S),T&&o.push(T+S);b.ssrcGroups=[],b.ssrcs=[],b.ssrcGroups.push({semantics:"SIM",ssrcs:n.join(" ")});for(const S of n)b.ssrcs.push({id:S,attribute:"cname",value:r}),b.ssrcs.push({id:S,attribute:"msid",value:`${R} ${_}`});for(let S=0;S<o.length;++S){const p=n[S],e=o[S];b.ssrcs.push({id:e,attribute:"cname",value:r}),b.ssrcs.push({id:e,attribute:"msid",value:`${R} ${_}`}),b.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${e}`})}}return le}var Le={},Ft;function $e(){if(Ft)return Le;Ft=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.addNackSupportForOpus=v;function v(w){for(const b of w.codecs??[])(b.mimeType.toLowerCase()==="audio/opus"||b.mimeType.toLowerCase()==="audio/multiopus")&&!b.rtcpFeedback?.some(s=>s.type==="nack"&&!s.parameter)&&(b.rtcpFeedback||(b.rtcpFeedback=[]),b.rtcpFeedback.push({type:"nack"}))}return Le}var ue={},V={},Ot;function Rr(){if(Ot)return V;Ot=1,Object.defineProperty(V,"__esModule",{value:!0}),V.OfferMediaSection=V.AnswerMediaSection=V.MediaSection=void 0;const v=H(),w=X();let b=class{_mediaObject;constructor({iceParameters:d,iceCandidates:T,dtlsParameters:m}){if(this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},d&&this.setIceParameters(d),T){this._mediaObject.candidates=[];for(const r of T){const n={foundation:r.foundation,component:1,ip:r.address??r.ip,port:r.port,priority:r.priority,transport:r.protocol,type:r.type};r.tcpType&&(n.tcptype=r.tcpType),this._mediaObject.candidates.push(n)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}m&&this.setDtlsRole(m.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(d){this._mediaObject.iceUfrag=d.usernameFragment,this._mediaObject.icePwd=d.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};V.MediaSection=b;class s extends b{constructor({iceParameters:d,iceCandidates:T,dtlsParameters:m,sctpParameters:r,plainRtpParameters:n,offerMediaObject:o,offerRtpParameters:S,answerRtpParameters:p,codecOptions:e}){switch(super({iceParameters:d,iceCandidates:T,dtlsParameters:m}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const t of p.codecs){const a={payload:t.payloadType,codec:R(t),rate:t.clockRate};t.channels>1&&(a.encoding=t.channels),this._mediaObject.rtp.push(a);const c=w.clone(t.parameters)??{};let y=w.clone(t.rtcpFeedback)??[];if(e){const{opusStereo:l,opusFec:u,opusDtx:i,opusMaxPlaybackRate:f,opusMaxAverageBitrate:C,opusPtime:E,opusNack:L,videoGoogleStartBitrate:I,videoGoogleMaxBitrate:h,videoGoogleMinBitrate:x}=e,P=S.codecs.find(D=>D.payloadType===t.payloadType);switch(t.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{l!==void 0&&(P.parameters["sprop-stereo"]=l?1:0,c.stereo=l?1:0),u!==void 0&&(P.parameters.useinbandfec=u?1:0,c.useinbandfec=u?1:0),i!==void 0&&(P.parameters.usedtx=i?1:0,c.usedtx=i?1:0),f!==void 0&&(c.maxplaybackrate=f),C!==void 0&&(c.maxaveragebitrate=C),E!==void 0&&(P.parameters.ptime=E,c.ptime=E),L||(P.rtcpFeedback=P.rtcpFeedback.filter(D=>D.type!=="nack"||D.parameter),y=y.filter(D=>D.type!=="nack"||D.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{I!==void 0&&(c["x-google-start-bitrate"]=I),h!==void 0&&(c["x-google-max-bitrate"]=h),x!==void 0&&(c["x-google-min-bitrate"]=x);break}}}const g={payload:t.payloadType,config:""};for(const l of Object.keys(c))g.config&&(g.config+=";"),g.config+=`${l}=${c[l]}`;g.config&&this._mediaObject.fmtp.push(g);for(const l of y)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:l.type,subtype:l.parameter})}this._mediaObject.payloads=p.codecs.map(t=>t.payloadType).join(" "),this._mediaObject.ext=[];for(const t of p.headerExtensions)(o.ext??[]).some(c=>c.uri===t.uri)&&this._mediaObject.ext.push({uri:t.uri,value:t.id});if(o.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const t of o.rids??[])t.direction==="send"&&this._mediaObject.rids.push({id:t.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const t of o.rids??[])t.direction==="send"&&this._mediaObject.rids.push({id:t.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";break}case"application":{typeof o.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=r.port,this._mediaObject.maxMessageSize=r.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=String(r.port),this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:r.port,maxMessageSize:r.maxMessageSize});break}}}setDtlsRole(d){switch(d){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(d){if(!this._mediaObject.simulcast?.list1)return;const T={};for(const n of d)n.rid&&(T[n.rid]=n);const m=this._mediaObject.simulcast.list1,r=v.parseSimulcastStreamList(m);for(const n of r)for(const o of n)o.paused=!T[o.scid]?.active;this._mediaObject.simulcast.list1=r.map(n=>n.map(o=>`${o.paused?"~":""}${o.scid}`).join(",")).join(";")}}V.AnswerMediaSection=s;class k extends b{constructor({iceParameters:d,iceCandidates:T,dtlsParameters:m,sctpParameters:r,plainRtpParameters:n,mid:o,kind:S,offerRtpParameters:p,streamId:e,trackId:t}){switch(super({iceParameters:d,iceCandidates:T,dtlsParameters:m}),this._mediaObject.mid=String(o),this._mediaObject.type=S,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},r?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",S){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._mediaObject.msid=`${e??"-"} ${t}`;for(const g of p.codecs){const l={payload:g.payloadType,codec:R(g),rate:g.clockRate};g.channels>1&&(l.encoding=g.channels),this._mediaObject.rtp.push(l);const u={payload:g.payloadType,config:""};for(const i of Object.keys(g.parameters??{}))u.config&&(u.config+=";"),u.config+=`${i}=${g.parameters[i]}`;u.config&&this._mediaObject.fmtp.push(u);for(const i of g.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:g.payloadType,type:i.type,subtype:i.parameter})}this._mediaObject.payloads=p.codecs.map(g=>g.payloadType).join(" "),this._mediaObject.ext=[];for(const g of p.headerExtensions)this._mediaObject.ext.push({uri:g.uri,value:g.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const a=p.encodings[0],c=a.ssrc,y=a.rtx?.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c&&p.rtcp.cname&&this._mediaObject.ssrcs.push({id:c,attribute:"cname",value:p.rtcp.cname}),y&&(p.rtcp.cname&&this._mediaObject.ssrcs.push({id:y,attribute:"cname",value:p.rtcp.cname}),c&&this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${c} ${y}`}));break}case"application":{this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=r.port,this._mediaObject.maxMessageSize=r.maxMessageSize;break}}}setDtlsRole(d){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}}V.OfferMediaSection=k;function R(_){const T=new RegExp("^(audio|video)/(.+)","i").exec(_.mimeType);if(!T)throw new TypeError("invalid codec.mimeType");return T[2]}return V}var At;function Re(){if(At)return ue;At=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.RemoteSdp=void 0;const v=H(),w=$(),b=Rr(),s=["av1","h264"],k=new w.Logger("RemoteSdp");let R=class{_iceParameters;_iceCandidates;_dtlsParameters;_sctpParameters;_plainRtpParameters;_mediaSections=[];_midToIndex=new Map;_firstMid;_sdpObject;constructor({iceParameters:d,iceCandidates:T,dtlsParameters:m,sctpParameters:r,plainRtpParameters:n}){if(this._iceParameters=d,this._iceCandidates=T,this._dtlsParameters=m,this._sctpParameters=r,this._plainRtpParameters=n,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},this._sdpObject.iceOptions="ice2",d?.iceLite&&(this._sdpObject.icelite="ice-lite"),m){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const o=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:m.fingerprints[o-1].algorithm,hash:m.fingerprints[o-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(d){k.debug("updateIceParameters() [iceParameters:%o]",d),this._iceParameters=d,this._sdpObject.icelite=d.iceLite?"ice-lite":void 0;for(const T of this._mediaSections)T.setIceParameters(d)}updateDtlsRole(d){k.debug("updateDtlsRole() [role:%s]",d),this._dtlsParameters.role=d;for(const T of this._mediaSections)T.setDtlsRole(d)}setSessionExtmapAllowMixed(){k.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let d=0;d<this._mediaSections.length;++d){const T=this._mediaSections[d];if(T.closed)return{idx:d,reuseMid:T.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:d,reuseMid:T,offerRtpParameters:m,answerRtpParameters:r,codecOptions:n}){const o=new b.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:d,offerRtpParameters:m,answerRtpParameters:r,codecOptions:n}),S=o.getObject();S.rtp.find(e=>s.includes(e.codec.toLowerCase()))||(S.ext=S.ext?.filter(e=>e.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),T?this._replaceMediaSection(o,T):this._midToIndex.has(o.mid)?this._replaceMediaSection(o):this._addMediaSection(o)}receive({mid:d,kind:T,offerRtpParameters:m,streamId:r,trackId:n}){this.setSessionExtmapAllowMixed();const o=new b.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:d,kind:T,offerRtpParameters:m,streamId:r,trackId:n}),S=this._mediaSections.find(p=>p.closed);S?this._replaceMediaSection(o,S.mid):this._addMediaSection(o)}pauseMediaSection(d){this._findMediaSection(d).pause()}resumeSendingMediaSection(d){this._findMediaSection(d).resume()}resumeReceivingMediaSection(d){this._findMediaSection(d).resume()}disableMediaSection(d){this._findMediaSection(d).disable()}closeMediaSection(d){const T=this._findMediaSection(d);return d===this._firstMid?(k.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",d),this.disableMediaSection(d),!1):(T.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(d,T){const m=this._findMediaSection(d);m.muxSimulcastStreams(T),this._replaceMediaSection(m)}sendSctpAssociation({offerMediaObject:d}){const T=new b.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:d});this._addMediaSection(T)}receiveSctpAssociation(){const d=new b.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this._addMediaSection(d)}getSdp(){return this._sdpObject.origin.sessionVersion++,v.write(this._sdpObject)}_addMediaSection(d){this._firstMid||(this._firstMid=d.mid),this._mediaSections.push(d),this._midToIndex.set(d.mid,this._mediaSections.length-1),this._sdpObject.media.push(d.getObject()),this._regenerateBundleMids()}_replaceMediaSection(d,T){if(typeof T=="string"){const m=this._midToIndex.get(T);if(m===void 0)throw new Error(`no media section found for reuseMid '${T}'`);const r=this._mediaSections[m];this._mediaSections[m]=d,this._midToIndex.delete(r.mid),this._midToIndex.set(d.mid,m),this._sdpObject.media[m]=d.getObject(),this._regenerateBundleMids()}else{const m=this._midToIndex.get(d.mid);if(m===void 0)throw new Error(`no media section found with mid '${d.mid}'`);this._mediaSections[m]=d,this._sdpObject.media[m]=d.getObject()}}_findMediaSection(d){const T=this._midToIndex.get(d);if(T===void 0)throw new Error(`no media section found with mid '${d}'`);return this._mediaSections[T]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(d=>!d.closed).map(d=>d.mid).join(" "))}};return ue.RemoteSdp=R,ue}var Nt;function Er(){if(Nt)return pe;Nt=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.Chrome111=void 0;const v=H(),w=z(),b=$(),s=G(),k=U(),R=ee(),_=Ce(),d=Se(),T=$e(),m=Re(),r=new b.Logger("Chrome111"),n="Chrome111",o={OS:1024,MIS:1024};let S=class Ie extends w.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:n,factory:e=>new Ie(e),getNativeRtpCapabilities:async()=>{r.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const t=await e.createOffer();try{e.close()}catch{}e=void 0;const a=v.parse(t.sdp);return Ie.getLocalRtpCapabilities(a)}catch(t){try{e?.close()}catch{}throw e=void 0,t}},getNativeSctpCapabilities:async()=>(r.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e){const t=_.extractRtpCapabilities({sdpObject:e});return s.validateAndNormalizeRtpCapabilities(t),T.addNackSupportForOpus(t),t}constructor({direction:e,iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y,iceServers:g,iceTransportPolicy:l,additionalSettings:u,getSendExtendedRtpCapabilities:i}){super(),r.debug("constructor()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y}),this._getSendExtendedRtpCapabilities=i,c.role&&c.role!=="auto"&&(this._forcedLocalDtlsRole=c.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:g??[],iceTransportPolicy:l??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(r.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return n}close(){if(r.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),r.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),r.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});r.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const a={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:a,codec:c,onRtpSender:y}){if(this.assertNotClosed(),this.assertSendDirection(),r.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){let P=1;for(const D of t){const M=D.scalabilityMode?(0,R.parse)(D.scalabilityMode).temporalLayers:3;M>P&&(P=M)}t.forEach((D,M)=>{D.rid=`r${M}`,D.scalabilityMode=`L1T${P}`})}const g=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});y&&y(l.sender);const u=await this._pc.createOffer();let i=v.parse(u.sdp);i.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const f=Ie.getLocalRtpCapabilities(i),C=this._getSendExtendedRtpCapabilities(f),E=s.getSendingRtpParameters(e.kind,C);E.codecs=s.reduceCodecs(E.codecs,c);const L=s.getSendingRemoteRtpParameters(e.kind,C);L.codecs=s.reduceCodecs(L.codecs,c),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),r.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const I=l.mid;E.mid=I,i=v.parse(this._pc.localDescription.sdp);const h=i.media[g.idx];if(E.rtcp.cname=_.getCname({offerMediaObject:h}),!t)E.encodings=d.getRtpEncodings({offerMediaObject:h});else if(t.length===1){const P=d.getRtpEncodings({offerMediaObject:h});Object.assign(P[0],t[0]),E.encodings=P}else E.encodings=t;this._remoteSdp.send({offerMediaObject:h,reuseMid:g.reuseMid,offerRtpParameters:E,answerRtpParameters:L,codecOptions:a});const x={type:"answer",sdp:this._remoteSdp.getSdp()};return r.debug("send() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.set(I,l),{localId:I,rtpParameters:E,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),r.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const c=await this._pc.createOffer();r.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const y={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),r.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const a=await this._pc.createOffer();r.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const c={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),r.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const a=await this._pc.createOffer();r.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const c={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?r.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):r.debug("replaceTrack() [localId:%s, no track]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");await a.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),r.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");const c=a.sender.getParameters();c.encodings.forEach((l,u)=>{u<=t?l.active=!0:l.active=!1}),await a.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const y=await this._pc.createOffer();r.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const g={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),r.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");const c=a.sender.getParameters();c.encodings.forEach((l,u)=>{c.encodings[u]={...l,...t}}),await a.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const y=await this._pc.createOffer();r.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const g={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:c,protocol:y}){this.assertNotClosed(),this.assertSendDirection();const g={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:y};r.debug("sendDataChannel() [options:%o]",g);const l=this._pc.createDataChannel(c,g);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const i=await this._pc.createOffer(),f=v.parse(i.sdp),C=f.media.find(L=>L.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),r.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),this._remoteSdp.sendSctpAssociation({offerMediaObject:C});const E={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._hasDataChannelMediaSection=!0}const u={streamId:g.id,ordered:g.ordered,maxPacketLifeTime:g.maxPacketLifeTime,maxRetransmits:g.maxRetransmits};return{dataChannel:l,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],a=new Map;for(const l of e){const{trackId:u,kind:i,rtpParameters:f,streamId:C}=l;r.debug("receive() [trackId:%s, kind:%s]",u,i);const E=f.mid??String(this._mapMidTransceiver.size);a.set(u,E),this._remoteSdp.receive({mid:E,kind:i,offerRtpParameters:f,streamId:C??f.rtcp.cname,trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const l of e){const{trackId:u,onRtpReceiver:i}=l;if(i){const f=a.get(u),C=this._pc.getTransceivers().find(E=>E.mid===f);if(!C)throw new Error("transceiver not found");i(C.receiver)}}let y=await this._pc.createAnswer();const g=v.parse(y.sdp);for(const l of e){const{trackId:u,rtpParameters:i}=l,f=a.get(u),C=g.media.find(E=>String(E.mid)===f);_.applyCodecParameters({offerRtpParameters:i,answerMediaObject:C})}y={type:"answer",sdp:v.write(g)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),r.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const l of e){const{trackId:u}=l,i=a.get(u),f=this._pc.getTransceivers().find(C=>C.mid===i);if(f)this._mapMidTransceiver.set(i,f),t.push({localId:i,track:f.receiver.track,rtpReceiver:f.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){r.debug("stopReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){r.debug("pauseReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){r.debug("resumeReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:y,maxPacketLifeTime:g,maxRetransmits:l}=e,u={negotiated:!0,id:c,ordered:y,maxPacketLifeTime:g,maxRetransmits:l,protocol:a};r.debug("receiveDataChannel() [options:%o]",u);const i=this._pc.createDataChannel(t,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const f={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const C=await this._pc.createAnswer();if(!this._transportReady){const E=v.parse(C.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:E})}r.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setLocalDescription(C),this._hasDataChannelMediaSection=!0}return{dataChannel:i}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=v.parse(this._pc.localDescription.sdp));const a=_.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,y)=>{this.safeEmit("@connect",{dtlsParameters:a},c,y)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new k.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return pe.Chrome111=S,pe}var he={},jt;function Tr(){if(jt)return he;jt=1,Object.defineProperty(he,"__esModule",{value:!0}),he.Chrome74=void 0;const v=H(),w=$(),b=z(),s=G(),k=U(),R=ee(),_=Ce(),d=Se(),T=$e(),m=Re(),r=new w.Logger("Chrome74"),n="Chrome74",o={OS:1024,MIS:1024};let S=class Fe extends b.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:n,factory:e=>new Fe(e),getNativeRtpCapabilities:async()=>{r.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}e=void 0;const a=v.parse(t.sdp);return Fe.getLocalRtpCapabilities(a)}catch(t){try{e?.close()}catch{}throw e=void 0,t}},getNativeSctpCapabilities:async()=>(r.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e){const t=_.extractRtpCapabilities({sdpObject:e});return s.validateAndNormalizeRtpCapabilities(t),T.addNackSupportForOpus(t),t}constructor({direction:e,iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y,iceServers:g,iceTransportPolicy:l,additionalSettings:u,getSendExtendedRtpCapabilities:i}){super(),r.debug("constructor()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y}),this._getSendExtendedRtpCapabilities=i,c.role&&c.role!=="auto"&&(this._forcedLocalDtlsRole=c.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:g??[],iceTransportPolicy:l??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(r.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return n}close(){if(r.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),r.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),r.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});r.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const a={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:a,codec:c}){this.assertNotClosed(),this.assertSendDirection(),r.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((D,M)=>{D.rid=`r${M}`});const y=this._remoteSdp.getNextMediaSectionIdx(),g=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let l=await this._pc.createOffer(),u=v.parse(l.sdp);u.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const i=Fe.getLocalRtpCapabilities(u),f=this._getSendExtendedRtpCapabilities(i),C=s.getSendingRtpParameters(e.kind,f);C.codecs=s.reduceCodecs(C.codecs,c);const E=s.getSendingRemoteRtpParameters(e.kind,f);E.codecs=s.reduceCodecs(E.codecs,c),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u});let L=!1;const I=(0,R.parse)((t??[{}])[0].scalabilityMode);let h;t&&t.length===1&&I.spatialLayers>1&&C.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(r.debug("send() | enabling legacy simulcast for VP9 SVC"),L=!0,u=v.parse(l.sdp),h=u.media[y.idx],d.addLegacySimulcast({offerMediaObject:h,numStreams:I.spatialLayers}),l={type:"offer",sdp:v.write(u)}),r.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const x=g.mid;if(C.mid=x,u=v.parse(this._pc.localDescription.sdp),h=u.media[y.idx],C.rtcp.cname=_.getCname({offerMediaObject:h}),!t)C.encodings=d.getRtpEncodings({offerMediaObject:h});else if(t.length===1){let D=d.getRtpEncodings({offerMediaObject:h});Object.assign(D[0],t[0]),L&&(D=[D[0]]),C.encodings=D}else C.encodings=t;if(C.encodings.length>1&&(C.codecs[0].mimeType.toLowerCase()==="video/vp8"||C.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const D of C.encodings)D.scalabilityMode?D.scalabilityMode=`L1T${I.temporalLayers}`:D.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:h,reuseMid:y.reuseMid,offerRtpParameters:C,answerRtpParameters:E,codecOptions:a});const P={type:"answer",sdp:this._remoteSdp.getSdp()};return r.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._mapMidTransceiver.set(x,g),{localId:x,rtpParameters:C,rtpSender:g.sender}}async stopSending(e){if(this.assertSendDirection(),r.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const c=await this._pc.createOffer();r.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const y={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),r.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const a=await this._pc.createOffer();r.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const c={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),r.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const a=await this._pc.createOffer();r.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const c={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?r.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):r.debug("replaceTrack() [localId:%s, no track]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");await a.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),r.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");const c=a.sender.getParameters();c.encodings.forEach((l,u)=>{u<=t?l.active=!0:l.active=!1}),await a.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const y=await this._pc.createOffer();r.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const g={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),r.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");const c=a.sender.getParameters();c.encodings.forEach((l,u)=>{c.encodings[u]={...l,...t}}),await a.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const y=await this._pc.createOffer();r.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const g={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:c,protocol:y}){this.assertNotClosed(),this.assertSendDirection();const g={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:y};r.debug("sendDataChannel() [options:%o]",g);const l=this._pc.createDataChannel(c,g);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const i=await this._pc.createOffer(),f=v.parse(i.sdp),C=f.media.find(L=>L.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),r.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),this._remoteSdp.sendSctpAssociation({offerMediaObject:C});const E={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._hasDataChannelMediaSection=!0}const u={streamId:g.id,ordered:g.ordered,maxPacketLifeTime:g.maxPacketLifeTime,maxRetransmits:g.maxRetransmits};return{dataChannel:l,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],a=new Map;for(const l of e){const{trackId:u,kind:i,rtpParameters:f,streamId:C}=l;r.debug("receive() [trackId:%s, kind:%s]",u,i);const E=f.mid??String(this._mapMidTransceiver.size);a.set(u,E),this._remoteSdp.receive({mid:E,kind:i,offerRtpParameters:f,streamId:C??f.rtcp.cname,trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let y=await this._pc.createAnswer();const g=v.parse(y.sdp);for(const l of e){const{trackId:u,rtpParameters:i}=l,f=a.get(u),C=g.media.find(E=>String(E.mid)===f);_.applyCodecParameters({offerRtpParameters:i,answerMediaObject:C})}y={type:"answer",sdp:v.write(g)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),r.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const l of e){const{trackId:u}=l,i=a.get(u),f=this._pc.getTransceivers().find(C=>C.mid===i);if(f)this._mapMidTransceiver.set(i,f),t.push({localId:i,track:f.receiver.track,rtpReceiver:f.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){r.debug("stopReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){r.debug("pauseReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){r.debug("resumeReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:y,maxPacketLifeTime:g,maxRetransmits:l}=e,u={negotiated:!0,id:c,ordered:y,maxPacketLifeTime:g,maxRetransmits:l,protocol:a};r.debug("receiveDataChannel() [options:%o]",u);const i=this._pc.createDataChannel(t,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const f={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const C=await this._pc.createAnswer();if(!this._transportReady){const E=v.parse(C.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:E})}r.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setLocalDescription(C),this._hasDataChannelMediaSection=!0}return{dataChannel:i}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=v.parse(this._pc.localDescription.sdp));const a=_.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,y)=>{this.safeEmit("@connect",{dtlsParameters:a},c,y)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new k.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return he.Chrome74=S,he}var fe={},$t;function kr(){if($t)return fe;$t=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.Firefox120=void 0;const v=H(),w=z(),b=$(),s=U(),k=G(),R=ee(),_=Ce(),d=Se(),T=Re(),m=new b.Logger("Firefox120"),r="Firefox120",n={OS:16,MIS:2048};let o=class Oe extends w.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:r,factory:p=>new Oe(p),getNativeRtpCapabilities:async()=>{m.debug("getNativeRtpCapabilities()");let p=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const e=document.createElement("canvas");e.getContext("2d");const a=e.captureStream().getVideoTracks()[0];try{p.addTransceiver("audio",{direction:"sendrecv"}),p.addTransceiver(a,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const c=await p.createOffer();try{e.remove()}catch{}try{a.stop()}catch{}try{p.close()}catch{}p=void 0;const y=v.parse(c.sdp);return Oe.getLocalRtpCapabilities(y)}catch(c){try{e.remove()}catch{}try{a.stop()}catch{}try{p?.close()}catch{}throw p=void 0,c}},getNativeSctpCapabilities:async()=>(m.debug("getNativeSctpCapabilities()"),{numStreams:n})}}static getLocalRtpCapabilities(p){const e=_.extractRtpCapabilities({sdpObject:p});return k.validateAndNormalizeRtpCapabilities(e),e}constructor({direction:p,iceParameters:e,iceCandidates:t,dtlsParameters:a,sctpParameters:c,iceServers:y,iceTransportPolicy:g,additionalSettings:l,getSendExtendedRtpCapabilities:u}){super(),m.debug("constructor()"),this._direction=p,this._remoteSdp=new T.RemoteSdp({iceParameters:e,iceCandidates:t,dtlsParameters:a,sctpParameters:c}),this._getSendExtendedRtpCapabilities=u,this._pc=new RTCPeerConnection({iceServers:y??[],iceTransportPolicy:g??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...l}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return r}close(){if(m.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(p){throw this.assertNotClosed(),new s.UnsupportedError("not supported")}async restartIce(p){if(this.assertNotClosed(),m.debug("restartIce()"),this._remoteSdp.updateIceParameters(p),!!this._transportReady)if(this._direction==="send"){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:p,encodings:e,codecOptions:t,codec:a,onRtpSender:c}){this.assertNotClosed(),this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",p.kind,p.id),e&&e.length>1&&e.forEach((x,P)=>{x.rid=`r${P}`});const y=this._pc.addTransceiver(p,{direction:"sendonly",streams:[this._sendStream],sendEncodings:e});c&&c(y.sender);const g=await this._pc.createOffer();let l=v.parse(g.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const u=Oe.getLocalRtpCapabilities(l),i=this._getSendExtendedRtpCapabilities(u),f=k.getSendingRtpParameters(p.kind,i);f.codecs=k.reduceCodecs(f.codecs,a);const C=k.getSendingRemoteRtpParameters(p.kind,i);C.codecs=k.reduceCodecs(C.codecs,a),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l});const E=(0,R.parse)((e??[{}])[0].scalabilityMode);m.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const L=y.mid;f.mid=L,l=v.parse(this._pc.localDescription.sdp);const I=l.media[l.media.length-1];if(f.rtcp.cname=_.getCname({offerMediaObject:I}),!e)f.encodings=d.getRtpEncodings({offerMediaObject:I});else if(e.length===1){const x=d.getRtpEncodings({offerMediaObject:I});Object.assign(x[0],e[0]),f.encodings=x}else f.encodings=e;if(f.encodings.length>1&&(f.codecs[0].mimeType.toLowerCase()==="video/vp8"||f.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const x of f.encodings)x.scalabilityMode?x.scalabilityMode=`L1T${E.temporalLayers}`:x.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:I,offerRtpParameters:f,answerRtpParameters:C,codecOptions:t});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._mapMidTransceiver.set(L,y),{localId:L,rtpParameters:f,rtpSender:y.sender}}async stopSending(p){if(this.assertSendDirection(),m.debug("stopSending() [localId:%s]",p),this._closed)return;const e=this._mapMidTransceiver.get(p);if(!e)throw new Error("associated transceiver not found");e.sender.replaceTrack(null),this._pc.removeTrack(e.sender),this._remoteSdp.disableMediaSection(e.mid);const t=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(p)}async pauseSending(p){this.assertNotClosed(),this.assertSendDirection(),m.debug("pauseSending() [localId:%s]",p);const e=this._mapMidTransceiver.get(p);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(p);const t=await this._pc.createOffer();m.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(p){this.assertNotClosed(),this.assertSendDirection(),m.debug("resumeSending() [localId:%s]",p);const e=this._mapMidTransceiver.get(p);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(p);const t=await this._pc.createOffer();m.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(p,e){this.assertNotClosed(),this.assertSendDirection(),e?m.debug("replaceTrack() [localId:%s, track.id:%s]",p,e.id):m.debug("replaceTrack() [localId:%s, no track]",p);const t=this._mapMidTransceiver.get(p);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(e)}async setMaxSpatialLayer(p,e){this.assertNotClosed(),this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",p,e);const t=this._mapMidTransceiver.get(p);if(!t)throw new Error("associated transceiver not found");const a=t.sender.getParameters();a.encodings.forEach((g,l)=>{l<=e?g.active=!0:g.active=!1}),await t.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(p,a.encodings);const c=await this._pc.createOffer();m.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const y={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async setRtpEncodingParameters(p,e){this.assertNotClosed(),this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",p,e);const t=this._mapMidTransceiver.get(p);if(!t)throw new Error("associated RTCRtpTransceiver not found");const a=t.sender.getParameters();a.encodings.forEach((g,l)=>{a.encodings[l]={...g,...e}}),await t.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(p,a.encodings);const c=await this._pc.createOffer();m.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const y={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async getSenderStats(p){this.assertNotClosed(),this.assertSendDirection();const e=this._mapMidTransceiver.get(p);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.sender.getStats()}async sendDataChannel({ordered:p,maxPacketLifeTime:e,maxRetransmits:t,label:a,protocol:c}){this.assertNotClosed(),this.assertSendDirection();const y={negotiated:!0,id:this._nextSendSctpStreamId,ordered:p,maxPacketLifeTime:e,maxRetransmits:t,protocol:c};m.debug("sendDataChannel() [options:%o]",y);const g=this._pc.createDataChannel(a,y);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%n.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),i=v.parse(u.sdp),f=i.media.find(E=>E.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:i}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:f});const C={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setRemoteDescription(C),this._hasDataChannelMediaSection=!0}const l={streamId:y.id,ordered:y.ordered,maxPacketLifeTime:y.maxPacketLifeTime,maxRetransmits:y.maxRetransmits};return{dataChannel:g,sctpStreamParameters:l}}async receive(p){this.assertNotClosed(),this.assertRecvDirection();const e=[],t=new Map;for(const g of p){const{trackId:l,kind:u,rtpParameters:i,streamId:f}=g;m.debug("receive() [trackId:%s, kind:%s]",l,u);const C=i.mid??String(this._mapMidTransceiver.size);t.set(l,C),this._remoteSdp.receive({mid:C,kind:u,offerRtpParameters:i,streamId:f??i.rtcp.cname,trackId:l})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);for(const g of p){const{trackId:l,onRtpReceiver:u}=g;if(u){const i=t.get(l),f=this._pc.getTransceivers().find(C=>C.mid===i);if(!f)throw new Error("transceiver not found");u(f.receiver)}}let c=await this._pc.createAnswer();const y=v.parse(c.sdp);for(const g of p){const{trackId:l,rtpParameters:u}=g,i=t.get(l),f=y.media.find(C=>String(C.mid)===i);_.applyCodecParameters({offerRtpParameters:u,answerMediaObject:f}),c={type:"answer",sdp:v.write(y)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:y}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const g of p){const{trackId:l}=g,u=t.get(l),i=this._pc.getTransceivers().find(f=>f.mid===u);if(!i)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(u,i),e.push({localId:u,track:i.receiver.track,rtpReceiver:i.receiver})}return e}async stopReceiving(p){if(this.assertRecvDirection(),this._closed)return;for(const a of p){m.debug("stopReceiving() [localId:%s]",a);const c=this._mapMidTransceiver.get(a);if(!c)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(c.mid)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const a of p)this._mapMidTransceiver.delete(a)}async pauseReceiving(p){this.assertNotClosed(),this.assertRecvDirection();for(const a of p){m.debug("pauseReceiving() [localId:%s]",a);const c=this._mapMidTransceiver.get(a);if(!c)throw new Error("associated RTCRtpTransceiver not found");c.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async resumeReceiving(p){this.assertNotClosed(),this.assertRecvDirection();for(const a of p){m.debug("resumeReceiving() [localId:%s]",a);const c=this._mapMidTransceiver.get(a);if(!c)throw new Error("associated RTCRtpTransceiver not found");c.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async getReceiverStats(p){this.assertRecvDirection();const e=this._mapMidTransceiver.get(p);if(!e)throw new Error("associated RTCRtpTransceiver not found");return e.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:p,label:e,protocol:t}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:c,maxPacketLifeTime:y,maxRetransmits:g}=p,l={negotiated:!0,id:a,ordered:c,maxPacketLifeTime:y,maxRetransmits:g,protocol:t};m.debug("receiveDataChannel() [options:%o]",l);const u=this._pc.createDataChannel(e,l);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const f=await this._pc.createAnswer();if(!this._transportReady){const C=v.parse(f.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:C})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setLocalDescription(f),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:p,localSdpObject:e}){e||(e=v.parse(this._pc.localDescription.sdp));const t=_.extractDtlsParameters({sdpObject:e});t.role=p,this._remoteSdp.updateDtlsRole(p==="client"?"server":"client"),await new Promise((a,c)=>{this.safeEmit("@connect",{dtlsParameters:t},a,c)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=p=>{this.emit("@icecandidateerror",p)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new s.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return fe.Firefox120=o,fe}var me={},zt;function Dr(){if(zt)return me;zt=1,Object.defineProperty(me,"__esModule",{value:!0}),me.Safari12=void 0;const v=H(),w=z(),b=$(),s=G(),k=U(),R=ee(),_=Re(),d=Ce(),T=Se(),m=$e(),r=new b.Logger("Safari12"),n="Safari12",o={OS:1024,MIS:1024};let S=class Ae extends w.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:n,factory:e=>new Ae(e),getNativeRtpCapabilities:async()=>{r.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}e=void 0;const a=v.parse(t.sdp);return Ae.getLocalRtpCapabilities(a)}catch(t){try{e?.close()}catch{}throw e=void 0,t}},getNativeSctpCapabilities:async()=>(r.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e){const t=d.extractRtpCapabilities({sdpObject:e});return s.validateAndNormalizeRtpCapabilities(t),m.addNackSupportForOpus(t),t}constructor({direction:e,iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y,iceServers:g,iceTransportPolicy:l,additionalSettings:u,getSendExtendedRtpCapabilities:i}){super(),r.debug("constructor()"),this._direction=e,this._remoteSdp=new _.RemoteSdp({iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y}),this._getSendExtendedRtpCapabilities=i,c.role&&c.role!=="auto"&&(this._forcedLocalDtlsRole=c.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:g??[],iceTransportPolicy:l??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",f=>{this.emit("@icecandidateerror",f)}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(r.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return n}close(){if(r.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),r.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),r.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});r.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const a={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:a,codec:c,onRtpSender:y}){this.assertNotClosed(),this.assertSendDirection(),r.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const g=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});y&&y(l.sender);let u=await this._pc.createOffer(),i=v.parse(u.sdp);i.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const f=Ae.getLocalRtpCapabilities(i),C=this._getSendExtendedRtpCapabilities(f),E=s.getSendingRtpParameters(e.kind,C);E.codecs=s.reduceCodecs(E.codecs,c);const L=s.getSendingRemoteRtpParameters(e.kind,C);L.codecs=s.reduceCodecs(L.codecs,c);let I;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i});const h=(0,R.parse)((t??[{}])[0].scalabilityMode);t&&t.length>1&&(r.debug("send() | enabling legacy simulcast"),i=v.parse(u.sdp),I=i.media[g.idx],T.addLegacySimulcast({offerMediaObject:I,numStreams:t.length}),u={type:"offer",sdp:v.write(i)}),r.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const x=l.mid;if(E.mid=x,i=v.parse(this._pc.localDescription.sdp),I=i.media[g.idx],E.rtcp.cname=d.getCname({offerMediaObject:I}),E.encodings=T.getRtpEncodings({offerMediaObject:I}),t)for(let D=0;D<E.encodings.length;++D)t[D]&&Object.assign(E.encodings[D],t[D]);if(E.encodings.length>1&&(E.codecs[0].mimeType.toLowerCase()==="video/vp8"||E.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const D of E.encodings)D.scalabilityMode?D.scalabilityMode=`L1T${h.temporalLayers}`:D.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:I,reuseMid:g.reuseMid,offerRtpParameters:E,answerRtpParameters:L,codecOptions:a});const P={type:"answer",sdp:this._remoteSdp.getSdp()};return r.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._mapMidTransceiver.set(x,l),{localId:x,rtpParameters:E,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;r.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const c=await this._pc.createOffer();r.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const y={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),r.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const a=await this._pc.createOffer();r.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const c={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),r.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const a=await this._pc.createOffer();r.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const c={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?r.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):r.debug("replaceTrack() [localId:%s, no track]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");await a.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),r.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");const c=a.sender.getParameters();c.encodings.forEach((l,u)=>{u<=t?l.active=!0:l.active=!1}),await a.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const y=await this._pc.createOffer();r.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const g={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),r.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");const c=a.sender.getParameters();c.encodings.forEach((l,u)=>{c.encodings[u]={...l,...t}}),await a.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const y=await this._pc.createOffer();r.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const g={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:c,protocol:y}){this.assertNotClosed(),this.assertSendDirection();const g={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:y};r.debug("sendDataChannel() [options:%o]",g);const l=this._pc.createDataChannel(c,g);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const i=await this._pc.createOffer(),f=v.parse(i.sdp),C=f.media.find(L=>L.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),r.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),this._remoteSdp.sendSctpAssociation({offerMediaObject:C});const E={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._hasDataChannelMediaSection=!0}const u={streamId:g.id,ordered:g.ordered,maxPacketLifeTime:g.maxPacketLifeTime,maxRetransmits:g.maxRetransmits};return{dataChannel:l,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],a=new Map;for(const l of e){const{trackId:u,kind:i,rtpParameters:f,streamId:C}=l;r.debug("receive() [trackId:%s, kind:%s]",u,i);const E=f.mid??String(this._mapMidTransceiver.size);a.set(u,E),this._remoteSdp.receive({mid:E,kind:i,offerRtpParameters:f,streamId:C??f.rtcp.cname,trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const l of e){const{trackId:u,onRtpReceiver:i}=l;if(i){const f=a.get(u),C=this._pc.getTransceivers().find(E=>E.mid===f);if(!C)throw new Error("transceiver not found");i(C.receiver)}}let y=await this._pc.createAnswer();const g=v.parse(y.sdp);for(const l of e){const{trackId:u,rtpParameters:i}=l,f=a.get(u),C=g.media.find(E=>String(E.mid)===f);d.applyCodecParameters({offerRtpParameters:i,answerMediaObject:C})}y={type:"answer",sdp:v.write(g)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),r.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const l of e){const{trackId:u}=l,i=a.get(u),f=this._pc.getTransceivers().find(C=>C.mid===i);if(!f)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(i,f),t.push({localId:i,track:f.receiver.track,rtpReceiver:f.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){r.debug("stopReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){r.debug("pauseReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){r.debug("resumeReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:y,maxPacketLifeTime:g,maxRetransmits:l}=e,u={negotiated:!0,id:c,ordered:y,maxPacketLifeTime:g,maxRetransmits:l,protocol:a};r.debug("receiveDataChannel() [options:%o]",u);const i=this._pc.createDataChannel(t,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const f={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const C=await this._pc.createAnswer();if(!this._transportReady){const E=v.parse(C.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:E})}r.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setLocalDescription(C),this._hasDataChannelMediaSection=!0}return{dataChannel:i}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=v.parse(this._pc.localDescription.sdp));const a=d.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,y)=>{this.safeEmit("@connect",{dtlsParameters:a},c,y)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new k.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return me.Safari12=S,me}var ge={},qt;function xr(){if(qt)return ge;qt=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.ReactNative106=void 0;const v=H(),w=z(),b=$(),s=G(),k=U(),R=ee(),_=Re(),d=Ce(),T=Se(),m=$e(),r=new b.Logger("ReactNative106"),n="ReactNative106",o={OS:1024,MIS:1024};let S=class Ne extends w.EnhancedEventEmitter{_closed=!1;_direction;_remoteSdp;_getSendExtendedRtpCapabilities;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return{name:n,factory:e=>new Ne(e),getNativeRtpCapabilities:async()=>{r.debug("getNativeRtpCapabilities()");let e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch{}e=void 0;const a=v.parse(t.sdp);return Ne.getLocalRtpCapabilities(a)}catch(t){try{e?.close()}catch{}throw e=void 0,t}},getNativeSctpCapabilities:async()=>(r.debug("getNativeSctpCapabilities()"),{numStreams:o})}}static getLocalRtpCapabilities(e){const t=d.extractRtpCapabilities({sdpObject:e});return s.validateAndNormalizeRtpCapabilities(t),m.addNackSupportForOpus(t),t}constructor({direction:e,iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y,iceServers:g,iceTransportPolicy:l,additionalSettings:u,getSendExtendedRtpCapabilities:i}){super(),r.debug("constructor()"),this._direction=e,this._remoteSdp=new _.RemoteSdp({iceParameters:t,iceCandidates:a,dtlsParameters:c,sctpParameters:y}),this._getSendExtendedRtpCapabilities=i,c.role&&c.role!=="auto"&&(this._forcedLocalDtlsRole=c.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:g??[],iceTransportPolicy:l??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(r.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}get name(){return n}close(){if(r.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}async updateIceServers(e){this.assertNotClosed(),r.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),r.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});r.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const a={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:a,codec:c,onRtpSender:y}){this.assertNotClosed(),this.assertSendDirection(),r.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((M,F)=>{M.rid=`r${F}`});const g=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});y&&y(l.sender);let u=await this._pc.createOffer(),i=v.parse(u.sdp);i.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const f=Ne.getLocalRtpCapabilities(i),C=this._getSendExtendedRtpCapabilities(f),E=s.getSendingRtpParameters(e.kind,C);E.codecs=s.reduceCodecs(E.codecs,c);const L=s.getSendingRemoteRtpParameters(e.kind,C);L.codecs=s.reduceCodecs(L.codecs,c),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i});let I=!1;const h=(0,R.parse)((t??[{}])[0].scalabilityMode);let x;t&&t.length===1&&h.spatialLayers>1&&E.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(r.debug("send() | enabling legacy simulcast for VP9 SVC"),I=!0,i=v.parse(u.sdp),x=i.media[g.idx],T.addLegacySimulcast({offerMediaObject:x,numStreams:h.spatialLayers}),u={type:"offer",sdp:v.write(i)}),r.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);let P=l.mid??void 0;if(P||r.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),E.mid=P,i=v.parse(this._pc.localDescription.sdp),x=i.media[g.idx],E.rtcp.cname=d.getCname({offerMediaObject:x}),!t)E.encodings=T.getRtpEncodings({offerMediaObject:x});else if(t.length===1){let M=T.getRtpEncodings({offerMediaObject:x});Object.assign(M[0],t[0]),I&&(M=[M[0]]),E.encodings=M}else E.encodings=t;if(E.encodings.length>1&&(E.codecs[0].mimeType.toLowerCase()==="video/vp8"||E.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const M of E.encodings)M.scalabilityMode?M.scalabilityMode=`L1T${h.temporalLayers}`:M.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:x,reuseMid:g.reuseMid,offerRtpParameters:E,answerRtpParameters:L,codecOptions:a});const D={type:"answer",sdp:this._remoteSdp.getSdp()};return r.debug("send() | calling pc.setRemoteDescription() [answer:%o]",D),await this._pc.setRemoteDescription(D),P||(P=l.mid,E.mid=P),this._mapMidTransceiver.set(P,l),{localId:P,rtpParameters:E,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;r.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch{}const c=await this._pc.createOffer();r.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const y={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),r.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const a=await this._pc.createOffer();r.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const c={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),r.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const a=await this._pc.createOffer();r.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const c={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?r.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):r.debug("replaceTrack() [localId:%s, no track]",e);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");await a.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),r.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");const c=a.sender.getParameters();c.encodings.forEach((l,u)=>{u<=t?l.active=!0:l.active=!1}),await a.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const y=await this._pc.createOffer();r.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const g={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),r.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const a=this._mapMidTransceiver.get(e);if(!a)throw new Error("associated RTCRtpTransceiver not found");const c=a.sender.getParameters();c.encodings.forEach((l,u)=>{c.encodings[u]={...l,...t}}),await a.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(e,c.encodings);const y=await this._pc.createOffer();r.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const g={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:c,protocol:y}){this.assertNotClosed(),this.assertSendDirection();const g={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:y};r.debug("sendDataChannel() [options:%o]",g);const l=this._pc.createDataChannel(c,g);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%o.MIS,!this._hasDataChannelMediaSection){const i=await this._pc.createOffer(),f=v.parse(i.sdp),C=f.media.find(L=>L.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),r.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),this._remoteSdp.sendSctpAssociation({offerMediaObject:C});const E={type:"answer",sdp:this._remoteSdp.getSdp()};r.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._hasDataChannelMediaSection=!0}const u={streamId:g.id,ordered:g.ordered,maxPacketLifeTime:g.maxPacketLifeTime,maxRetransmits:g.maxRetransmits};return{dataChannel:l,sctpStreamParameters:u}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],a=new Map;for(const l of e){const{trackId:u,kind:i,rtpParameters:f,streamId:C}=l;r.debug("receive() [trackId:%s, kind:%s]",u,i);const E=f.mid??String(this._mapMidTransceiver.size);a.set(u,E),this._remoteSdp.receive({mid:E,kind:i,offerRtpParameters:f,streamId:C??f.rtcp.cname,trackId:u})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const l of e){const{trackId:u,onRtpReceiver:i}=l;if(i){const f=a.get(u),C=this._pc.getTransceivers().find(E=>E.mid===f);if(!C)throw new Error("transceiver not found");i(C.receiver)}}let y=await this._pc.createAnswer();const g=v.parse(y.sdp);for(const l of e){const{trackId:u,rtpParameters:i}=l,f=a.get(u),C=g.media.find(E=>String(E.mid)===f);d.applyCodecParameters({offerRtpParameters:i,answerMediaObject:C})}y={type:"answer",sdp:v.write(g)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),r.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const l of e){const{trackId:u}=l,i=a.get(u),f=this._pc.getTransceivers().find(C=>C.mid===i);if(f)this._mapMidTransceiver.set(i,f),t.push({localId:i,track:f.receiver.track,rtpReceiver:f.receiver});else throw new Error("new RTCRtpTransceiver not found")}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const c of e){r.debug("stopReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of e)this._mapMidTransceiver.delete(c)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){r.debug("pauseReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const c of e){r.debug("resumeReceiving() [localId:%s]",c);const y=this._mapMidTransceiver.get(c);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const a=await this._pc.createAnswer();r.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:y,maxPacketLifeTime:g,maxRetransmits:l}=e,u={negotiated:!0,id:c,ordered:y,maxPacketLifeTime:g,maxRetransmits:l,protocol:a};r.debug("receiveDataChannel() [options:%o]",u);const i=this._pc.createDataChannel(t,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const f={type:"offer",sdp:this._remoteSdp.getSdp()};r.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const C=await this._pc.createAnswer();if(!this._transportReady){const E=v.parse(C.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:E})}r.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",C),await this._pc.setLocalDescription(C),this._hasDataChannelMediaSection=!0}return{dataChannel:i}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=v.parse(this._pc.localDescription.sdp));const a=d.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole(e==="client"?"server":"client"),await new Promise((c,y)=>{this.safeEmit("@connect",{dtlsParameters:a},c,y)}),this._transportReady=!0}onIceGatheringStateChange=()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)};onIceCandidateError=e=>{this.emit("@icecandidateerror",e)};onConnectionStateChange=()=>{this.emit("@connectionstatechange",this._pc.connectionState)};onIceConnectionStateChange=()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}};assertNotClosed(){if(this._closed)throw new k.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ge.ReactNative106=S,ge}var Bt;function Pr(){if(Bt)return Q;Bt=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.Device=void 0,Q.detectDevice=o,Q.detectDeviceAsync=S;const v=$(),w=z(),b=U(),s=X(),k=G(),R=yr(),_=Er(),d=Tr(),T=kr(),m=Dr(),r=xr(),n=new v.Logger("Device");function o(u,i){return n.debug("detectDevice()"),!u&&typeof navigator=="object"&&(u=navigator.userAgent),!i&&typeof navigator=="object"&&(i=navigator.userAgentData),e(u,i)}async function S(u,i){return n.debug("detectDeviceAsync()"),!u&&typeof navigator=="object"&&(u=navigator.userAgent),!i&&typeof navigator=="object"&&(i=navigator.userAgentData),e(u,i)}let p=class er{_handlerFactory;_handlerName;_loaded=!1;_getSendExtendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind={audio:!1,video:!1};_sctpCapabilities;_observer=new w.EnhancedEventEmitter;static async factory({handlerName:i,handlerFactory:f}={}){if(n.debug("factory()"),i&&f)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!i&&!f&&(i=await S(),!i))throw new b.UnsupportedError("device not supported");return new er({handlerName:i,handlerFactory:f})}constructor({handlerName:i,handlerFactory:f}={}){if(n.debug("constructor()"),i&&f)throw new TypeError("just one of handlerName or handlerInterface can be given");if(f)this._handlerFactory=f;else{if(i)n.debug("constructor() | handler given: %s",i);else if(i=o(),i)n.debug("constructor() | detected handler: %s",i);else throw new b.UnsupportedError("device not supported");switch(i){case"Chrome111":{this._handlerFactory=_.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=d.Chrome74.createFactory();break}case"Firefox120":{this._handlerFactory=T.Firefox120.createFactory();break}case"Safari12":{this._handlerFactory=m.Safari12.createFactory();break}case"ReactNative106":{this._handlerFactory=r.ReactNative106.createFactory();break}default:throw new TypeError(`unknown handlerName "${i}"`)}}this._handlerName=this._handlerFactory.name}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new b.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new b.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:i,preferLocalCodecsOrder:f=!1}){if(n.debug("load() [routerRtpCapabilities:%o]",i),this._loaded)throw new b.InvalidStateError("already loaded");const C=s.clone(i);k.validateAndNormalizeRtpCapabilities(C);const{getNativeRtpCapabilities:E,getNativeSctpCapabilities:L}=this._handlerFactory,I=s.clone(await E());k.validateAndNormalizeRtpCapabilities(I),n.debug("load() | got native RTP capabilities:%o",I),this._getSendExtendedRtpCapabilities=x=>s.clone(k.getExtendedRtpCapabilities(x,C,f));const h=k.getExtendedRtpCapabilities(I,C,!1);this._recvRtpCapabilities=k.getRecvRtpCapabilities(h),k.validateAndNormalizeRtpCapabilities(this._recvRtpCapabilities),n.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=k.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=k.canSend("video",this._recvRtpCapabilities),this._sctpCapabilities=await L(),k.validateSctpCapabilities(this._sctpCapabilities),n.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),n.debug("load() succeeded"),this._loaded=!0}canProduce(i){if(this._loaded){if(i!=="audio"&&i!=="video")throw new TypeError(`invalid kind "${i}"`)}else throw new b.InvalidStateError("not loaded");return this._canProduceByKind[i]}createSendTransport({id:i,iceParameters:f,iceCandidates:C,dtlsParameters:E,sctpParameters:L,iceServers:I,iceTransportPolicy:h,additionalSettings:x,appData:P}){return n.debug("createSendTransport()"),this.createTransport({direction:"send",id:i,iceParameters:f,iceCandidates:C,dtlsParameters:E,sctpParameters:L,iceServers:I,iceTransportPolicy:h,additionalSettings:x,appData:P})}createRecvTransport({id:i,iceParameters:f,iceCandidates:C,dtlsParameters:E,sctpParameters:L,iceServers:I,iceTransportPolicy:h,additionalSettings:x,appData:P}){return n.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:i,iceParameters:f,iceCandidates:C,dtlsParameters:E,sctpParameters:L,iceServers:I,iceTransportPolicy:h,additionalSettings:x,appData:P})}createTransport({direction:i,id:f,iceParameters:C,iceCandidates:E,dtlsParameters:L,sctpParameters:I,iceServers:h,iceTransportPolicy:x,additionalSettings:P,appData:D}){if(this._loaded){if(typeof f!="string")throw new TypeError("missing id");if(typeof C!="object")throw new TypeError("missing iceParameters");if(Array.isArray(E)){if(typeof L!="object")throw new TypeError("missing dtlsParameters");if(I&&typeof I!="object")throw new TypeError("wrong sctpParameters");if(D&&typeof D!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new b.InvalidStateError("not loaded");const M=new R.Transport({direction:i,id:f,iceParameters:C,iceCandidates:E,dtlsParameters:L,sctpParameters:I,iceServers:h,iceTransportPolicy:x,additionalSettings:P,appData:D,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",M),M}};Q.Device=p;function e(u,i){n.debug('detectDeviceImpl() [userAgent:"%s", userAgentData:%o]',u,i);const f=t(u,i);if(f){if(f>=111)return n.debug("detectDeviceImpl() | using Chrome111 handler"),"Chrome111";if(f>=74)return n.debug("detectDeviceImpl() | using Chrome74 handler"),"Chrome74";n.warn("detectDeviceImpl() | unsupported Chromium based browser/version");return}const C=a(u);if(C){if(C>=120)return n.debug("detectDeviceImpl() | using Firefox120 handler"),"Firefox120";n.warn("detectDeviceImpl() | unsupported Firefox browser/version");return}const E=c(u);if(E){if(E>=605)return n.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";n.warn("detectDeviceImpl() | unsupported desktop Safari browser/version");return}const L=y(u);if(L){if(L>=605)return n.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12";n.warn("detectDeviceImpl() | unsupported iOS Safari based browser/version");return}if(l()){if(typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u")return n.debug("detectDeviceImpl() | using ReactNative106 handler"),"ReactNative106";n.warn("detectDeviceImpl() | unsupported react-native-webrtc version without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?");return}n.warn('detectDeviceImpl() | device not supported [userAgent:"%s", userAgentData:%o]',u,i)}function t(u,i){if(g(u,i)){n.debug("getChromiumMajorVersion() | this is iOS => undefined");return}if(l()){n.debug("getChromiumMajorVersion() | this is React-Native => undefined");return}if(i){const C=i.brands.find(E=>E.brand==="Chromium");if(C){const E=Number(C.version);return n.debug(`getChromiumMajorVersion() | Chromium major version based on NavigatorUAData => ${E}`),E}}const f=u?.match(/\b(?:Chrome|Chromium)\/(\w+)/i);if(f?.[1]){const C=Number(f[1]);return n.debug(`getChromiumMajorVersion() | Chromium major version based on User-Agent => ${C}`),C}n.debug("getChromiumMajorVersion() | this is not Chromium => undefined")}function a(u){if(g(u)){n.debug("getFirefoxMajorVersion() | this is iOS => undefined");return}if(l()){n.debug("getFirefoxMajorVersion() | this is React-Native => undefined");return}const i=u?.match(/\bFirefox\/(\w+)/i);if(i?.[1]){const f=Number(i[1]);return n.debug(`getFirefoxMajorVersion() | Firefox major version based on User-Agent => ${f}`),f}n.debug("getFirefoxMajorVersion() | this is not Firefox => undefined")}function c(u){if(g(u)){n.debug("getMacOSWebKitMajorVersion() | this is iOS => undefined");return}if(l()){n.debug("getMacOSWebKitMajorVersion() | this is React-Native => undefined");return}if(!(u&&/\bSafari\b/i.test(u)&&!/\bChrome\b/i.test(u)&&!/\bChromium\b/i.test(u)&&!/\bFirefox\b/i.test(u))){n.debug("getMacOSWebKitMajorVersion() | this is not Safari => undefined");return}const f=u.match(/AppleWebKit\/(\w+)/i);if(f?.[1]){const C=Number(f[1]);return n.debug(`getMacOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${C}`),C}n.debug("getMacOSWebKitMajorVersion() | this is not WebKit => undefined")}function y(u){if(!g(u)){n.debug("getIOSWebKitMajorVersion() | this is not iOS => undefined");return}if(l()){n.debug("getIOSWebKitMajorVersion() | this is React-Native => undefined");return}const i=u?.match(/AppleWebKit\/(\w+)/i);if(i?.[1]){const f=Number(i[1]);return n.debug(`getIOSWebKitMajorVersion() | WebKit major version based on User-Agent => ${f}`),f}n.debug("getIOSWebKitMajorVersion() | this is not WebKit => undefined")}function g(u,i){return i?.platform==="iOS"?(n.debug("isIOS() | this is iOS based on NavigatorUAData.platform => true"),!0):i?.platform?(n.debug("isIOS() | this is not iOS based on NavigatorUAData.platform => false"),!1):u&&/iPad|iPhone|iPod/.test(u)?(n.debug("isIOS() | this is iOS based on User-Agent => true"),!0):typeof navigator=="object"&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?(n.debug("isIOS() | this is iPadOS 13+ based on User-Agent => true"),!0):(n.debug("isIOS() | this is not iOS => false"),!1)}function l(){return typeof navigator=="object"&&navigator.product==="ReactNative"?(n.debug("isReactNative() | this is React-Native based on navigator.product"),!0):(n.debug("isReactNative() | this is not React-Native => false"),!1)}return Q}var _e={},ve={},Ye={},Ut;function Lr(){if(Ut)return Ye;Ut=1;for(var v=256,w=[],b;v--;)w[v]=(v+256).toString(16).substring(1);function s(){var k=0,R,_="";if(!b||v+16>256){for(b=Array(k=256);k--;)b[k]=256*Math.random()|0;k=v=0}for(;k<16;k++)R=b[v+k],k==6?_+=w[R&15|64]:k==8?_+=w[R&63|128]:_+=w[R],k&1&&k>1&&k<11&&(_+="-");return v++,_}return Ye.v4=s,Ye}var we={},Vt;function Mr(){if(Vt)return we;Vt=1,Object.defineProperty(we,"__esModule",{value:!0}),we.FakeEventTarget=void 0;class v{listeners={};addEventListener(b,s,k){s&&(this.listeners[b]??=[],this.listeners[b].push({callback:typeof s=="function"?s:s.handleEvent,once:typeof k=="object"&&k.once===!0}))}removeEventListener(b,s,k){this.listeners[b]&&s&&(this.listeners[b]=this.listeners[b].filter(R=>R.callback!==(typeof s=="function"?s:s.handleEvent)))}dispatchEvent(b){if(!b||typeof b.type!="string")throw new Error("invalid event object");const s=this.listeners[b.type];if(!s)return!0;for(const k of[...s]){try{k.callback.call(this,b)}catch(R){setTimeout(()=>{throw R},0)}k.once&&this.removeEventListener(b.type,k.callback)}return!b.defaultPrevented}}return we.FakeEventTarget=v,we}var be={},Gt;function Ir(){if(Gt)return be;Gt=1,Object.defineProperty(be,"__esModule",{value:!0}),be.FakeEvent=void 0;let v=class{NONE=0;CAPTURING_PHASE=1;AT_TARGET=2;BUBBLING_PHASE=3;type;bubbles;cancelable;defaultPrevented=!1;composed=!1;currentTarget=null;eventPhase=this.NONE;isTrusted=!0;target=null;timeStamp=0;cancelBubble=!1;returnValue=!0;srcElement=null;constructor(b,s={}){this.type=b,this.bubbles=s.bubbles??!1,this.cancelable=s.cancelable??!1}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopPropagation(){}stopImmediatePropagation(){}composedPath(){return[]}initEvent(b,s,k){}};return be.FakeEvent=v,be}var Me={},Ht;function Fr(){if(Ht)return Me;Ht=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.clone=v;function v(w){if(w!==void 0)return Number.isNaN(w)?NaN:typeof structuredClone=="function"?structuredClone(w):JSON.parse(JSON.stringify(w))}return Me}var Qt;function Or(){if(Qt)return ve;Qt=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.FakeMediaStreamTrack=void 0;const v=Lr(),w=Mr(),b=Ir(),s=Fr();class k extends w.FakeEventTarget{#m;#l;#u;#e;#r;#t;#s;#h;#i;#f;#n;#a=null;#o=null;#c=null;#d=null;#p=null;constructor({kind:_,id:d,label:T,contentHint:m,enabled:r,muted:n,readyState:o,capabilities:S,constraints:p,settings:e,data:t}){super(),this.#m=d??(0,v.v4)(),this.#l=_,this.#u=T??"",this.#s=m??"",this.#r=r??!0,this.#t=n??!1,this.#e=o??"live",this.#h=S??{},this.#i=p??{},this.#f=e??{},this.#n=t??{}}get id(){return this.#m}get kind(){return this.#l}get label(){return this.#u}get contentHint(){return this.#s}set contentHint(_){this.#s=_}get enabled(){return this.#r}set enabled(_){const d=this.#r!==_;this.#r=_,d&&this.dispatchEvent(new b.FakeEvent("enabledchange"))}get muted(){return this.#t}get readyState(){return this.#e}get data(){return this.#n}set data(_){this.#n=_}get onmute(){return this.#a}set onmute(_){this.#a&&this.removeEventListener("mute",this.#a),this.#a=_,_&&this.addEventListener("mute",_)}get onunmute(){return this.#o}set onunmute(_){this.#o&&this.removeEventListener("unmute",this.#o),this.#o=_,_&&this.addEventListener("unmute",_)}get onended(){return this.#c}set onended(_){this.#c&&this.removeEventListener("ended",this.#c),this.#c=_,_&&this.addEventListener("ended",_)}get onenabledchange(){return this.#d}set onenabledchange(_){this.#d&&this.removeEventListener("enabledchange",this.#d),this.#d=_,_&&this.addEventListener("enabledchange",_)}get onstopped(){return this.#p}set onstopped(_){this.#p&&this.removeEventListener("stopped",this.#p),this.#p=_,_&&this.addEventListener("stopped",_)}addEventListener(_,d,T){super.addEventListener(_,d,T)}removeEventListener(_,d,T){super.removeEventListener(_,d,T)}stop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new b.FakeEvent("stopped")))}clone({id:_,data:d}={}){return new k({id:_??(0,v.v4)(),kind:this.#l,label:this.#u,contentHint:this.#s,enabled:this.#r,muted:this.#t,readyState:this.#e,capabilities:(0,s.clone)(this.#h),constraints:(0,s.clone)(this.#i),settings:(0,s.clone)(this.#f),data:d??(0,s.clone)(this.#n)})}getCapabilities(){return this.#h}getConstraints(){return this.#i}async applyConstraints(_={}){return this.#i=_,Promise.resolve()}getSettings(){return this.#f}remoteStop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new b.FakeEvent("stopped")),this.dispatchEvent(new b.FakeEvent("ended")))}remoteMute(){this.#t||(this.#t=!0,this.dispatchEvent(new b.FakeEvent("mute")))}remoteUnmute(){this.#t&&(this.#t=!1,this.dispatchEvent(new b.FakeEvent("unmute")))}}return ve.FakeMediaStreamTrack=k,ve}var ye={},Wt;function Ar(){if(Wt)return ye;Wt=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.FakeEventTarget=void 0;let v=class{listeners={};addEventListener(b,s,k){s&&(this.listeners[b]??=[],this.listeners[b].push({callback:typeof s=="function"?s:s.handleEvent,once:typeof k=="object"&&k.once===!0}))}removeEventListener(b,s,k){this.listeners[b]&&s&&(this.listeners[b]=this.listeners[b].filter(R=>R.callback!==(typeof s=="function"?s:s.handleEvent)))}dispatchEvent(b){if(!b||typeof b.type!="string")throw new Error("invalid event object");const s=this.listeners[b.type];if(!s)return!0;for(const k of[...s]){try{k.callback.call(this,b)}catch(R){setTimeout(()=>{throw R},0)}k.once&&this.removeEventListener(b.type,k.callback)}return!b.defaultPrevented}};return ye.FakeEventTarget=v,ye}var Kt;function Nr(){if(Kt)return _e;Kt=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.FakeHandler=void 0;const v=Or(),w=z(),b=$(),s=X(),k=G(),R=U(),_=Ar(),d=new b.Logger("FakeHandler"),T="FakeHandler";let m=class je extends w.EnhancedEventEmitter{_closed=!1;_fakeParameters;_getSendExtendedRtpCapabilities;_cname=`CNAME-${s.generateRandomNumber()}`;_transportReady=!1;_nextLocalId=1;_tracks=new Map;_nextSctpStreamId=0;static createFactory(o){return{name:T,factory:S=>new je(S,o),getNativeRtpCapabilities:async()=>(d.debug("getNativeRtpCapabilities()"),je.getLocalRtpCapabilities(o)),getNativeSctpCapabilities:async()=>(d.debug("getNativeSctpCapabilities()"),o.generateNativeSctpCapabilities())}}static getLocalRtpCapabilities(o){const S=o.generateNativeRtpCapabilities();return k.validateAndNormalizeRtpCapabilities(S),S}constructor({getSendExtendedRtpCapabilities:o},S){super(),d.debug("constructor()"),this._getSendExtendedRtpCapabilities=o,this._fakeParameters=S}get name(){return T}close(){d.debug("close()"),!this._closed&&(this._closed=!0,super.close())}setIceGatheringState(o){this.emit("@icegatheringstatechange",o)}setConnectionState(o){this.emit("@connectionstatechange",o)}async updateIceServers(o){this.assertNotClosed(),d.debug("updateIceServers()")}async restartIce(o){this.assertNotClosed(),d.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:o,encodings:S,codecOptions:p,codec:e}){this.assertNotClosed(),d.debug("send() [kind:%s, track.id:%s]",o.kind,o.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const t=je.getLocalRtpCapabilities(this._fakeParameters),a=this._getSendExtendedRtpCapabilities(t),c=k.getSendingRtpParameters(o.kind,a);c.codecs=k.reduceCodecs(c.codecs,e);const y=c.codecs.some(l=>/.+\/rtx$/i.test(l.mimeType));c.mid=`mid-${s.generateRandomNumber()}`,S||(S=[{}]);for(const l of S)l.ssrc=s.generateRandomNumber(),y&&(l.rtx={ssrc:s.generateRandomNumber()});c.encodings=S,c.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const g=this._nextLocalId++;return this._tracks.set(g,o),{localId:String(g),rtpParameters:c}}async stopSending(o){if(d.debug("stopSending() [localId:%s]",o),!this._closed){if(!this._tracks.has(Number(o)))throw new Error("local track not found");this._tracks.delete(Number(o))}}async pauseSending(o){this.assertNotClosed()}async resumeSending(o){this.assertNotClosed()}async replaceTrack(o,S){this.assertNotClosed(),S?d.debug("replaceTrack() [localId:%s, track.id:%s]",o,S.id):d.debug("replaceTrack() [localId:%s, no track]",o),this._tracks.delete(Number(o)),this._tracks.set(Number(o),S)}async setMaxSpatialLayer(o,S){this.assertNotClosed(),d.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",o,S)}async setRtpEncodingParameters(o,S){this.assertNotClosed(),d.debug("setRtpEncodingParameters() [localId:%s, params:%o]",o,S)}async getSenderStats(o){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:o,maxPacketLifeTime:S,maxRetransmits:p,label:e,protocol:t}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),d.debug("sendDataChannel()");const a=new r({id:this._nextSctpStreamId++,ordered:o,maxPacketLifeTime:S,maxRetransmits:p,label:e,protocol:t}),c={streamId:this._nextSctpStreamId,ordered:o,maxPacketLifeTime:S,maxRetransmits:p};return{dataChannel:a,sctpStreamParameters:c}}async receive(o){this.assertNotClosed();const S=[];for(const p of o){const{trackId:e,kind:t}=p;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),d.debug("receive() [trackId:%s, kind:%s]",e,t);const a=this._nextLocalId++,c=new v.FakeMediaStreamTrack({kind:t});this._tracks.set(a,c),S.push({localId:String(a),track:c})}return S}async stopReceiving(o){if(!this._closed)for(const S of o)d.debug("stopReceiving() [localId:%s]",S),this._tracks.delete(Number(S))}async pauseReceiving(o){this.assertNotClosed()}async resumeReceiving(o){this.assertNotClosed()}async getReceiverStats(o){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:o,label:S,protocol:p}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),d.debug("receiveDataChannel()"),{dataChannel:new r({id:o.streamId,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits,label:S,protocol:p})}}async setupTransport({localDtlsRole:o,localSdpObject:S}){const p=s.clone(this._fakeParameters.generateLocalDtlsParameters());o&&(p.role=o),this.emit("@connectionstatechange","connecting"),await new Promise((e,t)=>this.emit("@connect",{dtlsParameters:p},e,t)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new R.InvalidStateError("method called in a closed handler")}};_e.FakeHandler=m;class r extends _.FakeEventTarget{_id;_negotiated=!0;_ordered;_maxPacketLifeTime;_maxRetransmits;_label;_protocol;_readyState="connecting";_bufferedAmount=0;_bufferedAmountLowThreshold=0;_binaryType="arraybuffer";_onopen=null;_onclosing=null;_onclose=null;_onmessage=null;_onbufferedamountlow=null;_onerror=null;constructor({id:o,ordered:S=!0,maxPacketLifeTime:p=null,maxRetransmits:e=null,label:t="",protocol:a=""}){super(),d.debug(`constructor() [id:${o}, ordered:${S}, maxPacketLifeTime:${p}, maxRetransmits:${e}, label:${t}, protocol:${a}`),this._id=o,this._ordered=S,this._maxPacketLifeTime=p,this._maxRetransmits=e,this._label=t,this._protocol=a}get id(){return this._id}get negotiated(){return this._negotiated}get ordered(){return this._ordered}get maxPacketLifeTime(){return this._maxPacketLifeTime}get maxRetransmits(){return this._maxRetransmits}get label(){return this._label}get protocol(){return this._protocol}get readyState(){return this._readyState}get bufferedAmount(){return this._bufferedAmount}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(o){this._bufferedAmountLowThreshold=o}get binaryType(){return this._binaryType}set binaryType(o){this._binaryType=o}get onopen(){return this._onopen}set onopen(o){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=o,o&&this.addEventListener("open",o)}get onclosing(){return this._onclosing}set onclosing(o){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=o,o&&this.addEventListener("closing",o)}get onclose(){return this._onclose}set onclose(o){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=o,o&&this.addEventListener("close",o)}get onmessage(){return this._onmessage}set onmessage(o){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=o,o&&this.addEventListener("message",o)}get onbufferedamountlow(){return this._onbufferedamountlow}set onbufferedamountlow(o){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=o,o&&this.addEventListener("bufferedamountlow",o)}get onerror(){return this._onerror}set onerror(o){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=o,o&&this.addEventListener("error",o)}addEventListener(o,S,p){super.addEventListener(o,S,p)}removeEventListener(o,S,p){super.removeEventListener(o,S,p)}close(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}send(o){if(this._readyState!=="open")throw new R.InvalidStateError("not open")}}return _e}var q={},Jt;function jr(){if(Jt)return q;Jt=1,Object.defineProperty(q,"__esModule",{value:!0}),q.generateRouterRtpCapabilities=b,q.generateNativeRtpCapabilities=s,q.generateNativeSctpCapabilities=k,q.generateLocalDtlsParameters=R,q.generateTransportRemoteParameters=_,q.generateProducerRemoteParameters=d,q.generateConsumerRemoteParameters=T,q.generateDataProducerRemoteParameters=m,q.generateDataConsumerRemoteParameters=r;const v=X();function w(){return String(v.generateRandomNumber())}function b(){return v.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function s(){return{codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]}}function k(){return v.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function R(){return v.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function _(){return{id:w(),iceParameters:v.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:v.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:v.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:v.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function d(){return v.deepFreeze({id:w()})}function T({id:n,codecMimeType:o}={}){switch(o){case"audio/opus":return{id:n??w(),producerId:w(),kind:"audio",rtpParameters:v.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:n??w(),producerId:w(),kind:"audio",rtpParameters:v.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:n??w(),producerId:w(),kind:"video",rtpParameters:v.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:n??w(),producerId:w(),kind:"video",rtpParameters:v.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${o}'`)}}function m(){return v.deepFreeze({id:w()})}function r({id:n}={}){return{id:n??w(),dataProducerId:w(),sctpStreamParameters:v.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}return q}var Zt;function $r(){return Zt||(Zt=1,(function(v){Object.defineProperty(v,"__esModule",{value:!0}),v.debug=v.testFakeParameters=v.FakeHandler=v.enhancedEvents=v.ortc=v.parseScalabilityMode=v.detectDeviceAsync=v.detectDevice=v.Device=v.version=v.types=void 0;const w=Yt();v.debug=w.default,v.types=ir(),v.version="3.16.3";var b=Pr();Object.defineProperty(v,"Device",{enumerable:!0,get:function(){return b.Device}}),Object.defineProperty(v,"detectDevice",{enumerable:!0,get:function(){return b.detectDevice}}),Object.defineProperty(v,"detectDeviceAsync",{enumerable:!0,get:function(){return b.detectDeviceAsync}});var s=ee();Object.defineProperty(v,"parseScalabilityMode",{enumerable:!0,get:function(){return s.parse}}),v.ortc=G(),v.enhancedEvents=z();var k=Nr();Object.defineProperty(v,"FakeHandler",{enumerable:!0,get:function(){return k.FakeHandler}}),v.testFakeParameters=jr()})(ze)),ze}var zr=$r();const Xr=tr({__proto__:null},[zr]);export{Xr as i};
